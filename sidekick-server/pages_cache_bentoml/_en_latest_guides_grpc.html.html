<!DOCTYPE html><html class="no-js" lang="en"><head><!-- Google Tag Manager -->
<script type="text/javascript" async="" src="https://snap.licdn.com/li.lms-analytics/insight.min.js"></script><script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script><script async="" src="https://www.googletagmanager.com/gtm.js?id=GTM-NLGDMK5"></script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NLGDMK5');</script>
<!-- End Google Tag Manager -->
<meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/">
<meta property="og:title" content="Serving with gRPC">
<meta property="og:type" content="website">
<meta property="og:url" content="http://docs.bentoml.org/guides/grpc.html">
<meta property="og:site_name" content="BentoML Documentation">
<meta property="og:description" content="time expected: 12 minutes This guide will demonstrate advanced features that BentoML offers for you to get started with gRPC: First-class support for custom gRPC Servicer, custom interceptors, hand...">
<meta property="og:image" content="http://docs.bentoml.org/_images/interceptor-flow.png">
<meta property="og:image:alt" content="Interceptor Flow">
<meta name="description" content="time expected: 12 minutes This guide will demonstrate advanced features that BentoML offers for you to get started with gRPC: First-class support for custom gRPC Servicer, custom interceptors, hand...">
<link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html"><link rel="next" title="Serving with GPU" href="gpu.html"><link rel="prev" title="Performance Guide" href="performance.html">
        <link rel="canonical" href="https://docs.bentoml.org/en/latest/guides/grpc.html">

    <link rel="shortcut icon" href="../_static/favicon-96x96.ico"><!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
<script>
window.Papercups = {
    config: {
        // Pass in your Papercups account token here after signing up
        accountId: '25ad5fd9-293b-4e0f-9601-5b0cd7846b48',
        token: '25ad5fd9-293b-4e0f-9601-5b0cd7846b48',
        inbox: 'ac3ebd50-fc10-4299-9a1c-496841b49a6f',
        title: 'Welcome to BentoML!',
        subtitle: 'Ask us anything in the chat window below ðŸ˜Š',
        // newMessagePlaceholder: 'Start typing...',
        primaryColor: '#47AFD1',
        // Optionally pass in a default greeting
        greeting: "Hi there! How can I help you? If we couldn't get back to you in " +
                "time, feel free to join our community on slack and post your " +
                "question in the #support channel: https://l.linklyhq.com/l/ktOX",
        // Optionally pass in metadata to identify the customer
        // customer: {
        //   name: 'Test User',
        //   email: 'test@test.com',
        //   external_id: '123',
        //   metadata: {version: 1, plan: 'premium'}, // Custom fields go here
        // },
        // Optionally specify the base URL
        baseUrl: 'https://yatai-community-papercups.herokuapp.com',
        // Add this if you want to require the customer to enter
        // their email before being able to send you a message
        requireEmailUpfront: true,
        // Add this if you want to indicate when you/your agents
        // are online or offline to your customers
        showAgentAvailability: true,
    },
};
</script>
<script type="text/javascript" async="" defer="" src="https://app.papercups.io/widget.js"></script>

        <title>Serving with gRPC - BentoML</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css">
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53">
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css">
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster.custom.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster.bundle.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-shadow.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-punk.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-noir.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-light.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-borderless.min.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/micromodal.css">
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css">
    <link rel="stylesheet" type="text/css" href="/_/static/css/badge_only.css">
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e">
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css">
    
    


<style>
  body {
    --color-code-background: #3f3f3f;
  --color-code-foreground: #dcdccc;
  --color-brand-primary: #44a4c6 ;
  --color-brand-content: #44a4c6 ;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-brand-primary: #c9378a ;
  --color-brand-content: #c9378a ;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-brand-primary: #c9378a ;
  --color-brand-content: #c9378a ;
  
      }
    }
  }
</style>
<!-- RTD Extra Head -->

<link rel="stylesheet" href="/_/static/css/readthedocs-doc-embed.css" type="text/css">

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": true, "api_host": "https://readthedocs.org", "build_date": "2023-03-27T14:27:39Z", "builder": "sphinx", "canonical_url": null, "commit": "6b4da8fe", "docroot": "/docs/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "guides/grpc", "programming_language": "py", "project": "bentoml", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {"yatai": "https://docs.bentoml.org/projects/yatai/en/latest/"}, "theme": "furo", "user_analytics_code": "UA-112879361-4", "version": "latest"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="/_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
<style data-emotion="css"></style><style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style id="MJX-CHTML-styles">
mjx-container[jax="CHTML"] {
  line-height: 0;
}

mjx-container [space="1"] {
  margin-left: .111em;
}

mjx-container [space="2"] {
  margin-left: .167em;
}

mjx-container [space="3"] {
  margin-left: .222em;
}

mjx-container [space="4"] {
  margin-left: .278em;
}

mjx-container [space="5"] {
  margin-left: .333em;
}

mjx-container [rspace="1"] {
  margin-right: .111em;
}

mjx-container [rspace="2"] {
  margin-right: .167em;
}

mjx-container [rspace="3"] {
  margin-right: .222em;
}

mjx-container [rspace="4"] {
  margin-right: .278em;
}

mjx-container [rspace="5"] {
  margin-right: .333em;
}

mjx-container [size="s"] {
  font-size: 70.7%;
}

mjx-container [size="ss"] {
  font-size: 50%;
}

mjx-container [size="Tn"] {
  font-size: 60%;
}

mjx-container [size="sm"] {
  font-size: 85%;
}

mjx-container [size="lg"] {
  font-size: 120%;
}

mjx-container [size="Lg"] {
  font-size: 144%;
}

mjx-container [size="LG"] {
  font-size: 173%;
}

mjx-container [size="hg"] {
  font-size: 207%;
}

mjx-container [size="HG"] {
  font-size: 249%;
}

mjx-container [width="full"] {
  width: 100%;
}

mjx-box {
  display: inline-block;
}

mjx-block {
  display: block;
}

mjx-itable {
  display: inline-table;
}

mjx-row {
  display: table-row;
}

mjx-row > * {
  display: table-cell;
}

mjx-mtext {
  display: inline-block;
}

mjx-mstyle {
  display: inline-block;
}

mjx-merror {
  display: inline-block;
  color: red;
  background-color: yellow;
}

mjx-mphantom {
  visibility: hidden;
}

_::-webkit-full-page-media, _:future, :root mjx-container {
  will-change: opacity;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-c::before {
  display: block;
  width: 0;
}

.MJX-TEX {
  font-family: MJXZERO, MJXTEX;
}

.TEX-B {
  font-family: MJXZERO, MJXTEX-B;
}

.TEX-I {
  font-family: MJXZERO, MJXTEX-I;
}

.TEX-MI {
  font-family: MJXZERO, MJXTEX-MI;
}

.TEX-BI {
  font-family: MJXZERO, MJXTEX-BI;
}

.TEX-S1 {
  font-family: MJXZERO, MJXTEX-S1;
}

.TEX-S2 {
  font-family: MJXZERO, MJXTEX-S2;
}

.TEX-S3 {
  font-family: MJXZERO, MJXTEX-S3;
}

.TEX-S4 {
  font-family: MJXZERO, MJXTEX-S4;
}

.TEX-A {
  font-family: MJXZERO, MJXTEX-A;
}

.TEX-C {
  font-family: MJXZERO, MJXTEX-C;
}

.TEX-CB {
  font-family: MJXZERO, MJXTEX-CB;
}

.TEX-FR {
  font-family: MJXZERO, MJXTEX-FR;
}

.TEX-FRB {
  font-family: MJXZERO, MJXTEX-FRB;
}

.TEX-SS {
  font-family: MJXZERO, MJXTEX-SS;
}

.TEX-SSB {
  font-family: MJXZERO, MJXTEX-SSB;
}

.TEX-SSI {
  font-family: MJXZERO, MJXTEX-SSI;
}

.TEX-SC {
  font-family: MJXZERO, MJXTEX-SC;
}

.TEX-T {
  font-family: MJXZERO, MJXTEX-T;
}

.TEX-V {
  font-family: MJXZERO, MJXTEX-V;
}

.TEX-VB {
  font-family: MJXZERO, MJXTEX-VB;
}

mjx-stretchy-v mjx-c, mjx-stretchy-h mjx-c {
  font-family: MJXZERO, MJXTEX-S1, MJXTEX-S4, MJXTEX, MJXTEX-A ! important;
}

@font-face /* 0 */ {
  font-family: MJXZERO;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Zero.woff") format("woff");
}

@font-face /* 1 */ {
  font-family: MJXTEX;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Regular.woff") format("woff");
}

@font-face /* 2 */ {
  font-family: MJXTEX-B;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Bold.woff") format("woff");
}

@font-face /* 3 */ {
  font-family: MJXTEX-I;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Math-Italic.woff") format("woff");
}

@font-face /* 4 */ {
  font-family: MJXTEX-MI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Italic.woff") format("woff");
}

@font-face /* 5 */ {
  font-family: MJXTEX-BI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Math-BoldItalic.woff") format("woff");
}

@font-face /* 6 */ {
  font-family: MJXTEX-S1;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size1-Regular.woff") format("woff");
}

@font-face /* 7 */ {
  font-family: MJXTEX-S2;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size2-Regular.woff") format("woff");
}

@font-face /* 8 */ {
  font-family: MJXTEX-S3;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size3-Regular.woff") format("woff");
}

@font-face /* 9 */ {
  font-family: MJXTEX-S4;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size4-Regular.woff") format("woff");
}

@font-face /* 10 */ {
  font-family: MJXTEX-A;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_AMS-Regular.woff") format("woff");
}

@font-face /* 11 */ {
  font-family: MJXTEX-C;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Regular.woff") format("woff");
}

@font-face /* 12 */ {
  font-family: MJXTEX-CB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Bold.woff") format("woff");
}

@font-face /* 13 */ {
  font-family: MJXTEX-FR;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Regular.woff") format("woff");
}

@font-face /* 14 */ {
  font-family: MJXTEX-FRB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Bold.woff") format("woff");
}

@font-face /* 15 */ {
  font-family: MJXTEX-SS;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Regular.woff") format("woff");
}

@font-face /* 16 */ {
  font-family: MJXTEX-SSB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Bold.woff") format("woff");
}

@font-face /* 17 */ {
  font-family: MJXTEX-SSI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Italic.woff") format("woff");
}

@font-face /* 18 */ {
  font-family: MJXTEX-SC;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Script-Regular.woff") format("woff");
}

@font-face /* 19 */ {
  font-family: MJXTEX-T;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Typewriter-Regular.woff") format("woff");
}

@font-face /* 20 */ {
  font-family: MJXTEX-V;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Regular.woff") format("woff");
}

@font-face /* 21 */ {
  font-family: MJXTEX-VB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Bold.woff") format("woff");
}
</style></head>
  <body data-theme="auto">
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NLGDMK5"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    


<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"></path>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M13 12h5"></path>
      <path d="M13 15h4"></path>
      <path d="M13 18h1"></path>
      <path d="M13 9h4"></path>
      <path d="M13 6h1"></path>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">BentoML</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo.svg" alt="Logo">
  </div>
  
  <span class="sidebar-brand-text">BentoML</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial: Intro to BentoML</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../concepts/index.html">Main Concepts</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/model.html">Preparing Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/service.html">Service and APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/bento.html">Building Bentos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/runner.html">Using Runners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/deploy.html">Deploying Bento</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../frameworks/index.html">Framework Guides</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/catboost.html">CatBoost</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/fastai.html">fast.ai</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/keras.html">Keras</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/lightgbm.html">LightGBM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/onnx.html">ONNX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/picklable.html">Picklable Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/pytorch.html">PyTorch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/pytorch_lightning.html">PyTorch Lightning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/sklearn.html">Scikit-Learn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/tensorflow.html">TensorFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/transformers.html">Transformers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/xgboost.html">XGBoost</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Advanced Guides</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="batching.html">Adaptive Batching</a></li>
<li class="toctree-l2"><a class="reference internal" href="containerization.html">Advanced Containerization</a></li>
<li class="toctree-l2"><a class="reference internal" href="client.html">Bento Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="server.html">Bento Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="envmanager.html">Environment Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="graph.html">Inference Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="monitoring.html">Inference Data Collection &amp; Model Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics.html">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html">Performance Guide</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Serving with gRPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpu.html">Serving with GPU</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="tracing.html">Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration.html">1.0 Migration Guide</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../integrations/index.html">Integrations</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../integrations/airflow.html">Airflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/arize.html">Arize AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/flink.html">Flink</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/kubeflow.html">Kubeflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/mlflow.html">MLflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/spark.html">Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/triton.html">Triton Inference Server</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/core.html">Core Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/stores.html">Bento Store APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/api_io_descriptors.html">API IO Descriptors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/metrics.html">Metrics API</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../reference/frameworks/index.html">Framework APIs</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/onnx.html">ONNX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/sklearn.html">Scikit-Learn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/transformers.html">Transformers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/flax.html">Flax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/tensorflow.html">TensorFlow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/torchscript.html">TorchScript</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/xgboost.html">XGBoost</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/picklable_model.html">Picklable Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/pytorch.html">PyTorch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/lightgbm.html">LightGBM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/mlflow.html">MLflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/catboost.html">CatBoost</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/fastai.html">fast.ai</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/keras.html">Keras</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/frameworks/ray.html">Ray</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/cli.html">BentoML CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/batch.html">Batch Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/exceptions.html">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/container.html">Container APIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/bentoml/BentoML/tree/main/examples">Examples</a></li>
<li class="toctree-l1"><a class="reference external" href="https://l.linklyhq.com/l/ktOX">Community</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/bentoml/BentoML">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://modelserving.com">Blog</a></li>
</ul>

</div>

<div id="furo-sidebar-ad-placement" class="flat" data-ea-publisher="readthedocs" data-ea-type="readthedocs-sidebar" data-ea-manual="true"></div>
</div>

<div id="furo-readthedocs-versions" class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions" tabindex="0">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book">&nbsp;</span>
    v: latest
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Versions</dt>
      
        <dd><a href="/en/latest/">latest</a></dd>
      
        <dd><a href="/en/0.13-lts/">0.13-lts</a></dd>
      
    </dl>
    <dl>
      <dt>Downloads</dt>
      
    </dl>
    <dl>
      
      <dt>On Read the Docs</dt>
        <dd>
          <a href="//readthedocs.org/projects/bentoml/?fromdocs=bentoml">Project Home</a>
        </dd>
        <dd>
          <a href="//readthedocs.org/builds/bentoml/?fromdocs=bentoml">Builds</a>
        </dd>
    </dl>
  </div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/bentoml/bentoml/edit/main/docs/source/guides/grpc.rst" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4"></path>
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5"></line>
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="serving-with-grpc">
<h1>Serving with gRPC<a class="headerlink" href="#serving-with-grpc" title="Permalink to this heading">#</a></h1>
<p><em>time expected: 12 minutes</em></p>
<p>This guide will demonstrate advanced features that BentoML offers for you to get started
with <a class="reference external" href="https://grpc.io/">gRPC</a>:</p>
<ul class="simple">
<li><p>First-class support for <a class="hxr-hoverxref hxr-tooltip reference internal" href="#mounting-servicer"><span class="std std-ref">custom gRPC Servicer</span></a>, <a class="hxr-hoverxref hxr-tooltip reference internal" href="#mounting-grpc-interceptors"><span class="std std-ref">custom interceptors</span></a>, handlers.</p></li>
<li><p>Seemlessly adding gRPC support to existing Bento.</p></li>
</ul>
<p>This guide will also walk you through tradeoffs of serving with gRPC, as well as
recommendation on scenarios where gRPC might be a good fit.</p>
<p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Requirements:</span> This guide assumes that you have basic knowledge of gRPC and protobuf. If you arenâ€™t
familar with gRPC, you can start with gRPC <a class="reference external" href="https://grpc.io/docs/languages/python/quickstart/">quick start guide</a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For quick introduction to serving with gRPC, see <a class="hxr-hoverxref hxr-tooltip reference internal" href="../tutorial.html#tutorial-intro-to-bentoml"><span class="std std-ref">Intro to BentoML</span></a></p>
</div>
<section id="get-started-with-grpc-in-bentoml">
<h2>Get started with gRPC in BentoML<a class="headerlink" href="#get-started-with-grpc-in-bentoml" title="Permalink to this heading">#</a></h2>
<p>We will be using the example from <a class="hxr-hoverxref hxr-tooltip reference internal" href="../tutorial.html#tutorial-intro-to-bentoml"><span class="std std-ref">the quickstart</span></a> to
demonstrate BentoML capabilities with gRPC.</p>
<section id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading">#</a></h3>
<p>BentoML supports for gRPC are introduced in version 1.0.6 and above.</p>
<p>Install BentoML with gRPC support with <a class="reference external" href="https://pypi.org/project/pip">pip</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span><span class="s2">"bentoml[grpc]"</span>
</pre></div>
</div>
<p>Thats it! You can now serve your Bento with gRPC via <a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/cli.html#bentoml-serve-grpc"><span class="std std-ref">bentoml serve-grpc</span></a> without having to modify your current service definition ðŸ˜ƒ.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>bentoml<span class="w"> </span>serve-grpc<span class="w"> </span>iris_classifier:latest<span class="w"> </span>--production
</pre></div>
</div>
</section>
<section id="using-your-grpc-bentoservice">
<h3>Using your gRPC BentoService<a class="headerlink" href="#using-your-grpc-bentoservice" title="Permalink to this heading">#</a></h3>
<p>There are two ways to interact with your gRPC BentoService:</p>
<ol class="arabic">
<li><p>Use tools such as <a class="reference external" href="https://github.com/fullstorydev/grpcurl">fullstorydev/grpcurl</a>, <a class="reference external" href="https://github.com/fullstorydev/grpcui">fullstorydev/grpcui</a>:
The server requires <a class="reference external" href="https://github.com/grpc/grpc/blob/master/doc/server-reflection.md">reflection</a> to be enabled for those tools to work.
Pass in <code class="docutils literal notranslate"><span class="pre">--enable-reflection</span></code> to enable reflection:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>bentoml<span class="w"> </span>serve-grpc<span class="w"> </span>iris_classifier:latest<span class="w"> </span>--production<span class="w"> </span>--enable-reflection
</pre></div>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" for="sd-tab-item-0">
gRPCurl</label><div class="sd-tab-content docutils">
<p>We will use <a class="reference external" href="https://github.com/fullstorydev/grpcurl">fullstorydev/grpcurl</a> to send a CURL-like request to the gRPC BentoServer.</p>
<p>Note that we will use <a class="reference external" href="https://docs.docker.com/get-docker/">docker</a> to run the <code class="docutils literal notranslate"><span class="pre">grpcurl</span></code> command.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-2" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" data-sync-id="__fullstorydev_macwin" for="sd-tab-item-2">
MacOS/Windows</label><div class="sd-tab-content docutils">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-i<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
<span class="w">               </span>fullstorydev/grpcurl<span class="w"> </span>-d<span class="w"> </span>@<span class="w"> </span>-plaintext<span class="w"> </span>host.docker.internal:3000<span class="w"> </span><span class="se">\</span>
<span class="w">               </span>bentoml.grpc.v1.BentoService/Call<span class="w"> </span><span class="s">&lt;&lt;EOT</span>
<span class="s">{</span>
<span class="s">   "apiName": "classify",</span>
<span class="s">   "ndarray": {</span>
<span class="s">      "shape": [1, 4],</span>
<span class="s">      "floatValues": [5.9, 3, 5.1, 1.8]</span>
<span class="s">   }</span>
<span class="s">}</span>
<span class="s">EOT</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-3" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" data-sync-id="__fullstorydev_linux" for="sd-tab-item-3">
Linux</label><div class="sd-tab-content docutils">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-i<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
<span class="w">               </span>--network<span class="o">=</span>host<span class="w"> </span><span class="se">\</span>
<span class="w">               </span>fullstorydev/grpcurl<span class="w"> </span>-d<span class="w"> </span>@<span class="w"> </span>-plaintext<span class="w"> </span><span class="m">0</span>.0.0.0:3000<span class="w"> </span><span class="se">\</span>
<span class="w">               </span>bentoml.grpc.v1.BentoService/Call<span class="w"> </span><span class="s">&lt;&lt;EOT</span>
<span class="s">{</span>
<span class="s">   "apiName": "classify",</span>
<span class="s">   "ndarray": {</span>
<span class="s">      "shape": [1, 4],</span>
<span class="s">      "floatValues": [5.9, 3, 5.1, 1.8]</span>
<span class="s">   }</span>
<span class="s">}</span>
<span class="s">EOT</span>
</pre></div>
</div>
</div>
</div>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" for="sd-tab-item-1">
gRPCUI</label><div class="sd-tab-content docutils">
<p>We will use <a class="reference external" href="https://github.com/fullstorydev/grpcui">fullstorydev/grpcui</a> to send request from a web browser.</p>
<p>Note that we will use <a class="reference external" href="https://docs.docker.com/get-docker/">docker</a> to run the <code class="docutils literal notranslate"><span class="pre">grpcui</span></code> command.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-4" name="sd-tab-set-2" type="radio">
<label class="sd-tab-label" data-sync-id="__fullstorydev_macwin" for="sd-tab-item-4">
MacOS/Windows</label><div class="sd-tab-content docutils">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>--init<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
<span class="w">               </span>-p<span class="w"> </span><span class="m">8080</span>:8080<span class="w"> </span>fullstorydev/grpcui<span class="w"> </span>-plaintext<span class="w"> </span>host.docker.internal:3000
</pre></div>
</div>
</div>
<input id="sd-tab-item-5" name="sd-tab-set-2" type="radio">
<label class="sd-tab-label" data-sync-id="__fullstorydev_linux" for="sd-tab-item-5">
Linux</label><div class="sd-tab-content docutils">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>--init<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
<span class="w">               </span>-p<span class="w"> </span><span class="m">8080</span>:8080<span class="w"> </span><span class="se">\</span>
<span class="w">               </span>--network<span class="o">=</span>host<span class="w"> </span>fullstorydev/grpcui<span class="w"> </span>-plaintext<span class="w"> </span><span class="m">0</span>.0.0.0:3000
</pre></div>
</div>
</div>
</div>
<p>Proceed to <a class="reference external" href="http://127.0.0.1:8080">http://127.0.0.1:8080</a> in your browser and send test request from the web UI.</p>
</div>
</div>
<p>Open a different terminal and use one of the following:</p>
</li>
<li><p>Use one of the below <a class="hxr-hoverxref hxr-tooltip reference internal" href="#client-implementation"><span class="std std-ref">client implementations</span></a> to send test requests to your BentoService.</p></li>
</ol>
</section>
<section id="client-implementation">
<h3>Client Implementation<a class="headerlink" href="#client-implementation" title="Permalink to this heading">#</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All of the following client implementations are <a class="reference external" href="https://github.com/bentoml/BentoML/tree/main/grpc-client/">available on GitHub</a>.</p>
</div>
<p><span class="raw-html"><br></span></p>
<p>From another terminal, use one of the following client implementation to send request to the
gRPC server:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>gRPC comes with supports for multiple languages. In the upcoming sections
we will demonstrate two workflows of generating stubs and implementing clients:</p>
<ul class="simple">
<li><p>Using <a class="reference external" href="https://bazel.build"><cite>bazel</cite></a> to manage and isolate dependencies (recommended)</p></li>
<li><p>A manual approach using <code class="docutils literal notranslate"><span class="pre">protoc</span></code> its language-specific plugins</p></li>
</ul>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-6" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" data-sync-id="python" for="sd-tab-item-6">
Python</label><div class="sd-tab-content docutils">
<p>We will create our Python client in the directory <code class="docutils literal notranslate"><span class="pre">~/workspace/iris_python_client/</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>~/workspace/iris_python_client
Â»<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/workspace/iris_python_client
</pre></div>
</div>
<p>Create a <code class="docutils literal notranslate"><span class="pre">client.py</span></code> file with the following content:</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text"><cite>client.py</cite></span><a class="headerlink" href="#id11" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">bentoml</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">async_run</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">bentoml</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Client</span><span class="p">):</span>

    <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">async_classify</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">5.9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">]]))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Result from 'client.async_classify':</span><span class="se">\n</span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">async_call</span><span class="p">(</span><span class="s2">"classify"</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">5.9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">]]))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Result from 'client.async_call':</span><span class="se">\n</span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">bentoml</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Client</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">5.9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">]]))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Result from 'client.classify':</span><span class="se">\n</span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">"classify"</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">5.9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">]]))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Result from 'client.call(bentoml_api_name='classify')':</span><span class="se">\n</span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">argparse</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">ch</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s2">"</span><span class="si">%(message)s</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">ch</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">"-s"</span><span class="p">,</span> <span class="s2">"--sync"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">"store_true"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">bentoml</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Client</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="s2">"localhost:3000"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">sync</span><span class="p">:</span>
        <span class="n">run</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">async_run</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<input id="sd-tab-item-7" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" data-sync-id="golang" for="sd-tab-item-7">
Go</label><div class="sd-tab-content docutils">
<p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Requirements:</span> Make sure to install the <a class="reference external" href="https://grpc.io/docs/languages/go/quickstart/#prerequisites">prerequisites</a> before using Go.</p>
<p>We will create our Golang client in the directory <code class="docutils literal notranslate"><span class="pre">~/workspace/iris_go_client/</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>~/workspace/iris_go_client
Â»<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/workspace/iris_go_client
</pre></div>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-14" name="sd-tab-set-4" type="radio">
<label class="sd-tab-label" data-sync-id="bazel-workflow" for="sd-tab-item-14">
Using bazel (recommended)</label><div class="sd-tab-content docutils">
<p>Define a <a class="reference external" href="https://bazel.build/concepts/build-ref"><code class="docutils literal notranslate"><span class="pre">WORKSPACE</span></code></a> file:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-code" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z"></path></svg></span><code class="docutils literal notranslate"><span class="pre">WORKSPACE</span></code><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">workspace</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"iris_go_client"</span><span class="p">)</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@bazel_tools//tools/build_defs/repo:http.bzl"</span><span class="p">,</span> <span class="s2">"http_archive"</span><span class="p">)</span>

<span class="c1"># setup rules_proto and rules_proto_grpc</span>
<span class="n">http_archive</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"rules_proto"</span><span class="p">,</span>
    <span class="n">sha256</span> <span class="o">=</span> <span class="s2">"e017528fd1c91c5a33f15493e3a398181a9e821a804eb7ff5acdd1d2d6c2b18d"</span><span class="p">,</span>
    <span class="n">strip_prefix</span> <span class="o">=</span> <span class="s2">"rules_proto-4.0.0-3.20.0"</span><span class="p">,</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"https://github.com/bazelbuild/rules_proto/archive/refs/tags/4.0.0-3.20.0.tar.gz"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">http_archive</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"rules_proto_grpc"</span><span class="p">,</span>
    <span class="n">sha256</span> <span class="o">=</span> <span class="s2">"507e38c8d95c7efa4f3b1c0595a8e8f139c885cb41a76cab7e20e4e67ae87731"</span><span class="p">,</span>
    <span class="n">strip_prefix</span> <span class="o">=</span> <span class="s2">"rules_proto_grpc-4.1.1"</span><span class="p">,</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"https://github.com/rules-proto-grpc/rules_proto_grpc/archive/4.1.1.tar.gz"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@rules_proto//proto:repositories.bzl"</span><span class="p">,</span> <span class="s2">"rules_proto_dependencies"</span><span class="p">,</span> <span class="s2">"rules_proto_toolchains"</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span><span class="s2">"@rules_proto_grpc//:repositories.bzl"</span><span class="p">,</span> <span class="s2">"rules_proto_grpc_repos"</span><span class="p">,</span> <span class="s2">"rules_proto_grpc_toolchains"</span><span class="p">)</span>

<span class="n">rules_proto_grpc_toolchains</span><span class="p">()</span>

<span class="n">rules_proto_grpc_repos</span><span class="p">()</span>

<span class="n">rules_proto_dependencies</span><span class="p">()</span>

<span class="n">rules_proto_toolchains</span><span class="p">()</span>

<span class="c1"># We need to load go_grpc rules first</span>
<span class="n">load</span><span class="p">(</span><span class="s2">"@rules_proto_grpc//:repositories.bzl"</span><span class="p">,</span> <span class="s2">"bazel_gazelle"</span><span class="p">,</span> <span class="s2">"io_bazel_rules_go"</span><span class="p">)</span>  <span class="c1"># buildifier: disable=same-origin-load</span>

<span class="n">io_bazel_rules_go</span><span class="p">()</span>

<span class="n">bazel_gazelle</span><span class="p">()</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@rules_proto_grpc//go:repositories.bzl"</span><span class="p">,</span> <span class="n">rules_proto_grpc_go_repos</span> <span class="o">=</span> <span class="s2">"go_repos"</span><span class="p">)</span>

<span class="n">rules_proto_grpc_go_repos</span><span class="p">()</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@io_bazel_rules_go//go:deps.bzl"</span><span class="p">,</span> <span class="s2">"go_register_toolchains"</span><span class="p">,</span> <span class="s2">"go_rules_dependencies"</span><span class="p">)</span>

<span class="n">go_rules_dependencies</span><span class="p">()</span>

<span class="n">go_register_toolchains</span><span class="p">(</span><span class="n">version</span> <span class="o">=</span> <span class="s2">"1.19"</span><span class="p">)</span>

<span class="n">http_archive</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"com_github_grpc_grpc"</span><span class="p">,</span>
    <span class="n">strip_prefix</span> <span class="o">=</span> <span class="s2">"grpc-v1.49.1"</span><span class="p">,</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"https://github.com/grpc/grpc/archive/v1.49.1.tar.gz"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@com_github_grpc_grpc//bazel:grpc_deps.bzl"</span><span class="p">,</span> <span class="s2">"grpc_deps"</span><span class="p">)</span>

<span class="n">grpc_deps</span><span class="p">()</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@com_github_grpc_grpc//bazel:grpc_extra_deps.bzl"</span><span class="p">,</span> <span class="s2">"grpc_extra_deps"</span><span class="p">)</span>

<span class="n">grpc_extra_deps</span><span class="p">()</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@com_google_protobuf//:protobuf_deps.bzl"</span><span class="p">,</span> <span class="s2">"protobuf_deps"</span><span class="p">)</span>

<span class="n">protobuf_deps</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details><p>Followed by defining a <a class="reference external" href="https://bazel.build/concepts/build-files"><code class="docutils literal notranslate"><span class="pre">BUILD</span></code></a> file:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-code" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z"></path></svg></span><code class="docutils literal notranslate"><span class="pre">BUILD</span></code><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">load</span><span class="p">(</span><span class="s2">"@rules_proto_grpc//go:defs.bzl"</span><span class="p">,</span> <span class="s2">"go_grpc_library"</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span><span class="s2">"@io_bazel_rules_go//go:def.bzl"</span><span class="p">,</span> <span class="s2">"go_binary"</span><span class="p">)</span>

<span class="n">proto_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"service_v1_proto"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"bentoml/grpc/v1/service.proto"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"@com_google_protobuf//:struct_proto"</span><span class="p">,</span> <span class="s2">"@com_google_protobuf//:wrappers_proto"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">go_grpc_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"service_go"</span><span class="p">,</span>
    <span class="n">importpath</span> <span class="o">=</span> <span class="s2">"github.com/bentoml/bentoml/grpc/v1"</span><span class="p">,</span>
    <span class="n">protos</span> <span class="o">=</span> <span class="p">[</span><span class="s2">":service_v1_proto"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">go_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"client_go"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"client.go"</span><span class="p">],</span>
    <span class="n">importpath</span> <span class="o">=</span> <span class="s2">"github.com/bentoml/bentoml/grpc/v1"</span><span class="p">,</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">":service_go"</span><span class="p">,</span>
        <span class="s2">"@com_github_golang_protobuf//proto:go_default_library"</span><span class="p">,</span>
        <span class="s2">"@org_golang_google_grpc//:go_default_library"</span><span class="p">,</span>
        <span class="s2">"@org_golang_google_grpc//credentials:go_default_library"</span><span class="p">,</span>
        <span class="s2">"@org_golang_google_grpc//credentials/insecure:go_default_library"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details></div>
<input id="sd-tab-item-15" name="sd-tab-set-4" type="radio">
<label class="sd-tab-label" data-sync-id="protoc-and-plugins" for="sd-tab-item-15">
Using protoc and language-specific plugins</label><div class="sd-tab-content docutils">
<p>Create a Go module:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>go<span class="w"> </span>mod<span class="w"> </span>init<span class="w"> </span>iris_go_client<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>go<span class="w"> </span>mod<span class="w"> </span>tidy
</pre></div>
</div>
<p>Add the following lines to <code class="docutils literal notranslate"><span class="pre">~/workspace/iris_go_client/go.mod</span></code>:</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="nx">require</span><span class="w"> </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">bentoml</span><span class="o">/</span><span class="nx">bentoml</span><span class="o">/</span><span class="nx">grpc</span><span class="o">/</span><span class="nx">v1</span><span class="w"> </span><span class="nx">v0</span><span class="mf">.0.0</span><span class="o">-</span><span class="nx">unpublished</span>

<span class="nx">replace</span><span class="w"> </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">bentoml</span><span class="o">/</span><span class="nx">bentoml</span><span class="o">/</span><span class="nx">grpc</span><span class="o">/</span><span class="nx">v1</span><span class="w"> </span><span class="nx">v0</span><span class="mf">.0.0</span><span class="o">-</span><span class="nx">unpublished</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">bentoml</span><span class="o">/</span><span class="nx">bentoml</span><span class="o">/</span><span class="nx">grpc</span><span class="o">/</span><span class="nx">v1</span>
</pre></div>
</div>
<p>By using <a class="reference external" href="https://go.dev/ref/mod#go-mod-file-replace">replace directive</a>, we
ensure that Go will know where our generated stubs to be imported from. (since we donâ€™t host the generate gRPC stubs on <cite>pkg.go.dev</cite> ðŸ˜„)</p>
<p>Since there is no easy way to add additional proto files, we will have to clone some
repositories and copy the proto files into our project:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/protocolbuffers/protobuf">protocolbuffers/protobuf</a> - the official repository for the Protocol Buffers. We will need protobuf files that lives under <code class="docutils literal notranslate"><span class="pre">src/google/protobuf</span></code>:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>thirdparty<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>thirdparty
Â»<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="w"> </span><span class="m">1</span><span class="w"> </span>https://github.com/protocolbuffers/protobuf.git
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p><a class="reference external" href="https://github.com/bentoml/bentoml">bentoml/bentoml</a> - We need the <code class="docutils literal notranslate"><span class="pre">service.proto</span></code> under <code class="docutils literal notranslate"><span class="pre">bentoml/grpc/</span></code> to build the client, therefore, we will perform
a <a class="reference external" href="https://github.blog/2020-01-17-bring-your-monorepo-down-to-size-with-sparse-checkout/">sparse checkout</a> to only checkout <code class="docutils literal notranslate"><span class="pre">bentoml/grpc</span></code> directory:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>bentoml<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">pushd</span><span class="w"> </span>bentoml
Â»<span class="w"> </span>git<span class="w"> </span>init
Â»<span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>-f<span class="w"> </span>origin<span class="w"> </span>https://github.com/bentoml/BentoML.git
Â»<span class="w"> </span>git<span class="w"> </span>config<span class="w"> </span>core.sparseCheckout<span class="w"> </span><span class="nb">true</span>
Â»<span class="w"> </span>cat<span class="w"> </span><span class="s">&lt;&lt;EOT &gt;|.git/info/sparse-checkout</span>
<span class="s">src/bentoml/grpc</span>
<span class="s">EOT</span>
Â»<span class="w"> </span>git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>main<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>src/bentoml/grpc<span class="w"> </span>.
Â»<span class="w"> </span><span class="nb">popd</span>
</pre></div>
</div>
<p>Here is the <code class="docutils literal notranslate"><span class="pre">protoc</span></code> command to generate the gRPC Go stubs:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>protoc<span class="w"> </span>-I.<span class="w"> </span>-I<span class="w"> </span>thirdparty/protobuf/src<span class="w">  </span><span class="se">\</span>
<span class="w">         </span>--go_out<span class="o">=</span>.<span class="w"> </span>--go_opt<span class="o">=</span><span class="nv">paths</span><span class="o">=</span>import<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--go-grpc_out<span class="o">=</span>.<span class="w"> </span>--go-grpc_opt<span class="o">=</span><span class="nv">paths</span><span class="o">=</span>import<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>bentoml/grpc/v1/service.proto
</pre></div>
</div>
<p>Then run the following to make sure the generated stubs are importable:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span><span class="nb">pushd</span><span class="w"> </span>github.com/bentoml/bentoml/grpc/v1
Â»<span class="w"> </span>go<span class="w"> </span>mod<span class="w"> </span>init<span class="w"> </span>v1<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>go<span class="w"> </span>mod<span class="w"> </span>tidy
Â»<span class="w"> </span><span class="nb">popd</span>
</pre></div>
</div>
</div>
</div>
<p>Create a <code class="docutils literal notranslate"><span class="pre">client.go</span></code> file with the following content:</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text"><cite>client.go</cite></span><a class="headerlink" href="#id12" title="Permalink to this code">#</a></div>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">	</span><span class="s">"context"</span>
<span class="w">	</span><span class="s">"fmt"</span>
<span class="w">	</span><span class="s">"time"</span>

<span class="w">	</span><span class="nx">pb</span><span class="w"> </span><span class="s">"github.com/bentoml/bentoml/grpc/v1"</span>

<span class="w">	</span><span class="s">"google.golang.org/grpc"</span>
<span class="w">	</span><span class="s">"google.golang.org/grpc/credentials/insecure"</span>
<span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">opts</span><span class="w"> </span><span class="p">[]</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">DialOption</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">serverAddr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">"localhost:3000"</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="nx">opts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">opts</span><span class="p">,</span><span class="w"> </span><span class="nx">grpc</span><span class="p">.</span><span class="nx">WithTransportCredentials</span><span class="p">(</span><span class="nx">insecure</span><span class="p">.</span><span class="nx">NewCredentials</span><span class="p">()))</span>
<span class="w">	</span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">grpc</span><span class="p">.</span><span class="nx">Dial</span><span class="p">(</span><span class="nx">serverAddr</span><span class="p">,</span><span class="w"> </span><span class="nx">opts</span><span class="o">...</span><span class="p">)</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="k">defer</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<span class="w">	</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithTimeout</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="mi">10</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="w">	</span><span class="k">defer</span><span class="w"> </span><span class="nx">cancel</span><span class="p">()</span>

<span class="w">	</span><span class="nx">client</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pb</span><span class="p">.</span><span class="nx">NewBentoServiceClient</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>

<span class="w">	</span><span class="nx">req</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">Request</span><span class="p">{</span>
<span class="w">		</span><span class="nx">ApiName</span><span class="p">:</span><span class="w"> </span><span class="s">"classify"</span><span class="p">,</span>
<span class="w">		</span><span class="nx">Content</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">Request_Ndarray</span><span class="p">{</span>
<span class="w">			</span><span class="nx">Ndarray</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">NDArray</span><span class="p">{</span>
<span class="w">				</span><span class="nx">Dtype</span><span class="p">:</span><span class="w">       </span><span class="o">*</span><span class="nx">pb</span><span class="p">.</span><span class="nx">NDArray_DTYPE_FLOAT</span><span class="p">.</span><span class="nx">Enum</span><span class="p">(),</span>
<span class="w">				</span><span class="nx">Shape</span><span class="p">:</span><span class="w">       </span><span class="p">[]</span><span class="kt">int32</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">},</span>
<span class="w">				</span><span class="nx">FloatValues</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">float32</span><span class="p">{</span><span class="mf">3.5</span><span class="p">,</span><span class="w"> </span><span class="mf">2.4</span><span class="p">,</span><span class="w"> </span><span class="mf">7.8</span><span class="p">,</span><span class="w"> </span><span class="mf">5.1</span><span class="p">},</span>
<span class="w">			</span><span class="p">},</span>
<span class="w">		</span><span class="p">},</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">Call</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="p">)</span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">	</span><span class="p">}</span>
<span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<input id="sd-tab-item-8" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" data-sync-id="cpp" for="sd-tab-item-8">
C++</label><div class="sd-tab-content docutils">
<p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Requirements:</span> Make sure follow the <a class="reference external" href="https://grpc.io/docs/languages/cpp/quickstart/#install-grpc">instructions</a> to install gRPC and Protobuf locally.</p>
<p>We will create our C++ client in the directory <code class="docutils literal notranslate"><span class="pre">~/workspace/iris_cc_client/</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>~/workspace/iris_cc_client
Â»<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/workspace/iris_cc_client
</pre></div>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-16" name="sd-tab-set-5" type="radio">
<label class="sd-tab-label" data-sync-id="bazel-workflow" for="sd-tab-item-16">
Using bazel (recommended)</label><div class="sd-tab-content docutils">
<p>Define a <a class="reference external" href="https://bazel.build/concepts/build-ref"><code class="docutils literal notranslate"><span class="pre">WORKSPACE</span></code></a> file:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-code" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z"></path></svg></span><code class="docutils literal notranslate"><span class="pre">WORKSPACE</span></code><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">workspace</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"iris_cc_client"</span><span class="p">)</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@bazel_tools//tools/build_defs/repo:http.bzl"</span><span class="p">,</span> <span class="s2">"http_archive"</span><span class="p">)</span>

<span class="n">http_archive</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"rules_proto"</span><span class="p">,</span>
    <span class="n">sha256</span> <span class="o">=</span> <span class="s2">"e017528fd1c91c5a33f15493e3a398181a9e821a804eb7ff5acdd1d2d6c2b18d"</span><span class="p">,</span>
    <span class="n">strip_prefix</span> <span class="o">=</span> <span class="s2">"rules_proto-4.0.0-3.20.0"</span><span class="p">,</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"https://github.com/bazelbuild/rules_proto/archive/refs/tags/4.0.0-3.20.0.tar.gz"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">http_archive</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"rules_proto_grpc"</span><span class="p">,</span>
    <span class="n">sha256</span> <span class="o">=</span> <span class="s2">"507e38c8d95c7efa4f3b1c0595a8e8f139c885cb41a76cab7e20e4e67ae87731"</span><span class="p">,</span>
    <span class="n">strip_prefix</span> <span class="o">=</span> <span class="s2">"rules_proto_grpc-4.1.1"</span><span class="p">,</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"https://github.com/rules-proto-grpc/rules_proto_grpc/archive/4.1.1.tar.gz"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@rules_proto//proto:repositories.bzl"</span><span class="p">,</span> <span class="s2">"rules_proto_dependencies"</span><span class="p">,</span> <span class="s2">"rules_proto_toolchains"</span><span class="p">)</span>

<span class="n">rules_proto_dependencies</span><span class="p">()</span>

<span class="n">rules_proto_toolchains</span><span class="p">()</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@rules_proto_grpc//:repositories.bzl"</span><span class="p">,</span> <span class="s2">"rules_proto_grpc_repos"</span><span class="p">,</span> <span class="s2">"rules_proto_grpc_toolchains"</span><span class="p">)</span>

<span class="n">rules_proto_grpc_toolchains</span><span class="p">()</span>

<span class="n">rules_proto_grpc_repos</span><span class="p">()</span>

<span class="n">http_archive</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"com_github_grpc_grpc"</span><span class="p">,</span>
    <span class="n">strip_prefix</span> <span class="o">=</span> <span class="s2">"grpc-v1.49.1"</span><span class="p">,</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"https://github.com/grpc/grpc/archive/v1.49.1.tar.gz"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@com_github_grpc_grpc//bazel:grpc_deps.bzl"</span><span class="p">,</span> <span class="s2">"grpc_deps"</span><span class="p">)</span>

<span class="n">grpc_deps</span><span class="p">()</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@com_github_grpc_grpc//bazel:grpc_extra_deps.bzl"</span><span class="p">,</span> <span class="s2">"grpc_extra_deps"</span><span class="p">)</span>

<span class="n">grpc_extra_deps</span><span class="p">()</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@com_google_protobuf//:protobuf_deps.bzl"</span><span class="p">,</span> <span class="s2">"protobuf_deps"</span><span class="p">)</span>

<span class="n">protobuf_deps</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details><p>Followed by defining a <a class="reference external" href="https://bazel.build/concepts/build-files"><code class="docutils literal notranslate"><span class="pre">BUILD</span></code></a> file:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-code" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z"></path></svg></span><code class="docutils literal notranslate"><span class="pre">BUILD</span></code><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">load</span><span class="p">(</span><span class="s2">"@rules_proto//proto:defs.bzl"</span><span class="p">,</span> <span class="s2">"proto_library"</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span><span class="s2">"@rules_proto_grpc//cpp:defs.bzl"</span><span class="p">,</span> <span class="s2">"cc_grpc_library"</span><span class="p">,</span> <span class="s2">"cc_proto_library"</span><span class="p">)</span>

<span class="n">proto_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"service_v1_proto"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"bentoml/grpc/v1/service.proto"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"@com_google_protobuf//:struct_proto"</span><span class="p">,</span> <span class="s2">"@com_google_protobuf//:wrappers_proto"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">cc_proto_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"service_cc"</span><span class="p">,</span>
    <span class="n">protos</span> <span class="o">=</span> <span class="p">[</span><span class="s2">":service_v1_proto"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">cc_grpc_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"service_cc_grpc"</span><span class="p">,</span>
    <span class="n">protos</span> <span class="o">=</span> <span class="p">[</span><span class="s2">":service_v1_proto"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s2">":service_cc"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">cc_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"client_cc"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"client.cc"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">":service_cc_grpc"</span><span class="p">,</span>
        <span class="s2">"@com_github_grpc_grpc//:grpc++"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details></div>
<input id="sd-tab-item-17" name="sd-tab-set-5" type="radio">
<label class="sd-tab-label" data-sync-id="protoc-and-plugins" for="sd-tab-item-17">
Using protoc and language-specific plugins</label><div class="sd-tab-content docutils">
<p>Since there is no easy way to add additional proto files, we will have to clone some
repositories and copy the proto files into our project:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/protocolbuffers/protobuf">protocolbuffers/protobuf</a> - the official repository for the Protocol Buffers. We will need protobuf files that lives under <code class="docutils literal notranslate"><span class="pre">src/google/protobuf</span></code>:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>thirdparty<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>thirdparty
Â»<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="w"> </span><span class="m">1</span><span class="w"> </span>https://github.com/protocolbuffers/protobuf.git
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p><a class="reference external" href="https://github.com/bentoml/bentoml">bentoml/bentoml</a> - We need the <code class="docutils literal notranslate"><span class="pre">service.proto</span></code> under <code class="docutils literal notranslate"><span class="pre">bentoml/grpc/</span></code> to build the client, therefore, we will perform
a <a class="reference external" href="https://github.blog/2020-01-17-bring-your-monorepo-down-to-size-with-sparse-checkout/">sparse checkout</a> to only checkout <code class="docutils literal notranslate"><span class="pre">bentoml/grpc</span></code> directory:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>bentoml<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">pushd</span><span class="w"> </span>bentoml
Â»<span class="w"> </span>git<span class="w"> </span>init
Â»<span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>-f<span class="w"> </span>origin<span class="w"> </span>https://github.com/bentoml/BentoML.git
Â»<span class="w"> </span>git<span class="w"> </span>config<span class="w"> </span>core.sparseCheckout<span class="w"> </span><span class="nb">true</span>
Â»<span class="w"> </span>cat<span class="w"> </span><span class="s">&lt;&lt;EOT &gt;|.git/info/sparse-checkout</span>
<span class="s">src/bentoml/grpc</span>
<span class="s">EOT</span>
Â»<span class="w"> </span>git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>main<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>src/bentoml/grpc<span class="w"> </span>.
Â»<span class="w"> </span><span class="nb">popd</span>
</pre></div>
</div>
<p>Here is the <code class="docutils literal notranslate"><span class="pre">protoc</span></code> command to generate the gRPC C++ stubs:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>protoc<span class="w"> </span>-I<span class="w"> </span>.<span class="w"> </span>-I<span class="w"> </span>./thirdparty/protobuf/src<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--cpp_out<span class="o">=</span>.<span class="w"> </span>--grpc_out<span class="o">=</span>.<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--plugin<span class="o">=</span>protoc-gen-grpc<span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>grpc_cpp_plugin<span class="k">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">         </span>bentoml/grpc/v1/service.proto
</pre></div>
</div>
</div>
</div>
<p>Create a <code class="docutils literal notranslate"><span class="pre">client.cpp</span></code> file with the following content:</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text"><cite>client.cpp</cite></span><a class="headerlink" href="#id13" title="Permalink to this code">#</a></div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;array&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mutex&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;grpc/grpc.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;grpcpp/channel.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;grpcpp/client_context.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;grpcpp/create_channel.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;grpcpp/grpcpp.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;grpcpp/security/credentials.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">"bentoml/grpc/v1/service.grpc.pb.h"</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"bentoml/grpc/v1/service.pb.h"</span>

<span class="k">using</span><span class="w"> </span><span class="n">bentoml</span><span class="o">::</span><span class="n">grpc</span><span class="o">::</span><span class="n">v1</span><span class="o">::</span><span class="n">BentoService</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="n">bentoml</span><span class="o">::</span><span class="n">grpc</span><span class="o">::</span><span class="n">v1</span><span class="o">::</span><span class="n">NDArray</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="n">bentoml</span><span class="o">::</span><span class="n">grpc</span><span class="o">::</span><span class="n">v1</span><span class="o">::</span><span class="n">Request</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="n">bentoml</span><span class="o">::</span><span class="n">grpc</span><span class="o">::</span><span class="n">v1</span><span class="o">::</span><span class="n">Response</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="n">grpc</span><span class="o">::</span><span class="n">Channel</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="n">grpc</span><span class="o">::</span><span class="n">ClientAsyncResponseReader</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="n">grpc</span><span class="o">::</span><span class="n">ClientContext</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="n">grpc</span><span class="o">::</span><span class="n">Status</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">stubs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BentoService</span><span class="o">::</span><span class="n">NewStub</span><span class="p">(</span><span class="n">grpc</span><span class="o">::</span><span class="n">CreateChannel</span><span class="p">(</span>
<span class="w">        </span><span class="s">"localhost:3000"</span><span class="p">,</span><span class="w"> </span><span class="n">grpc</span><span class="o">::</span><span class="n">InsecureChannelCredentials</span><span class="p">()));</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">3.5</span><span class="p">,</span><span class="w"> </span><span class="mf">2.4</span><span class="p">,</span><span class="w"> </span><span class="mf">7.8</span><span class="p">,</span><span class="w"> </span><span class="mf">5.1</span><span class="p">};</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">};</span>

<span class="w">    </span><span class="n">Request</span><span class="w"> </span><span class="n">request</span><span class="p">;</span>
<span class="w">    </span><span class="n">request</span><span class="p">.</span><span class="n">set_api_name</span><span class="p">(</span><span class="s">"classify"</span><span class="p">);</span>

<span class="w">    </span><span class="n">NDArray</span><span class="w"> </span><span class="o">*</span><span class="n">ndarray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="n">mutable_ndarray</span><span class="p">();</span>
<span class="w">    </span><span class="n">ndarray</span><span class="o">-&gt;</span><span class="n">mutable_shape</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Assign</span><span class="p">(</span><span class="n">shape</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">shape</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
<span class="w">    </span><span class="n">ndarray</span><span class="o">-&gt;</span><span class="n">mutable_float_values</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Assign</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>

<span class="w">    </span><span class="n">Response</span><span class="w"> </span><span class="n">resp</span><span class="p">;</span>
<span class="w">    </span><span class="n">ClientContext</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Storage for the status of the RPC upon completion.</span>
<span class="w">    </span><span class="n">Status</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stubs</span><span class="o">-&gt;</span><span class="n">Call</span><span class="p">(</span><span class="o">&amp;</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">resp</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Act upon the status of the actual RPC.</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">.</span><span class="n">ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">status</span><span class="p">.</span><span class="n">error_code</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">": "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">status</span><span class="p">.</span><span class="n">error_message</span><span class="p">()</span>
<span class="w">                  </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">resp</span><span class="p">.</span><span class="n">has_ndarray</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Currently only accept output as NDArray."</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"response byte size: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">resp</span><span class="p">.</span><span class="n">ndarray</span><span class="p">().</span><span class="n">ByteSizeLong</span><span class="p">()</span>
<span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<input id="sd-tab-item-9" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" data-sync-id="java" for="sd-tab-item-9">
Java</label><div class="sd-tab-content docutils">
<p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Requirements:</span> Make sure to have <a class="reference external" href="https://jdk.java.net/">JDK&gt;=7</a>.</p>
<p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Optional:</span>  follow the <a class="reference external" href="https://github.com/grpc/grpc-java/tree/master/compiler">instructions</a> to install <code class="docutils literal notranslate"><span class="pre">protoc</span></code> plugin for gRPC Java if you plan to use <code class="docutils literal notranslate"><span class="pre">protoc</span></code> standalone.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Feel free to use any Java build tools of choice (Maven, Gradle, Bazel, etc.) to build and run the client you find fit.</p>
<p>In this tutorial we will be using <a class="reference external" href="https://bazel.build"><cite>bazel</cite></a>.</p>
</div>
<p>We will create our Java client in the directory <code class="docutils literal notranslate"><span class="pre">~/workspace/iris_java_client/</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>~/workspace/iris_java_client
Â»<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/workspace/iris_java_client
</pre></div>
</div>
<p>Create the client Java package (<code class="docutils literal notranslate"><span class="pre">com.client.BentoServiceClient</span></code>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>src/main/java/com/client
</pre></div>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-18" name="sd-tab-set-6" type="radio">
<label class="sd-tab-label" data-sync-id="bazel-workflow" for="sd-tab-item-18">
Using bazel (recommended)</label><div class="sd-tab-content docutils">
<p>Define a <a class="reference external" href="https://bazel.build/concepts/build-ref"><code class="docutils literal notranslate"><span class="pre">WORKSPACE</span></code></a> file:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-code" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z"></path></svg></span><code class="docutils literal notranslate"><span class="pre">WORKSPACE</span></code><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">workspace</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"iris_java_client"</span><span class="p">)</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@bazel_tools//tools/build_defs/repo:http.bzl"</span><span class="p">,</span> <span class="s2">"http_archive"</span><span class="p">)</span>

<span class="n">http_archive</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"rules_proto"</span><span class="p">,</span>
    <span class="n">sha256</span> <span class="o">=</span> <span class="s2">"e017528fd1c91c5a33f15493e3a398181a9e821a804eb7ff5acdd1d2d6c2b18d"</span><span class="p">,</span>
    <span class="n">strip_prefix</span> <span class="o">=</span> <span class="s2">"rules_proto-4.0.0-3.20.0"</span><span class="p">,</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"https://github.com/bazelbuild/rules_proto/archive/refs/tags/4.0.0-3.20.0.tar.gz"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">http_archive</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"rules_proto_grpc"</span><span class="p">,</span>
    <span class="n">sha256</span> <span class="o">=</span> <span class="s2">"507e38c8d95c7efa4f3b1c0595a8e8f139c885cb41a76cab7e20e4e67ae87731"</span><span class="p">,</span>
    <span class="n">strip_prefix</span> <span class="o">=</span> <span class="s2">"rules_proto_grpc-4.1.1"</span><span class="p">,</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"https://github.com/rules-proto-grpc/rules_proto_grpc/archive/4.1.1.tar.gz"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@rules_proto//proto:repositories.bzl"</span><span class="p">,</span> <span class="s2">"rules_proto_dependencies"</span><span class="p">,</span> <span class="s2">"rules_proto_toolchains"</span><span class="p">)</span>

<span class="n">rules_proto_dependencies</span><span class="p">()</span>

<span class="n">rules_proto_toolchains</span><span class="p">()</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@rules_proto_grpc//:repositories.bzl"</span><span class="p">,</span> <span class="s2">"rules_proto_grpc_repos"</span><span class="p">,</span> <span class="s2">"rules_proto_grpc_toolchains"</span><span class="p">)</span>

<span class="n">rules_proto_grpc_toolchains</span><span class="p">()</span>

<span class="n">rules_proto_grpc_repos</span><span class="p">()</span>

<span class="n">http_archive</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"com_github_grpc_grpc"</span><span class="p">,</span>
    <span class="n">strip_prefix</span> <span class="o">=</span> <span class="s2">"grpc-v1.48.1"</span><span class="p">,</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"https://github.com/grpc/grpc/archive/v1.48.1.tar.gz"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@com_github_grpc_grpc//bazel:grpc_deps.bzl"</span><span class="p">,</span> <span class="s2">"grpc_deps"</span><span class="p">)</span>

<span class="n">grpc_deps</span><span class="p">()</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@com_github_grpc_grpc//bazel:grpc_extra_deps.bzl"</span><span class="p">,</span> <span class="s2">"grpc_extra_deps"</span><span class="p">)</span>

<span class="n">grpc_extra_deps</span><span class="p">()</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@com_google_protobuf//:protobuf_deps.bzl"</span><span class="p">,</span> <span class="s2">"protobuf_deps"</span><span class="p">)</span>

<span class="n">protobuf_deps</span><span class="p">()</span>

<span class="c1"># We will be using 1.48.1 for grpc-java</span>
<span class="n">http_archive</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"io_grpc_grpc_java"</span><span class="p">,</span>
    <span class="n">sha256</span> <span class="o">=</span> <span class="s2">"88b12b2b4e0beb849eddde98d5373f2f932513229dbf9ec86cc8e4912fc75e79"</span><span class="p">,</span>
    <span class="n">strip_prefix</span> <span class="o">=</span> <span class="s2">"grpc-java-1.48.1"</span><span class="p">,</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"https://github.com/grpc/grpc-java/archive/v1.48.1.tar.gz"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">http_archive</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"rules_jvm_external"</span><span class="p">,</span>
    <span class="n">sha256</span> <span class="o">=</span> <span class="s2">"c21ce8b8c4ccac87c809c317def87644cdc3a9dd650c74f41698d761c95175f3"</span><span class="p">,</span>
    <span class="n">strip_prefix</span> <span class="o">=</span> <span class="s2">"rules_jvm_external-1498ac6ccd3ea9cdb84afed65aa257c57abf3e0a"</span><span class="p">,</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://github.com/bazelbuild/rules_jvm_external/archive/1498ac6ccd3ea9cdb84afed65aa257c57abf3e0a.zip"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@rules_jvm_external//:defs.bzl"</span><span class="p">,</span> <span class="s2">"maven_install"</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span><span class="s2">"@com_google_protobuf//:protobuf_deps.bzl"</span><span class="p">,</span> <span class="s2">"PROTOBUF_MAVEN_ARTIFACTS"</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span><span class="s2">"@io_grpc_grpc_java//:repositories.bzl"</span><span class="p">,</span> <span class="s2">"IO_GRPC_GRPC_JAVA_ARTIFACTS"</span><span class="p">,</span> <span class="s2">"IO_GRPC_GRPC_JAVA_OVERRIDE_TARGETS"</span><span class="p">,</span> <span class="s2">"grpc_java_repositories"</span><span class="p">)</span>

<span class="n">grpc_java_repositories</span><span class="p">()</span>

<span class="n">maven_install</span><span class="p">(</span>
    <span class="n">artifacts</span> <span class="o">=</span> <span class="n">IO_GRPC_GRPC_JAVA_ARTIFACTS</span> <span class="o">+</span> <span class="n">PROTOBUF_MAVEN_ARTIFACTS</span><span class="p">,</span>
    <span class="n">generate_compat_repositories</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">override_targets</span> <span class="o">=</span> <span class="n">IO_GRPC_GRPC_JAVA_OVERRIDE_TARGETS</span><span class="p">,</span>
    <span class="n">repositories</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"https://repo.maven.apache.org/maven2/"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@maven//:compat.bzl"</span><span class="p">,</span> <span class="s2">"compat_repositories"</span><span class="p">)</span>

<span class="n">compat_repositories</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details><p>Followed by defining a <a class="reference external" href="https://bazel.build/concepts/build-files"><code class="docutils literal notranslate"><span class="pre">BUILD</span></code></a> file:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-code" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z"></path></svg></span><code class="docutils literal notranslate"><span class="pre">BUILD</span></code><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">load</span><span class="p">(</span><span class="s2">"@rules_proto//proto:defs.bzl"</span><span class="p">,</span> <span class="s2">"proto_library"</span><span class="p">)</span>

<span class="n">proto_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"service_v1_proto"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"bentoml/grpc/v1/service.proto"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"@com_google_protobuf//:struct_proto"</span><span class="p">,</span>
        <span class="s2">"@com_google_protobuf//:wrappers_proto"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@io_grpc_grpc_java//:java_grpc_library.bzl"</span><span class="p">,</span> <span class="s2">"java_grpc_library"</span><span class="p">)</span>

<span class="n">java_proto_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"service_java"</span><span class="p">,</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s2">":service_v1_proto"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">java_grpc_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"service_java_grpc"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">":service_v1_proto"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s2">":service_java"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">java_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"java_library"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="n">glob</span><span class="p">([</span><span class="s2">"client/java/src/main/**/*.java"</span><span class="p">]),</span>
    <span class="n">runtime_deps</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"@io_grpc_grpc_java//netty"</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">":service_java"</span><span class="p">,</span>
        <span class="s2">":service_java_grpc"</span><span class="p">,</span>
        <span class="s2">"@com_google_protobuf//:protobuf_java"</span><span class="p">,</span>
        <span class="s2">"@com_google_protobuf//:protobuf_java_util"</span><span class="p">,</span>
        <span class="s2">"@io_grpc_grpc_java//api"</span><span class="p">,</span>
        <span class="s2">"@io_grpc_grpc_java//protobuf"</span><span class="p">,</span>
        <span class="s2">"@io_grpc_grpc_java//stub"</span><span class="p">,</span>
        <span class="s2">"@maven//:com_google_api_grpc_proto_google_common_protos"</span><span class="p">,</span>
        <span class="s2">"@maven//:com_google_code_findbugs_jsr305"</span><span class="p">,</span>
        <span class="s2">"@maven//:com_google_code_gson_gson"</span><span class="p">,</span>
        <span class="s2">"@maven//:com_google_guava_guava"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">java_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"client_java"</span><span class="p">,</span>
    <span class="n">main_class</span> <span class="o">=</span> <span class="s2">"com.client.BentoServiceClient"</span><span class="p">,</span>
    <span class="n">runtime_deps</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">":java_library"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details></div>
<input id="sd-tab-item-19" name="sd-tab-set-6" type="radio">
<label class="sd-tab-label" data-sync-id="protoc-and-plugins" for="sd-tab-item-19">
Using others build system</label><div class="sd-tab-content docutils">
<p>One simply canâ€™t manually running <code class="docutils literal notranslate"><span class="pre">javac</span></code> to compile the Java class, since
there are way too many dependencies to be resolved.</p>
<p>Provided below is an example of how one can use <a class="reference external" href="https://gradle.org/">gradle</a> to build the Java client.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>gradle<span class="w"> </span>init<span class="w"> </span>--project-dir<span class="w"> </span>.
</pre></div>
</div>
<p>The following <code class="docutils literal notranslate"><span class="pre">build.gradle</span></code> should be able to help you get started:</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">build.gradle</span><a class="headerlink" href="#id14" title="Permalink to this code">#</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>plugins {
    id 'application'
    // ASSUMES GRADLE 5.6 OR HIGHER. Use plugin version 0.8.10 with earlier gradle versions
    id 'com.google.protobuf' version '0.8.18'
    // Generate IntelliJ IDEA .idea &amp; .iml project files
    id 'idea'
}

repositories {
    // The google mirror is less flaky than mavenCentral()
    maven {
        url "https://maven-central.storage-download.googleapis.com/maven2/" 
    }
    mavenCentral()
    mavenLocal()
}

def grpcVersion = '1.48.1'
def protobufVersion = '3.19.4'
def protocVersion = protobufVersion

dependencies {
    // This dependency is used internally, and not exposed to consumers on their own compile classpath.
    implementation 'com.google.guava:guava:30.1.1-jre'
    implementation "io.grpc:grpc-protobuf:${grpcVersion}"
    implementation "io.grpc:grpc-stub:${grpcVersion}"
    compileOnly "org.apache.tomcat:annotations-api:6.0.53"

    // examples/advanced need this for JsonFormat
    implementation "com.google.protobuf:protobuf-java-util:${protobufVersion}"

    runtimeOnly "io.grpc:grpc-netty-shaded:${grpcVersion}"
}

protobuf {
    protoc { artifact = "com.google.protobuf:protoc:${protocVersion}" }
    plugins {
        grpc { artifact = "io.grpc:protoc-gen-grpc-java:${grpcVersion}" }
    }
    generateProtoTasks {
        all()*.plugins { grpc {} }
    }
}

// Inform IDEs like IntelliJ IDEA, Eclipse or NetBeans about the generated code.
sourceSets {
    main {
        java {
            srcDirs 'build/generated/source/proto/main/grpc'
            srcDirs 'build/generated/source/proto/main/java'
        }
    }
}

task bentoServiceClient(type: CreateStartScripts) {
    mainClass = 'com.client.BentoServiceClient'
    applicationName = 'bento-service-client'
    outputDir = new File(project.buildDir, 'tmp/scripts/' + name)
    classpath = startScripts.classpath
}

applicationDistribution.into('bin') {
    from(bentoServiceClient)
    fileMode = 0755
}
</pre></div>
</div>
</div>
<p>To build the client, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>./gradlew<span class="w"> </span>build
</pre></div>
</div>
</div>
</div>
<p>Proceed to create a <code class="docutils literal notranslate"><span class="pre">src/main/java/com/client/BentoServiceClient.java</span></code> file with the following content:</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text"><cite>BentoServiceClient.java</cite></span><a class="headerlink" href="#id15" title="Permalink to this code">#</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.client</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.Channel</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.ManagedChannel</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.ManagedChannelBuilder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.Status</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.StatusRuntimeException</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.TimeUnit</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.logging.Level</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.logging.Logger</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.bentoml.grpc.v1.BentoServiceGrpc</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.bentoml.grpc.v1.BentoServiceGrpc.BentoServiceBlockingStub</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.bentoml.grpc.v1.BentoServiceGrpc.BentoServiceStub</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.bentoml.grpc.v1.NDArray</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.bentoml.grpc.v1.Request</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.bentoml.grpc.v1.RequestOrBuilder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.bentoml.grpc.v1.Response</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BentoServiceClient</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Logger</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">BentoServiceClient</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>

<span class="w">  </span><span class="kd">static</span><span class="w"> </span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">convert</span><span class="p">(</span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">array</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="n">array</span><span class="p">).</span><span class="na">iterator</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">apiName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"classify"</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">shape</span><span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">shapeIterable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">convert</span><span class="p">(</span><span class="n">shape</span><span class="p">);</span>
<span class="w">    </span><span class="n">Float</span><span class="w"> </span><span class="n">array</span><span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">3.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">2.4f</span><span class="p">,</span><span class="w"> </span><span class="mf">7.8f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.1f</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">arrayIterable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">array</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Access a service running on the local machine on port 50051</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"localhost:3000"</span><span class="p">;</span>

<span class="w">    </span><span class="n">ManagedChannel</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ManagedChannelBuilder</span><span class="p">.</span><span class="na">forTarget</span><span class="p">(</span><span class="n">target</span><span class="p">).</span><span class="na">usePlaintext</span><span class="p">().</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">BentoServiceBlockingStub</span><span class="w"> </span><span class="n">blockingStub</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BentoServiceGrpc</span><span class="p">.</span><span class="na">newBlockingStub</span><span class="p">(</span><span class="n">channel</span><span class="p">);</span>

<span class="w">      </span><span class="n">NDArray</span><span class="p">.</span><span class="na">Builder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NDArray</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">().</span><span class="na">addAllShape</span><span class="p">(</span><span class="n">shapeIterable</span><span class="p">).</span><span class="na">addAllFloatValues</span><span class="p">(</span><span class="n">arrayIterable</span><span class="p">).</span><span class="na">setDtype</span><span class="p">(</span><span class="n">NDArray</span><span class="p">.</span><span class="na">DType</span><span class="p">.</span><span class="na">DTYPE_FLOAT</span><span class="p">);</span>

<span class="w">      </span><span class="n">Request</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Request</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">().</span><span class="na">setApiName</span><span class="p">(</span><span class="n">apiName</span><span class="p">).</span><span class="na">setNdarray</span><span class="p">(</span><span class="n">builder</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>

<span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Response</span><span class="w"> </span><span class="n">resp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">blockingStub</span><span class="p">.</span><span class="na">call</span><span class="p">(</span><span class="n">req</span><span class="p">);</span>
<span class="w">        </span><span class="n">Response</span><span class="p">.</span><span class="na">ContentCase</span><span class="w"> </span><span class="n">contentCase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resp</span><span class="p">.</span><span class="na">getContentCase</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">contentCase</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">Response</span><span class="p">.</span><span class="na">ContentCase</span><span class="p">.</span><span class="na">NDARRAY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Exception</span><span class="p">(</span><span class="s">"Currently only support NDArray response"</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">NDArray</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resp</span><span class="p">.</span><span class="na">getNdarray</span><span class="p">();</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">"Response: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">resp</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">StatusRuntimeException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">WARNING</span><span class="p">,</span><span class="w"> </span><span class="s">"RPC failed: {0}"</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// ManagedChannels use resources like threads and TCP connections. To prevent</span>
<span class="w">      </span><span class="c1">// leaking these</span>
<span class="w">      </span><span class="c1">// resources the channel should be shut down when it will no longer be used. If</span>
<span class="w">      </span><span class="c1">// it may be used</span>
<span class="w">      </span><span class="c1">// again leave it running.</span>
<span class="w">      </span><span class="n">channel</span><span class="p">.</span><span class="na">shutdownNow</span><span class="p">().</span><span class="na">awaitTermination</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-book" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M0 1.75A.75.75 0 01.75 1h4.253c1.227 0 2.317.59 3 1.501A3.744 3.744 0 0111.006 1h4.245a.75.75 0 01.75.75v10.5a.75.75 0 01-.75.75h-4.507a2.25 2.25 0 00-1.591.659l-.622.621a.75.75 0 01-1.06 0l-.622-.621A2.25 2.25 0 005.258 13H.75a.75.75 0 01-.75-.75V1.75zm8.755 3a2.25 2.25 0 012.25-2.25H14.5v9h-3.757c-.71 0-1.4.201-1.992.572l.004-7.322zm-1.504 7.324l.004-5.073-.002-2.253A2.25 2.25 0 005.003 2.5H1.5v9h3.757a3.75 3.75 0 011.994.574z"></path></svg></span>On running <code class="docutils literal notranslate"><span class="pre">protoc</span></code> standalone (optional)<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">Since there is no easy way to add additional proto files, we will have to clone some
repositories and copy the proto files into our project:</p>
<ol class="arabic simple">
<li><p class="sd-card-text"><a class="reference external" href="https://github.com/protocolbuffers/protobuf">protocolbuffers/protobuf</a> - the official repository for the Protocol Buffers. We will need protobuf files that lives under <code class="docutils literal notranslate"><span class="pre">src/google/protobuf</span></code>:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>thirdparty<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>thirdparty
Â»<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="w"> </span><span class="m">1</span><span class="w"> </span>https://github.com/protocolbuffers/protobuf.git
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p class="sd-card-text"><a class="reference external" href="https://github.com/bentoml/bentoml">bentoml/bentoml</a> - We need the <code class="docutils literal notranslate"><span class="pre">service.proto</span></code> under <code class="docutils literal notranslate"><span class="pre">bentoml/grpc/</span></code> to build the client, therefore, we will perform
a <a class="reference external" href="https://github.blog/2020-01-17-bring-your-monorepo-down-to-size-with-sparse-checkout/">sparse checkout</a> to only checkout <code class="docutils literal notranslate"><span class="pre">bentoml/grpc</span></code> directory:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>bentoml<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">pushd</span><span class="w"> </span>bentoml
Â»<span class="w"> </span>git<span class="w"> </span>init
Â»<span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>-f<span class="w"> </span>origin<span class="w"> </span>https://github.com/bentoml/BentoML.git
Â»<span class="w"> </span>git<span class="w"> </span>config<span class="w"> </span>core.sparseCheckout<span class="w"> </span><span class="nb">true</span>
Â»<span class="w"> </span>cat<span class="w"> </span><span class="s">&lt;&lt;EOT &gt;|.git/info/sparse-checkout</span>
<span class="s">src/bentoml/grpc</span>
<span class="s">EOT</span>
Â»<span class="w"> </span>git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>main<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>src/bentoml/grpc<span class="w"> </span>.
Â»<span class="w"> </span><span class="nb">popd</span>
</pre></div>
</div>
<p class="sd-card-text">Here is the <code class="docutils literal notranslate"><span class="pre">protoc</span></code> command to generate the gRPC Java stubs if you need to use <code class="docutils literal notranslate"><span class="pre">protoc</span></code> standalone:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>protoc<span class="w"> </span>-I<span class="w"> </span>.<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>-I<span class="w"> </span>./thirdparty/protobuf/src<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--java_out<span class="o">=</span>./src/main/java<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--grpc-java_out<span class="o">=</span>./src/main/java<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>bentoml/grpc/v1/service.proto
</pre></div>
</div>
</div>
</details></div>
<input id="sd-tab-item-10" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" data-sync-id="kotlin" for="sd-tab-item-10">
Kotlin</label><div class="sd-tab-content docutils">
<p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Requirements:</span> Make sure to have the <a class="reference external" href="https://grpc.io/docs/languages/kotlin/quickstart/#prerequisites">prequisites</a> to get started with <a class="reference external" href="https://github.com/grpc/grpc-kotlin">grpc/grpc-kotlin</a>.</p>
<p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Optional:</span> feel free to install <a class="reference external" href="https://github.com/grpc/grpc-kotlin/blob/master/compiler/README.md">Kotlin gRPC codegen</a> in order to generate gRPC stubs if you plan to use <code class="docutils literal notranslate"><span class="pre">protoc</span></code> standalone.</p>
<p>To bootstrap the Kotlin client, feel free to use either <a class="reference external" href="https://gradle.org/">gradle</a> or
<a class="reference external" href="https://maven.apache.org/">maven</a> to build and run the following client code.</p>
<p>In this example, we will use <a class="reference external" href="https://bazel.build"><cite>bazel</cite></a> to build and run the client.</p>
<p>We will create our Kotlin client in the directory <code class="docutils literal notranslate"><span class="pre">~/workspace/iris_kotlin_client/</span></code>, followed by creating the client directory structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>~/workspace/iris_kotlin_client
Â»<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/workspace/iris_kotlin_client
Â»<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>src/main/kotlin/com/client
</pre></div>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-20" name="sd-tab-set-7" type="radio">
<label class="sd-tab-label" data-sync-id="bazel-workflow" for="sd-tab-item-20">
Using bazel (recommended)</label><div class="sd-tab-content docutils">
<p>Define a <a class="reference external" href="https://bazel.build/concepts/build-ref"><code class="docutils literal notranslate"><span class="pre">WORKSPACE</span></code></a> file:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<code class="docutils literal notranslate"><span class="pre">WORKSPACE</span></code><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">workspace</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"iris_kotlin_client"</span><span class="p">)</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@bazel_tools//tools/build_defs/repo:http.bzl"</span><span class="p">,</span> <span class="s2">"http_archive"</span><span class="p">)</span>

<span class="n">http_archive</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"rules_proto"</span><span class="p">,</span>
    <span class="n">sha256</span> <span class="o">=</span> <span class="s2">"e017528fd1c91c5a33f15493e3a398181a9e821a804eb7ff5acdd1d2d6c2b18d"</span><span class="p">,</span>
    <span class="n">strip_prefix</span> <span class="o">=</span> <span class="s2">"rules_proto-4.0.0-3.20.0"</span><span class="p">,</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"https://github.com/bazelbuild/rules_proto/archive/refs/tags/4.0.0-3.20.0.tar.gz"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">http_archive</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"rules_proto_grpc"</span><span class="p">,</span>
    <span class="n">sha256</span> <span class="o">=</span> <span class="s2">"507e38c8d95c7efa4f3b1c0595a8e8f139c885cb41a76cab7e20e4e67ae87731"</span><span class="p">,</span>
    <span class="n">strip_prefix</span> <span class="o">=</span> <span class="s2">"rules_proto_grpc-4.1.1"</span><span class="p">,</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"https://github.com/rules-proto-grpc/rules_proto_grpc/archive/4.1.1.tar.gz"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@rules_proto//proto:repositories.bzl"</span><span class="p">,</span> <span class="s2">"rules_proto_dependencies"</span><span class="p">,</span> <span class="s2">"rules_proto_toolchains"</span><span class="p">)</span>

<span class="n">rules_proto_dependencies</span><span class="p">()</span>

<span class="n">rules_proto_toolchains</span><span class="p">()</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@rules_proto_grpc//:repositories.bzl"</span><span class="p">,</span> <span class="s2">"rules_proto_grpc_repos"</span><span class="p">,</span> <span class="s2">"rules_proto_grpc_toolchains"</span><span class="p">)</span>

<span class="n">rules_proto_grpc_toolchains</span><span class="p">()</span>

<span class="n">rules_proto_grpc_repos</span><span class="p">()</span>

<span class="c1"># We will be using 1.48.1 for grpc-java</span>
<span class="n">http_archive</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"io_grpc_grpc_java"</span><span class="p">,</span>
    <span class="n">sha256</span> <span class="o">=</span> <span class="s2">"88b12b2b4e0beb849eddde98d5373f2f932513229dbf9ec86cc8e4912fc75e79"</span><span class="p">,</span>
    <span class="n">strip_prefix</span> <span class="o">=</span> <span class="s2">"grpc-java-1.48.1"</span><span class="p">,</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"https://github.com/grpc/grpc-java/archive/v1.48.1.tar.gz"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">http_archive</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"rules_jvm_external"</span><span class="p">,</span>
    <span class="n">sha256</span> <span class="o">=</span> <span class="s2">"c21ce8b8c4ccac87c809c317def87644cdc3a9dd650c74f41698d761c95175f3"</span><span class="p">,</span>
    <span class="n">strip_prefix</span> <span class="o">=</span> <span class="s2">"rules_jvm_external-1498ac6ccd3ea9cdb84afed65aa257c57abf3e0a"</span><span class="p">,</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://github.com/bazelbuild/rules_jvm_external/archive/1498ac6ccd3ea9cdb84afed65aa257c57abf3e0a.zip"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@rules_jvm_external//:defs.bzl"</span><span class="p">,</span> <span class="s2">"maven_install"</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span><span class="s2">"@io_grpc_grpc_java//:repositories.bzl"</span><span class="p">,</span> <span class="s2">"IO_GRPC_GRPC_JAVA_ARTIFACTS"</span><span class="p">,</span> <span class="s2">"IO_GRPC_GRPC_JAVA_OVERRIDE_TARGETS"</span><span class="p">,</span> <span class="s2">"grpc_java_repositories"</span><span class="p">)</span>

<span class="n">IO_GRPC_GRPC_KOTLIN_ARTIFACTS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">"com.google.guava:guava:29.0-android"</span><span class="p">,</span>
    <span class="s2">"com.squareup:kotlinpoet:1.11.0"</span><span class="p">,</span>
    <span class="s2">"org.jetbrains.kotlinx:kotlinx-coroutines-core:1.6.2"</span><span class="p">,</span>
    <span class="s2">"org.jetbrains.kotlinx:kotlinx-coroutines-core-jvm:1.6.2"</span><span class="p">,</span>
    <span class="s2">"org.jetbrains.kotlinx:kotlinx-coroutines-debug:1.6.2"</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">maven_install</span><span class="p">(</span>
    <span class="n">artifacts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"com.google.jimfs:jimfs:1.1"</span><span class="p">,</span>
        <span class="s2">"com.google.truth.extensions:truth-proto-extension:1.0.1"</span><span class="p">,</span>
        <span class="s2">"com.google.protobuf:protobuf-kotlin:3.18.0"</span><span class="p">,</span>
    <span class="p">]</span> <span class="o">+</span> <span class="n">IO_GRPC_GRPC_KOTLIN_ARTIFACTS</span> <span class="o">+</span> <span class="n">IO_GRPC_GRPC_JAVA_ARTIFACTS</span><span class="p">,</span>
    <span class="n">generate_compat_repositories</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">override_targets</span> <span class="o">=</span> <span class="n">IO_GRPC_GRPC_JAVA_OVERRIDE_TARGETS</span><span class="p">,</span>
    <span class="n">repositories</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"https://repo.maven.apache.org/maven2/"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@maven//:compat.bzl"</span><span class="p">,</span> <span class="s2">"compat_repositories"</span><span class="p">)</span>

<span class="n">compat_repositories</span><span class="p">()</span>

<span class="n">grpc_java_repositories</span><span class="p">()</span>

<span class="c1"># loading kotlin rules</span>
<span class="c1"># first to load grpc/grpc-kotlin</span>
<span class="n">http_archive</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"com_github_grpc_grpc_kotlin"</span><span class="p">,</span>
    <span class="n">sha256</span> <span class="o">=</span> <span class="s2">"b1ec1caa5d81f4fa4dca0662f8112711c82d7db6ba89c928ca7baa4de50afbb2"</span><span class="p">,</span>
    <span class="n">strip_prefix</span> <span class="o">=</span> <span class="s2">"grpc-kotlin-a1659c1b3fb665e01a6854224c7fdcafc8e54d56"</span><span class="p">,</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"https://github.com/grpc/grpc-kotlin/archive/a1659c1b3fb665e01a6854224c7fdcafc8e54d56.tar.gz"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">http_archive</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"io_bazel_rules_kotlin"</span><span class="p">,</span>
    <span class="n">sha256</span> <span class="o">=</span> <span class="s2">"a57591404423a52bd6b18ebba7979e8cd2243534736c5c94d35c89718ea38f94"</span><span class="p">,</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"https://github.com/bazelbuild/rules_kotlin/releases/download/v1.6.0/rules_kotlin_release.tgz"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@io_bazel_rules_kotlin//kotlin:repositories.bzl"</span><span class="p">,</span> <span class="s2">"kotlin_repositories"</span><span class="p">)</span>

<span class="n">kotlin_repositories</span><span class="p">()</span>

<span class="n">load</span><span class="p">(</span><span class="s2">"@io_bazel_rules_kotlin//kotlin:core.bzl"</span><span class="p">,</span> <span class="s2">"kt_register_toolchains"</span><span class="p">)</span>

<span class="n">kt_register_toolchains</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details><p>Followed by defining a <a class="reference external" href="https://bazel.build/concepts/build-files"><code class="docutils literal notranslate"><span class="pre">BUILD</span></code></a> file:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<code class="docutils literal notranslate"><span class="pre">BUILD</span></code><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">load</span><span class="p">(</span><span class="s2">"@io_bazel_rules_kotlin//kotlin:jvm.bzl"</span><span class="p">,</span> <span class="s2">"kt_jvm_binary"</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span><span class="s2">"@io_grpc_grpc_java//:java_grpc_library.bzl"</span><span class="p">,</span> <span class="s2">"java_grpc_library"</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span><span class="s2">"@com_github_grpc_grpc_kotlin//:kt_jvm_grpc.bzl"</span><span class="p">,</span> <span class="s2">"kt_jvm_grpc_library"</span><span class="p">,</span> <span class="s2">"kt_jvm_proto_library"</span><span class="p">)</span>

<span class="n">java_proto_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"service_java"</span><span class="p">,</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"//:service_v1_proto"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">kt_jvm_proto_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"service_kt"</span><span class="p">,</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"//:service_v1_proto"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">kt_jvm_grpc_library</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"service_grpc_kt"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"//:service_v1_proto"</span><span class="p">],</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s2">":service_java"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">kt_jvm_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"client_kt"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"src/main/kotlin/com/client/BentoServiceClient.kt"</span><span class="p">],</span>
    <span class="n">main_class</span> <span class="o">=</span> <span class="s2">"com.client.BentoServiceClient"</span><span class="p">,</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">":service_grpc_kt"</span><span class="p">,</span>
        <span class="s2">":service_kt"</span><span class="p">,</span>
        <span class="s2">"@com_google_protobuf//:protobuf_java_util"</span><span class="p">,</span>
        <span class="s2">"@io_grpc_grpc_java//netty"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details></div>
<input id="sd-tab-item-21" name="sd-tab-set-7" type="radio">
<label class="sd-tab-label" data-sync-id="protoc-and-plugins" for="sd-tab-item-21">
Using others build system</label><div class="sd-tab-content docutils">
<p>One simply canâ€™t manually compile all the Kotlin files, since there are way too many dependencies to be resolved.</p>
<p>Provided below is an example of how one can use <a class="reference external" href="https://gradle.org/">gradle</a> to build the Kotlin client.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>gradle<span class="w"> </span>init<span class="w"> </span>--project-dir<span class="w"> </span>.
</pre></div>
</div>
<p>The following <code class="docutils literal notranslate"><span class="pre">build.gradle.kts</span></code> should be able to help you get started:</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">build.gradle.kts</span><a class="headerlink" href="#id16" title="Permalink to this code">#</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>plugins {
    id("com.android.application") version "7.0.4" apply false // Older for IntelliJ Support
    id("com.google.protobuf") version "0.8.18" apply false
    kotlin("jvm") version "1.7.0" apply false
    id("org.jlleitschuh.gradle.ktlint") version "10.2.0"
    `java-library`
}

ext["grpcVersion"] = "1.48.0"
ext["grpcKotlinVersion"] = "1.6.0" // CURRENT_GRPC_KOTLIN_VERSION
ext["protobufVersion"] = "3.19.4"
ext["coroutinesVersion"] = "1.6.2"

allprojects {
    repositories {
        mavenLocal()
        mavenCentral()
        google()
    }

    apply(plugin = "org.jlleitschuh.gradle.ktlint")
}

java {
    toolchain {
        languageVersion.set(JavaLanguageVersion.of(8))
    }
    sourceSets.getByName("main").resources.srcDir("src/main/proto")
}

dependencies {
    implementation(platform("org.jetbrains.kotlin:kotlin-bom"))

    implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")

    implementation("com.google.guava:guava:30.1.1-jre")

    runtimeOnly("io.grpc:grpc-netty:${rootProject.ext["grpcVersion"]}")
    api(kotlin("stdlib-jdk8"))
    api("org.jetbrains.kolinx:kotlinx-coroutines-core:${rootProject.ext["coroutinesVersion"]}")
    api("io.grpc:grpc-stub:${rootProject.ext["grpcVersion"]}")
    api("io.grpc:grpc-protobuf:${rootProject.ext["grpcVersion"]}")
    api("com.google.protobuf:protobuf-java-util:${rootProject.ext["protobufVersion"]}")
    api("com.google.protobuf:protobuf-kotlin:${rootProject.ext["protobufVersion"]}")
    api("io.grpc:grpc-kotlin-stub:${rootProject.ext["grpcKotlinVersion"]}")
}

tasks.register&lt;JavaExec&gt;("BentoServiceClient") {
    dependsOn("classes")
    classpath = sourceSets["main"].runtimeClasspath
    mainClass.set("com.client.BentoServiceClientKt")
}

val bentoServiceClientStartScripts = tasks.register&lt;CreateStartScripts&gt;("bentoServiceClientStartScripts") {
    mainClass.set("com.client.BentoServiceClientKt")
    applicationName = "bento-service-client"
    outputDir = tasks.named&lt;CreateStartScripts&gt;("startScripts").get().outputDir
    classpath = tasks.named&lt;CreateStartScripts&gt;("startScripts").get().classpath
}

tasks.named("startScripts") {
    dependsOn(bentoServiceClientStartScripts)
}
</pre></div>
</div>
</div>
<p>To build the client, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>./gradlew<span class="w"> </span>build
</pre></div>
</div>
</div>
</div>
<p>Proceed to create a <code class="docutils literal notranslate"><span class="pre">src/main/kotlin/com/client/BentoServiceClient.kt</span></code> file with the following content:</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text"><cite>BentoServiceClient.kt</cite></span><a class="headerlink" href="#id17" title="Permalink to this code">#</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">com.client</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.bentoml.grpc.v1.BentoServiceGrpc</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.bentoml.grpc.v1.NDArray</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.bentoml.grpc.v1.Request</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.ManagedChannelBuilder</span>

<span class="kd">class</span> <span class="nc">BentoServiceClient</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">companion</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@JvmStatic</span>
<span class="w">    </span><span class="n">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">val</span><span class="w"> </span><span class="n">apiName</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"classify"</span>
<span class="w">      </span><span class="n">val</span><span class="w"> </span><span class="n">shape</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Int</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listOf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="w">      </span><span class="n">val</span><span class="w"> </span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listOf</span><span class="p">(</span><span class="mf">3.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">2.4f</span><span class="p">,</span><span class="w"> </span><span class="mf">7.8f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.1f</span><span class="p">)</span>

<span class="w">      </span><span class="n">val</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ManagedChannelBuilder</span><span class="p">.</span><span class="na">forAddress</span><span class="p">(</span><span class="s">"localhost"</span><span class="p">,</span><span class="w"> </span><span class="mi">3000</span><span class="p">).</span><span class="na">usePlaintext</span><span class="p">().</span><span class="na">build</span><span class="p">()</span>

<span class="w">      </span><span class="n">val</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BentoServiceGrpc</span><span class="p">.</span><span class="na">newBlockingStub</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>

<span class="w">      </span><span class="n">val</span><span class="w"> </span><span class="n">ndarray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NDArray</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">().</span><span class="na">addAllShape</span><span class="p">(</span><span class="n">shape</span><span class="p">).</span><span class="na">addAllFloatValues</span><span class="p">(</span><span class="n">data</span><span class="p">).</span><span class="na">build</span><span class="p">()</span>
<span class="w">      </span><span class="n">val</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Request</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">().</span><span class="na">setApiName</span><span class="p">(</span><span class="n">apiName</span><span class="p">).</span><span class="na">setNdarray</span><span class="p">(</span><span class="n">ndarray</span><span class="p">).</span><span class="na">build</span><span class="p">()</span>
<span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="n">resp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="na">call</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">resp</span><span class="p">.</span><span class="na">hasNdarray</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">println</span><span class="p">(</span><span class="s">"Currently only support NDArray response."</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">println</span><span class="p">(</span><span class="s">"Response: ${resp.ndarray}"</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">"Rpc error: ${e.message}"</span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-book" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M0 1.75A.75.75 0 01.75 1h4.253c1.227 0 2.317.59 3 1.501A3.744 3.744 0 0111.006 1h4.245a.75.75 0 01.75.75v10.5a.75.75 0 01-.75.75h-4.507a2.25 2.25 0 00-1.591.659l-.622.621a.75.75 0 01-1.06 0l-.622-.621A2.25 2.25 0 005.258 13H.75a.75.75 0 01-.75-.75V1.75zm8.755 3a2.25 2.25 0 012.25-2.25H14.5v9h-3.757c-.71 0-1.4.201-1.992.572l.004-7.322zm-1.504 7.324l.004-5.073-.002-2.253A2.25 2.25 0 005.003 2.5H1.5v9h3.757a3.75 3.75 0 011.994.574z"></path></svg></span>On running <code class="docutils literal notranslate"><span class="pre">protoc</span></code> standalone (optional)<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">Since there is no easy way to add additional proto files, we will have to clone some
repositories and copy the proto files into our project:</p>
<ol class="arabic simple">
<li><p class="sd-card-text"><a class="reference external" href="https://github.com/protocolbuffers/protobuf">protocolbuffers/protobuf</a> - the official repository for the Protocol Buffers. We will need protobuf files that lives under <code class="docutils literal notranslate"><span class="pre">src/google/protobuf</span></code>:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>thirdparty<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>thirdparty
Â»<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="w"> </span><span class="m">1</span><span class="w"> </span>https://github.com/protocolbuffers/protobuf.git
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p class="sd-card-text"><a class="reference external" href="https://github.com/bentoml/bentoml">bentoml/bentoml</a> - We need the <code class="docutils literal notranslate"><span class="pre">service.proto</span></code> under <code class="docutils literal notranslate"><span class="pre">bentoml/grpc/</span></code> to build the client, therefore, we will perform
a <a class="reference external" href="https://github.blog/2020-01-17-bring-your-monorepo-down-to-size-with-sparse-checkout/">sparse checkout</a> to only checkout <code class="docutils literal notranslate"><span class="pre">bentoml/grpc</span></code> directory:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>bentoml<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">pushd</span><span class="w"> </span>bentoml
Â»<span class="w"> </span>git<span class="w"> </span>init
Â»<span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>-f<span class="w"> </span>origin<span class="w"> </span>https://github.com/bentoml/BentoML.git
Â»<span class="w"> </span>git<span class="w"> </span>config<span class="w"> </span>core.sparseCheckout<span class="w"> </span><span class="nb">true</span>
Â»<span class="w"> </span>cat<span class="w"> </span><span class="s">&lt;&lt;EOT &gt;|.git/info/sparse-checkout</span>
<span class="s">src/bentoml/grpc</span>
<span class="s">EOT</span>
Â»<span class="w"> </span>git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>main<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>src/bentoml/grpc<span class="w"> </span>.
Â»<span class="w"> </span><span class="nb">popd</span>
</pre></div>
</div>
<p class="sd-card-text">Here is the <code class="docutils literal notranslate"><span class="pre">protoc</span></code> command to generate the gRPC Kotlin stubs if you need to use <code class="docutils literal notranslate"><span class="pre">protoc</span></code> standalone:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>protoc<span class="w"> </span>-I.<span class="w"> </span>-I<span class="w"> </span>./thirdparty/protobuf/src<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--kotlin_out<span class="w"> </span>./kotlin/src/main/kotlin/<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--grpc-kotlin_out<span class="w"> </span>./kotlin/src/main/kotlin<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--plugin<span class="o">=</span>protoc-gen-grpc-kotlin<span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>protoc-gen-grpc-kotlin<span class="k">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">         </span>bentoml/grpc/v1/service.proto
</pre></div>
</div>
</div>
</details></div>
<input id="sd-tab-item-11" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" data-sync-id="nodejs" for="sd-tab-item-11">
Node.js</label><div class="sd-tab-content docutils">
<p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Requirements:</span> Make sure to have <a class="reference external" href="https://nodejs.org/en/">Node.js</a>
installed in your system.</p>
<p>We will create our Node.js client in the directory <code class="docutils literal notranslate"><span class="pre">~/workspace/iris_node_client/</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>~/workspace/iris_node_client
Â»<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/workspace/iris_node_client
</pre></div>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Initialize the project and use the following <code class="docutils literal notranslate"><span class="pre">package.json</span></code>:<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text"><cite>package.json</cite></span><a class="headerlink" href="#id18" title="Permalink to this code">#</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"grpc_client_js"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gRPC client in JavaScript"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"main"</span><span class="p">:</span><span class="w"> </span><span class="s2">"client.js"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"keywords"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nt">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BentoML Team"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"license"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Apache-2.0"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"@grpc/grpc-js"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.7.1"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"google-protobuf"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.21.0"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"grpc-tools"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.11.2"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"ts-protoc-gen"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.15.0"</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">    </span><span class="nt">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"compile"</span><span class="p">:</span><span class="w"> </span><span class="s2">"npm_config_target_arch=x64 yarn &amp;&amp; bash -x ./hack"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"client"</span><span class="p">:</span><span class="w"> </span><span class="s2">"yarn compile &amp;&amp; node client.js"</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</details><p>Install the dependencies with either <code class="docutils literal notranslate"><span class="pre">npm</span></code> or <code class="docutils literal notranslate"><span class="pre">yarn</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>yarn<span class="w"> </span>install<span class="w"> </span>--add-devs
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are using M1, you might also have to prepend <code class="docutils literal notranslate"><span class="pre">npm_config_target_arch=x64</span></code> to <code class="docutils literal notranslate"><span class="pre">yarn</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span><span class="nv">npm_config_target_arch</span><span class="o">=</span>x64<span class="w"> </span>yarn<span class="w"> </span>install<span class="w"> </span>--add-devs
</pre></div>
</div>
</div>
<p>Since there is no easy way to add additional proto files, we will have to clone some
repositories and copy the proto files into our project:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/protocolbuffers/protobuf">protocolbuffers/protobuf</a> - the official repository for the Protocol Buffers. We will need protobuf files that lives under <code class="docutils literal notranslate"><span class="pre">src/google/protobuf</span></code>:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>thirdparty<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>thirdparty
Â»<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="w"> </span><span class="m">1</span><span class="w"> </span>https://github.com/protocolbuffers/protobuf.git
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p><a class="reference external" href="https://github.com/bentoml/bentoml">bentoml/bentoml</a> - We need the <code class="docutils literal notranslate"><span class="pre">service.proto</span></code> under <code class="docutils literal notranslate"><span class="pre">bentoml/grpc/</span></code> to build the client, therefore, we will perform
a <a class="reference external" href="https://github.blog/2020-01-17-bring-your-monorepo-down-to-size-with-sparse-checkout/">sparse checkout</a> to only checkout <code class="docutils literal notranslate"><span class="pre">bentoml/grpc</span></code> directory:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>bentoml<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">pushd</span><span class="w"> </span>bentoml
Â»<span class="w"> </span>git<span class="w"> </span>init
Â»<span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>-f<span class="w"> </span>origin<span class="w"> </span>https://github.com/bentoml/BentoML.git
Â»<span class="w"> </span>git<span class="w"> </span>config<span class="w"> </span>core.sparseCheckout<span class="w"> </span><span class="nb">true</span>
Â»<span class="w"> </span>cat<span class="w"> </span><span class="s">&lt;&lt;EOT &gt;|.git/info/sparse-checkout</span>
<span class="s">src/bentoml/grpc</span>
<span class="s">EOT</span>
Â»<span class="w"> </span>git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>main<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>src/bentoml/grpc<span class="w"> </span>.
Â»<span class="w"> </span><span class="nb">popd</span>
</pre></div>
</div>
<p>Here is the <code class="docutils literal notranslate"><span class="pre">protoc</span></code> command to generate the gRPC Javascript stubs:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span><span class="k">$(</span>npm<span class="w"> </span>bin<span class="k">)</span>/grpc_tools_node_protoc<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>-I<span class="w"> </span>.<span class="w"> </span>-I<span class="w"> </span>./thirdparty/protobuf/src<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--js_out<span class="o">=</span><span class="nv">import_style</span><span class="o">=</span>commonjs,binary:.<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--grpc_out<span class="o">=</span>grpc_js:js<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>bentoml/grpc/v1/service.proto
</pre></div>
</div>
<p>Proceed to create a <code class="docutils literal notranslate"><span class="pre">client.js</span></code> file with the following content:</p>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text"><cite>client.js</cite></span><a class="headerlink" href="#id19" title="Permalink to this code">#</a></div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">"use strict"</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">grpc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">"@grpc/grpc-js"</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">pb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">"./bentoml/grpc/v1/service_pb"</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">services</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">"./bentoml/grpc/v1/service_grpc_pb"</span><span class="p">);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"localhost:3000"</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">services</span><span class="p">.</span><span class="nx">BentoServiceClient</span><span class="p">(</span>
<span class="w">    </span><span class="nx">target</span><span class="p">,</span>
<span class="w">    </span><span class="nx">grpc</span><span class="p">.</span><span class="nx">credentials</span><span class="p">.</span><span class="nx">createInsecure</span><span class="p">()</span>
<span class="w">  </span><span class="p">);</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">ndarray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">pb</span><span class="p">.</span><span class="nx">NDArray</span><span class="p">();</span>
<span class="w">  </span><span class="nx">ndarray</span>
<span class="w">    </span><span class="p">.</span><span class="nx">setDtype</span><span class="p">(</span><span class="nx">pb</span><span class="p">.</span><span class="nx">NDArray</span><span class="p">.</span><span class="nx">DType</span><span class="p">.</span><span class="nx">DTYPE_FLOAT</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">setShapeList</span><span class="p">([</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">])</span>
<span class="w">    </span><span class="p">.</span><span class="nx">setFloatValuesList</span><span class="p">([</span><span class="mf">3.5</span><span class="p">,</span><span class="w"> </span><span class="mf">2.4</span><span class="p">,</span><span class="w"> </span><span class="mf">7.8</span><span class="p">,</span><span class="w"> </span><span class="mf">5.1</span><span class="p">]);</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">pb</span><span class="p">.</span><span class="nx">Request</span><span class="p">();</span>
<span class="w">  </span><span class="nx">req</span><span class="p">.</span><span class="nx">setApiName</span><span class="p">(</span><span class="s2">"classify"</span><span class="p">).</span><span class="nx">setNdarray</span><span class="p">(</span><span class="nx">ndarray</span><span class="p">);</span>

<span class="w">  </span><span class="nx">client</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">grpc</span><span class="p">.</span><span class="nx">status</span><span class="p">.</span><span class="nx">INVALID_ARGUMENT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Invalid argument"</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">getContentCase</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">pb</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">ContentCase</span><span class="p">.</span><span class="nx">NDARRAY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"Only support NDArray response."</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"result: "</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">getNdarray</span><span class="p">().</span><span class="nx">toObject</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>

<span class="nx">main</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<input id="sd-tab-item-12" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" data-sync-id="swift" for="sd-tab-item-12">
Swift</label><div class="sd-tab-content docutils">
<p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Requirements:</span> Make sure to have the <a class="reference external" href="https://github.com/grpc/grpc-swift/blob/main/docs/quick-start.md#prerequisites">prequisites</a> to get started with <a class="reference external" href="https://github.com/grpc/grpc-swift">grpc/grpc-swift</a>.</p>
<p>We will create our Swift client in the directory <code class="docutils literal notranslate"><span class="pre">~/workspace/iris_swift_client/</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>~/workspace/iris_swift_client
Â»<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/workspace/iris_swift_client
</pre></div>
</div>
<p>We will use <a class="reference external" href="https://swift.org/package-manager/">Swift Package Manager</a> to build and run the client.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>swift<span class="w"> </span>package<span class="w"> </span>init<span class="w"> </span>--type<span class="w"> </span>executable
</pre></div>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Initialize the project and use the following <code class="docutils literal notranslate"><span class="pre">Package.swift</span></code>:<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text"><cite>Package.swift</cite></span><a class="headerlink" href="#id20" title="Permalink to this code">#</a></div>
<div class="highlight-swift notranslate"><div class="highlight"><pre><span></span><span class="c1">// swift-tools-version: 5.7</span>
<span class="c1">// The swift-tools-version declares the minimum version of Swift required to build this package.</span>

<span class="kd">import</span> <span class="nc">PackageDescription</span>

<span class="c1">// To declare other packages that this package depends on.</span>
<span class="kd">let</span> <span class="nv">packageDependencies</span><span class="p">:</span> <span class="p">[</span><span class="n">Package</span><span class="p">.</span><span class="n">Dependency</span><span class="p">]</span> <span class="p">=</span> <span class="p">[</span>
  <span class="p">.</span><span class="n">package</span><span class="p">(</span>
    <span class="n">url</span><span class="p">:</span> <span class="s">"https://github.com/grpc/grpc-swift.git"</span><span class="p">,</span>
    <span class="n">from</span><span class="p">:</span> <span class="s">"1.10.0"</span>
  <span class="p">),</span>
  <span class="p">.</span><span class="n">package</span><span class="p">(</span>
    <span class="n">url</span><span class="p">:</span> <span class="s">"https://github.com/apple/swift-nio.git"</span><span class="p">,</span>
    <span class="n">from</span><span class="p">:</span> <span class="s">"2.41.1"</span>
  <span class="p">),</span>
  <span class="p">.</span><span class="n">package</span><span class="p">(</span>
    <span class="n">url</span><span class="p">:</span> <span class="s">"https://github.com/apple/swift-protobuf.git"</span><span class="p">,</span>
    <span class="n">from</span><span class="p">:</span> <span class="s">"1.20.1"</span>
  <span class="p">),</span>
<span class="p">]</span>

<span class="c1">// Defines dependencies for our targets.</span>
<span class="kd">extension</span> <span class="nc">Target</span><span class="p">.</span><span class="n">Dependency</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="kd">let</span> <span class="nv">bentoServiceModel</span><span class="p">:</span> <span class="kc">Self</span> <span class="p">=</span> <span class="p">.</span><span class="n">target</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">"BentoServiceModel"</span><span class="p">)</span>

  <span class="kd">static</span> <span class="kd">let</span> <span class="nv">grpc</span><span class="p">:</span> <span class="kc">Self</span> <span class="p">=</span> <span class="p">.</span><span class="n">product</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">"GRPC"</span><span class="p">,</span> <span class="n">package</span><span class="p">:</span> <span class="s">"grpc-swift"</span><span class="p">)</span>
  <span class="kd">static</span> <span class="kd">let</span> <span class="nv">nio</span><span class="p">:</span> <span class="kc">Self</span> <span class="p">=</span> <span class="p">.</span><span class="n">product</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">"NIO"</span><span class="p">,</span> <span class="n">package</span><span class="p">:</span> <span class="s">"swift-nio"</span><span class="p">)</span>
  <span class="kd">static</span> <span class="kd">let</span> <span class="nv">nioCore</span><span class="p">:</span> <span class="kc">Self</span> <span class="p">=</span> <span class="p">.</span><span class="n">product</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">"NIOCore"</span><span class="p">,</span> <span class="n">package</span><span class="p">:</span> <span class="s">"swift-nio"</span><span class="p">)</span>
  <span class="kd">static</span> <span class="kd">let</span> <span class="nv">nioPosix</span><span class="p">:</span> <span class="kc">Self</span> <span class="p">=</span> <span class="p">.</span><span class="n">product</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">"NIOPosix"</span><span class="p">,</span> <span class="n">package</span><span class="p">:</span> <span class="s">"swift-nio"</span><span class="p">)</span>
  <span class="kd">static</span> <span class="kd">let</span> <span class="nv">protobuf</span><span class="p">:</span> <span class="kc">Self</span> <span class="p">=</span> <span class="p">.</span><span class="n">product</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">"SwiftProtobuf"</span><span class="p">,</span> <span class="n">package</span><span class="p">:</span> <span class="s">"swift-protobuf"</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Targets are the basic building blocks of a package. A target can define a module or a test suite.</span>
<span class="c1">// Targets can depend on other targets in this package, and on products in packages this package depends on.</span>
<span class="kd">extension</span> <span class="nc">Target</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="kd">let</span> <span class="nv">bentoServiceModel</span><span class="p">:</span> <span class="n">Target</span> <span class="p">=</span> <span class="p">.</span><span class="n">target</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="s">"BentoServiceModel"</span><span class="p">,</span>
    <span class="n">dependencies</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">.</span><span class="n">grpc</span><span class="p">,</span>
      <span class="p">.</span><span class="n">nio</span><span class="p">,</span>
      <span class="p">.</span><span class="n">protobuf</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">path</span><span class="p">:</span> <span class="s">"Sources/bentoml/grpc/v1alpha1"</span>
  <span class="p">)</span>

  <span class="kd">static</span> <span class="kd">let</span> <span class="nv">bentoServiceClient</span><span class="p">:</span> <span class="n">Target</span> <span class="p">=</span> <span class="p">.</span><span class="n">executableTarget</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="s">"BentoServiceClient"</span><span class="p">,</span>
    <span class="n">dependencies</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">.</span><span class="n">grpc</span><span class="p">,</span>
      <span class="p">.</span><span class="n">bentoServiceModel</span><span class="p">,</span>
      <span class="p">.</span><span class="n">nioCore</span><span class="p">,</span>
      <span class="p">.</span><span class="n">nioPosix</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">path</span><span class="p">:</span> <span class="s">"Sources/BentoServiceClient"</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nv">package</span> <span class="p">=</span> <span class="n">Package</span><span class="p">(</span>
  <span class="n">name</span><span class="p">:</span> <span class="s">"iris-swift-client"</span><span class="p">,</span>
  <span class="n">dependencies</span><span class="p">:</span> <span class="n">packageDependencies</span><span class="p">,</span>
  <span class="n">targets</span><span class="p">:</span> <span class="p">[.</span><span class="n">bentoServiceModel</span><span class="p">,</span> <span class="p">.</span><span class="n">bentoServiceClient</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</details><p>Since there is no easy way to add additional proto files, we will have to clone some
repositories and copy the proto files into our project:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/protocolbuffers/protobuf">protocolbuffers/protobuf</a> - the official repository for the Protocol Buffers. We will need protobuf files that lives under <code class="docutils literal notranslate"><span class="pre">src/google/protobuf</span></code>:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>thirdparty<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>thirdparty
Â»<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="w"> </span><span class="m">1</span><span class="w"> </span>https://github.com/protocolbuffers/protobuf.git
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p><a class="reference external" href="https://github.com/bentoml/bentoml">bentoml/bentoml</a> - We need the <code class="docutils literal notranslate"><span class="pre">service.proto</span></code> under <code class="docutils literal notranslate"><span class="pre">bentoml/grpc/</span></code> to build the client, therefore, we will perform
a <a class="reference external" href="https://github.blog/2020-01-17-bring-your-monorepo-down-to-size-with-sparse-checkout/">sparse checkout</a> to only checkout <code class="docutils literal notranslate"><span class="pre">bentoml/grpc</span></code> directory:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>bentoml<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">pushd</span><span class="w"> </span>bentoml
Â»<span class="w"> </span>git<span class="w"> </span>init
Â»<span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>-f<span class="w"> </span>origin<span class="w"> </span>https://github.com/bentoml/BentoML.git
Â»<span class="w"> </span>git<span class="w"> </span>config<span class="w"> </span>core.sparseCheckout<span class="w"> </span><span class="nb">true</span>
Â»<span class="w"> </span>cat<span class="w"> </span><span class="s">&lt;&lt;EOT &gt;|.git/info/sparse-checkout</span>
<span class="s">src/bentoml/grpc</span>
<span class="s">EOT</span>
Â»<span class="w"> </span>git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>main<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>src/bentoml/grpc<span class="w"> </span>.
Â»<span class="w"> </span><span class="nb">popd</span>
</pre></div>
</div>
<p>Here is the <code class="docutils literal notranslate"><span class="pre">protoc</span></code> command to generate the gRPC Swift stubs:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>protoc<span class="w"> </span>-I.<span class="w"> </span>-I<span class="w"> </span>./thirdparty/protobuf/src<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--swift_out<span class="o">=</span>Sources<span class="w"> </span>--swift_opt<span class="o">=</span><span class="nv">Visibility</span><span class="o">=</span>Public<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--grpc-swift_out<span class="o">=</span>Sources<span class="w"> </span>--grpc-swift_opt<span class="o">=</span><span class="nv">Visibility</span><span class="o">=</span>Public<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--plugin<span class="o">=</span>protoc-gen-grpc-swift<span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>protoc-gen-grpc-swift<span class="k">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">         </span>bentoml/grpc/v1/service.proto
</pre></div>
</div>
<p>Proceed to create a <code class="docutils literal notranslate"><span class="pre">Sources/BentoServiceClient/main.swift</span></code> file with the following content:</p>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text"><cite>main.swift</cite></span><a class="headerlink" href="#id21" title="Permalink to this code">#</a></div>
<div class="highlight-swift notranslate"><div class="highlight"><pre><span></span><span class="cp">#if</span> <span class="cp">compiler</span><span class="p">(</span><span class="o">&gt;=</span><span class="mf">5.6</span><span class="p">)</span>
<span class="cp">#if</span> <span class="cp">BAZEL_BUILD</span>
<span class="kd">import</span> <span class="nc">swift_BentoServiceModel</span> <span class="c1">// internal targets</span>
<span class="cp">#else</span>
<span class="nc">import</span> <span class="nc">BentoServiceModel</span>
<span class="cp">#endif</span>
<span class="kd">import</span> <span class="nc">Foundation</span>
<span class="kd">import</span> <span class="nc">GRPC</span>
<span class="kd">import</span> <span class="nc">NIOCore</span>
<span class="kd">import</span> <span class="nc">NIOPosix</span>
<span class="kd">import</span> <span class="nc">SwiftProtobuf</span>

<span class="c1">// Setup an `EventLoopGroup` for the connection to run on.</span>
<span class="c1">//</span>
<span class="c1">// See: https://github.com/apple/swift-nio#eventloops-and-eventloopgroups</span>
<span class="kd">let</span> <span class="nv">group</span> <span class="p">=</span> <span class="n">MultiThreadedEventLoopGroup</span><span class="p">(</span><span class="n">numberOfThreads</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>

<span class="kd">var</span> <span class="nv">apiName</span><span class="p">:</span> <span class="nb">String</span> <span class="p">=</span> <span class="s">"classify"</span>
<span class="kd">var</span> <span class="nv">shape</span><span class="p">:</span> <span class="p">[</span><span class="nb">Int32</span><span class="p">]</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="kd">var</span> <span class="nv">data</span><span class="p">:</span> <span class="p">[</span><span class="nb">Float</span><span class="p">]</span> <span class="p">=</span> <span class="p">[</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">7.8</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">]</span>

<span class="c1">// Make sure the group is shutdown when we're done with it.</span>
<span class="k">defer</span> <span class="p">{</span>
  <span class="k">try</span><span class="p">!</span> <span class="n">group</span><span class="p">.</span><span class="n">syncShutdownGracefully</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// Configure the channel, we're not using TLS so the connection is `insecure`.</span>
<span class="kd">let</span> <span class="nv">channel</span> <span class="p">=</span> <span class="k">try</span> <span class="n">GRPCChannelPool</span><span class="p">.</span><span class="n">with</span><span class="p">(</span>
  <span class="n">target</span><span class="p">:</span> <span class="p">.</span><span class="n">host</span><span class="p">(</span><span class="s">"localhost"</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="mi">3000</span><span class="p">),</span>
  <span class="n">transportSecurity</span><span class="p">:</span> <span class="p">.</span><span class="n">plaintext</span><span class="p">,</span>
  <span class="n">eventLoopGroup</span><span class="p">:</span> <span class="n">group</span>
<span class="p">)</span>

<span class="c1">// Close the connection when we're done with it.</span>
<span class="k">defer</span> <span class="p">{</span>
  <span class="k">try</span><span class="p">!</span> <span class="n">channel</span><span class="p">.</span><span class="n">close</span><span class="p">().</span><span class="n">wait</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// Provide the connection to the generated client.</span>
<span class="kd">let</span> <span class="nv">stubs</span> <span class="p">=</span> <span class="n">Bentoml_Grpc_v1_BentoServiceNIOClient</span><span class="p">(</span><span class="n">channel</span><span class="p">:</span> <span class="n">channel</span><span class="p">)</span>

<span class="c1">// Form the request with the NDArray, if one was provided.</span>
<span class="kd">let</span> <span class="nv">ndarray</span><span class="p">:</span> <span class="n">Bentoml_Grpc_v1_NDArray</span> <span class="p">=</span> <span class="p">.</span><span class="n">with</span> <span class="p">{</span>
  <span class="nv">$0</span><span class="p">.</span><span class="n">shape</span> <span class="p">=</span> <span class="n">shape</span>
  <span class="nv">$0</span><span class="p">.</span><span class="n">floatValues</span> <span class="p">=</span> <span class="n">data</span>
  <span class="nv">$0</span><span class="p">.</span><span class="n">dtype</span> <span class="p">=</span> <span class="n">Bentoml_Grpc_v1_NDArray</span><span class="p">.</span><span class="n">DType</span><span class="p">.</span><span class="n">float</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nv">request</span><span class="p">:</span> <span class="n">Bentoml_Grpc_v1_Request</span> <span class="p">=</span> <span class="p">.</span><span class="n">with</span> <span class="p">{</span>
  <span class="nv">$0</span><span class="p">.</span><span class="n">apiName</span> <span class="p">=</span> <span class="n">apiName</span>
  <span class="nv">$0</span><span class="p">.</span><span class="n">ndarray</span> <span class="p">=</span> <span class="n">ndarray</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nv">call</span> <span class="p">=</span> <span class="n">stubs</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="k">do</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nv">resp</span> <span class="p">=</span> <span class="k">try</span> <span class="n">call</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">wait</span><span class="p">()</span>
  <span class="k">if</span> <span class="kd">let</span> <span class="nv">content</span> <span class="p">=</span> <span class="n">resp</span><span class="p">.</span><span class="n">content</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">content</span> <span class="p">{</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="p">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">ndarray</span><span class="p">):</span>
      <span class="bp">print</span><span class="p">(</span><span class="s">"Response: </span><span class="si">\(</span><span class="n">ndarray</span><span class="si">)</span><span class="s">"</span><span class="p">)</span>
    <span class="k">default</span><span class="p">:</span>
      <span class="bp">print</span><span class="p">(</span><span class="s">"Currently only support NDArray response."</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
  <span class="bp">print</span><span class="p">(</span><span class="s">"Rpc failed </span><span class="si">\(</span><span class="k">try</span> <span class="n">call</span><span class="p">.</span><span class="n">status</span><span class="p">.</span><span class="n">wait</span><span class="si">())</span><span class="s">: </span><span class="si">\(</span><span class="n">error</span><span class="si">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
<span class="cp">#else</span>
<span class="p">@</span><span class="n">main</span>
<span class="kd">enum</span> <span class="nc">NotAvailable</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">"This example requires Swift &gt;= 5.6"</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="cp">#endif</span> <span class="c1">// compiler(&gt;=5.6)</span>
</pre></div>
</div>
</div>
</div>
<input id="sd-tab-item-13" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" data-sync-id="php" for="sd-tab-item-13">
PHP</label><div class="sd-tab-content docutils">
<p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Requirements:</span> Make sure to follow the <a class="reference external" href="https://github.com/grpc/grpc/blob/master/src/php/README.md">instructions</a> to install <code class="docutils literal notranslate"><span class="pre">grpc</span></code> via either <a class="reference external" href="https://pecl.php.net/">pecl</a> or from source.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You will also have to symlink the built C++ extension to the PHP extension directory for it to be loaded by PHP.</p>
</div>
<p>We will then use <a class="reference external" href="https://bazel.build"><cite>bazel</cite></a>, <a class="reference external" href="https://getcomposer.org/">composer</a> to build and run the client.</p>
<p>We will create our PHP client in the directory <code class="docutils literal notranslate"><span class="pre">~/workspace/iris_php_client/</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>~/workspace/iris_php_client
Â»<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/workspace/iris_php_client
</pre></div>
</div>
<p>Create a new PHP package:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>composer<span class="w"> </span>init
</pre></div>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-code" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z"></path></svg></span>An example <code class="docutils literal notranslate"><span class="pre">composer.json</span></code> for the client:<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bentoml/grpc-php-client"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BentoML gRPC client for PHP"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"require"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"grpc/grpc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.42.0"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"google/protobuf"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.19.4"</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">"license"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Apache-2.0"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"autoload"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"psr-4"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"GBPMetadata\\"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GPBMetadata/"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"Bentoml\\"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bentoml"</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">"authors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BentoML Team"</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</details><p>Since there is no easy way to add additional proto files, we will have to clone some
repositories and copy the proto files into our project:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/protocolbuffers/protobuf">protocolbuffers/protobuf</a> - the official repository for the Protocol Buffers. We will need protobuf files that lives under <code class="docutils literal notranslate"><span class="pre">src/google/protobuf</span></code>:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>thirdparty<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>thirdparty
Â»<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="w"> </span><span class="m">1</span><span class="w"> </span>https://github.com/protocolbuffers/protobuf.git
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p><a class="reference external" href="https://github.com/bentoml/bentoml">bentoml/bentoml</a> - We need the <code class="docutils literal notranslate"><span class="pre">service.proto</span></code> under <code class="docutils literal notranslate"><span class="pre">bentoml/grpc/</span></code> to build the client, therefore, we will perform
a <a class="reference external" href="https://github.blog/2020-01-17-bring-your-monorepo-down-to-size-with-sparse-checkout/">sparse checkout</a> to only checkout <code class="docutils literal notranslate"><span class="pre">bentoml/grpc</span></code> directory:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>mkdir<span class="w"> </span>bentoml<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">pushd</span><span class="w"> </span>bentoml
Â»<span class="w"> </span>git<span class="w"> </span>init
Â»<span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>-f<span class="w"> </span>origin<span class="w"> </span>https://github.com/bentoml/BentoML.git
Â»<span class="w"> </span>git<span class="w"> </span>config<span class="w"> </span>core.sparseCheckout<span class="w"> </span><span class="nb">true</span>
Â»<span class="w"> </span>cat<span class="w"> </span><span class="s">&lt;&lt;EOT &gt;|.git/info/sparse-checkout</span>
<span class="s">src/bentoml/grpc</span>
<span class="s">EOT</span>
Â»<span class="w"> </span>git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>main<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>src/bentoml/grpc<span class="w"> </span>.
Â»<span class="w"> </span><span class="nb">popd</span>
</pre></div>
</div>
<p>Here is the <code class="docutils literal notranslate"><span class="pre">protoc</span></code> command to generate the gRPC swift stubs:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>protoc<span class="w"> </span>-I<span class="w"> </span>.<span class="w"> </span>-I<span class="w"> </span>./thirdparty/protobuf/src<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--php_out<span class="o">=</span>.<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--grpc_out<span class="o">=</span>.<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--plugin<span class="o">=</span>protoc-gen-grpc<span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>grpc_php_plugin<span class="k">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">         </span>bentoml/grpc/v1/service.proto
</pre></div>
</div>
<p>Proceed to create a <code class="docutils literal notranslate"><span class="pre">BentoServiceClient.php</span></code> file with the following content:</p>
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text"><cite>BentoServiceClient.php</cite></span><a class="headerlink" href="#id22" title="Permalink to this code">#</a></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Bentoml\Grpc\v1\BentoServiceClient</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Bentoml\Grpc\v1\NDArray</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Bentoml\Grpc\v1\Request</span><span class="p">;</span>

<span class="k">require</span> <span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">)</span> <span class="o">.</span> <span class="s1">'/vendor/autoload.php'</span><span class="p">;</span>

<span class="k">function</span> <span class="nf">call</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$hostname</span> <span class="o">=</span> <span class="s1">'localhost:3000'</span><span class="p">;</span>
    <span class="nv">$apiName</span> <span class="o">=</span> <span class="s2">"classify"</span><span class="p">;</span>
    <span class="nv">$to_parsed</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">"3.5"</span><span class="p">,</span> <span class="s2">"2.4"</span><span class="p">,</span> <span class="s2">"7.8"</span><span class="p">,</span> <span class="s2">"5.1"</span><span class="p">);</span>
    <span class="nv">$data</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="s2">"floatval"</span><span class="p">,</span> <span class="nv">$to_parsed</span><span class="p">);</span>
    <span class="nv">$shape</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BentoServiceClient</span><span class="p">(</span><span class="nv">$hostname</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">'credentials'</span> <span class="o">=&gt;</span> <span class="nx">Grpc\ChannelCredentials</span><span class="o">::</span><span class="na">createInsecure</span><span class="p">(),</span>
    <span class="p">]);</span>
    <span class="nv">$request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Request</span><span class="p">();</span>
    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">setApiName</span><span class="p">(</span><span class="nv">$apiName</span><span class="p">);</span>
    <span class="nv">$payload</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NDArray</span><span class="p">();</span>
    <span class="nv">$payload</span><span class="o">-&gt;</span><span class="na">setShape</span><span class="p">(</span><span class="nv">$shape</span><span class="p">);</span>
    <span class="nv">$payload</span><span class="o">-&gt;</span><span class="na">setFloatValues</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
    <span class="nv">$payload</span><span class="o">-&gt;</span><span class="na">setDtype</span><span class="p">(</span><span class="nx">\Bentoml\Grpc\v1\NDArray\DType</span><span class="o">::</span><span class="na">DTYPE_FLOAT</span><span class="p">);</span>

    <span class="k">list</span><span class="p">(</span><span class="nv">$response</span><span class="p">,</span> <span class="nv">$status</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">Call</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">wait</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$status</span><span class="o">-&gt;</span><span class="na">code</span> <span class="o">!==</span> <span class="nx">Grpc\STATUS_OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">"ERROR: "</span> <span class="o">.</span> <span class="nv">$status</span><span class="o">-&gt;</span><span class="na">code</span> <span class="o">.</span> <span class="s2">", "</span> <span class="o">.</span> <span class="nv">$status</span><span class="o">-&gt;</span><span class="na">details</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
        <span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">echo</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">call</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="admonition-todo admonition" id="id10">
<p class="admonition-title">Todo</p>
<p>Bazel instruction for <code class="docutils literal notranslate"><span class="pre">swift</span></code>, <code class="docutils literal notranslate"><span class="pre">nodejs</span></code>, <code class="docutils literal notranslate"><span class="pre">python</span></code></p>
</div>
<p><span class="raw-html"><br></span></p>
<p>Then you can proceed to run the client scripts:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-22" name="sd-tab-set-8" type="radio">
<label class="sd-tab-label" data-sync-id="python" for="sd-tab-item-22">
Python</label><div class="sd-tab-content docutils">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>client
</pre></div>
</div>
</div>
<input id="sd-tab-item-23" name="sd-tab-set-8" type="radio">
<label class="sd-tab-label" data-sync-id="golang" for="sd-tab-item-23">
Go</label><div class="sd-tab-content docutils">
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-30" name="sd-tab-set-9" type="radio">
<label class="sd-tab-label" data-sync-id="bazel-workflow" for="sd-tab-item-30">
Using bazel (recommended)</label><div class="sd-tab-content docutils">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>bazel<span class="w"> </span>run<span class="w"> </span>//:client_go
</pre></div>
</div>
</div>
<input id="sd-tab-item-31" name="sd-tab-set-9" type="radio">
<label class="sd-tab-label" data-sync-id="protoc-and-plugins" for="sd-tab-item-31">
Using protoc and language-specific plugins</label><div class="sd-tab-content docutils">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>go<span class="w"> </span>run<span class="w"> </span>./client.go
</pre></div>
</div>
</div>
</div>
</div>
<input id="sd-tab-item-24" name="sd-tab-set-8" type="radio">
<label class="sd-tab-label" data-sync-id="cpp" for="sd-tab-item-24">
C++</label><div class="sd-tab-content docutils">
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-32" name="sd-tab-set-10" type="radio">
<label class="sd-tab-label" data-sync-id="bazel-workflow" for="sd-tab-item-32">
Using bazel (recommended)</label><div class="sd-tab-content docutils">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>bazel<span class="w"> </span>run<span class="w"> </span>:client_cc
</pre></div>
</div>
</div>
<input id="sd-tab-item-33" name="sd-tab-set-10" type="radio">
<label class="sd-tab-label" data-sync-id="protoc-and-plugins" for="sd-tab-item-33">
Using protoc and language-specific plugins</label><div class="sd-tab-content docutils">
<p>Refer to <a class="reference external" href="https://github.com/grpc/grpc">grpc/grpc</a> for instructions on using CMake and other similar build tools.</p>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See the <a class="reference external" href="https://github.com/bentoml/BentoML/tree/main/grpc-client/README.md">instructions on GitHub</a> for working C++ client.</p>
</div>
</div>
<input id="sd-tab-item-25" name="sd-tab-set-8" type="radio">
<label class="sd-tab-label" data-sync-id="java" for="sd-tab-item-25">
Java</label><div class="sd-tab-content docutils">
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-34" name="sd-tab-set-11" type="radio">
<label class="sd-tab-label" data-sync-id="bazel-workflow" for="sd-tab-item-34">
Using bazel (recommended)</label><div class="sd-tab-content docutils">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>bazel<span class="w"> </span>run<span class="w"> </span>:client_java
</pre></div>
</div>
</div>
<input id="sd-tab-item-35" name="sd-tab-set-11" type="radio">
<label class="sd-tab-label" data-sync-id="protoc-and-plugins" for="sd-tab-item-35">
Using others build system</label><div class="sd-tab-content docutils">
<p>We will use <code class="docutils literal notranslate"><span class="pre">gradlew</span></code> to build the client and run it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>./gradlew<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">   </span>./build/tmp/scripts/bentoServiceClient/bento-service-client
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See the <a class="reference external" href="https://github.com/bentoml/BentoML/tree/main/grpc-client/README.md">instructions on GitHub</a> for working Java client.</p>
</div>
</div>
<input id="sd-tab-item-26" name="sd-tab-set-8" type="radio">
<label class="sd-tab-label" data-sync-id="kotlin" for="sd-tab-item-26">
Kotlin</label><div class="sd-tab-content docutils">
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-36" name="sd-tab-set-12" type="radio">
<label class="sd-tab-label" data-sync-id="bazel-workflow" for="sd-tab-item-36">
Using bazel (recommended)</label><div class="sd-tab-content docutils">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>bazel<span class="w"> </span>run<span class="w"> </span>:client_kt
</pre></div>
</div>
</div>
<input id="sd-tab-item-37" name="sd-tab-set-12" type="radio">
<label class="sd-tab-label" data-sync-id="protoc-and-plugins" for="sd-tab-item-37">
Using others build system</label><div class="sd-tab-content docutils">
<p>We will use <code class="docutils literal notranslate"><span class="pre">gradlew</span></code> to build the client and run it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>./gradlew<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">   </span>./build/tmp/scripts/bentoServiceClient/bento-service-client
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See the <a class="reference external" href="https://github.com/bentoml/BentoML/tree/main/grpc-client/README.md">instructions on GitHub</a> for working Kotlin client.</p>
</div>
</div>
<input id="sd-tab-item-27" name="sd-tab-set-8" type="radio">
<label class="sd-tab-label" data-sync-id="nodejs" for="sd-tab-item-27">
Node.js</label><div class="sd-tab-content docutils">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>node<span class="w"> </span>client.js
</pre></div>
</div>
</div>
<input id="sd-tab-item-28" name="sd-tab-set-8" type="radio">
<label class="sd-tab-label" data-sync-id="swift" for="sd-tab-item-28">
Swift</label><div class="sd-tab-content docutils">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>swift<span class="w"> </span>run<span class="w"> </span>BentoServiceClient
</pre></div>
</div>
</div>
<input id="sd-tab-item-29" name="sd-tab-set-8" type="radio">
<label class="sd-tab-label" data-sync-id="php" for="sd-tab-item-29">
PHP</label><div class="sd-tab-content docutils">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>php<span class="w"> </span>-d<span class="w"> </span><span class="nv">extension</span><span class="o">=</span>/path/to/grpc.so<span class="w"> </span>-d<span class="w"> </span><span class="nv">max_execution_time</span><span class="o">=</span><span class="m">300</span><span class="w"> </span>BentoServiceClient.php
</pre></div>
</div>
</div>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-triangle-down" viewBox="0 0 16 16" aria-hidden="true"><path d="M4.427 7.427l3.396 3.396a.25.25 0 00.354 0l3.396-3.396A.25.25 0 0011.396 7H4.604a.25.25 0 00-.177.427z"></path></svg></span>Additional language support for client implementation<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-38" name="sd-tab-set-13" type="radio">
<label class="sd-tab-label" data-sync-id="ruby" for="sd-tab-item-38">
Ruby</label><div class="sd-tab-content docutils">
<p class="sd-card-text"><span class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary">Note:</span> Please check out the <a class="reference external" href="https://github.com/grpc/grpc/blob/master/src/ruby/README.md#grpc-ruby">gRPC Ruby</a> for how to install from source.
Check out the <a class="reference external" href="https://github.com/grpc/grpc/blob/master/examples/ruby/README.md#prerequisites">examples folder</a> for Ruby client implementation.</p>
</div>
<input id="sd-tab-item-39" name="sd-tab-set-13" type="radio">
<label class="sd-tab-label" data-sync-id="dotnet" for="sd-tab-item-39">
.NET</label><div class="sd-tab-content docutils">
<p class="sd-card-text"><span class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary">Note:</span> Please check out the <a class="reference external" href="https://github.com/grpc/grpc-dotnet/tree/master/examples">gRPC .NET</a> examples folder for <a class="reference external" href="https://github.com/grpc/grpc-dotnet">grpc/grpc-dotnet</a> client implementation.</p>
</div>
<input id="sd-tab-item-40" name="sd-tab-set-13" type="radio">
<label class="sd-tab-label" data-sync-id="dart" for="sd-tab-item-40">
Dart</label><div class="sd-tab-content docutils">
<p class="sd-card-text"><span class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary">Note:</span> Please check out the <a class="reference external" href="https://github.com/grpc/grpc-dart/tree/master/examples">gRPC Dart</a> examples folder for <a class="reference external" href="https://github.com/grpc/grpc-dart">grpc/grpc-dart</a> client implementation.</p>
</div>
<input id="sd-tab-item-41" name="sd-tab-set-13" type="radio">
<label class="sd-tab-label" data-sync-id="rust" for="sd-tab-item-41">
Rust</label><div class="sd-tab-content docutils">
<p class="sd-card-text"><span class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary">Note:</span> Currently there are no official gRPC Rust client implementation. Please check out the <a class="reference external" href="https://github.com/tikv/grpc-rs">tikv/grpc-rs</a> as one of the unofficial implementation.</p>
</div>
</div>
</div>
</details><p>After successfully running the client, proceed to build the bento as usual:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>bentoml<span class="w"> </span>build
</pre></div>
</div>
<p><span class="raw-html"><br></span></p>
</section>
<section id="containerize-your-bento-with-grpc-support">
<h3>Containerize your Bento ðŸ± with gRPC support<a class="headerlink" href="#containerize-your-bento-with-grpc-support" title="Permalink to this heading">#</a></h3>
<p>To containerize the Bento with gRPC features, pass in <code class="docutils literal notranslate"><span class="pre">--enable-features=grpc</span></code> to
<a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/cli.html#bentoml-containerize"><span class="std std-ref">bentoml containerize</span></a> to add additional gRPC
dependencies to your Bento</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>bentoml<span class="w"> </span>containerize<span class="w"> </span>iris_classifier:latest<span class="w"> </span>--enable-features<span class="o">=</span>grpc
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">--enable-features</span></code> allows users to containerize any of the existing Bentos with <a class="hxr-hoverxref hxr-tooltip reference internal" href="../concepts/bento.html#enable-features-for-your-bento"><span class="std std-ref">additional features</span></a> that BentoML provides without having to rebuild the Bento.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">--enable-features</span></code> accepts a comma-separated list of features or multiple arguments.</p>
</div>
<p>After containerization, your Bento container can now be used with gRPC:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
<span class="w">             </span>-p<span class="w"> </span><span class="m">3000</span>:3000<span class="w"> </span>-p<span class="w"> </span><span class="m">3001</span>:3001<span class="w"> </span><span class="se">\</span>
<span class="w">             </span>iris_classifier:6otbsmxzq6lwbgxi<span class="w"> </span>serve-grpc<span class="w"> </span>--production
</pre></div>
</div>
<p>Congratulations! You have successfully served, containerized and tested your BentoService with gRPC.</p>
</section>
</section>
<hr class="docutils">
<section id="using-grpc-in-bentoml">
<h2>Using gRPC in BentoML<a class="headerlink" href="#using-grpc-in-bentoml" title="Permalink to this heading">#</a></h2>
<p>We will dive into some of the details of how gRPC is implemented in BentoML.</p>
<section id="protobuf-definition">
<h3>Protobuf definition<a class="headerlink" href="#protobuf-definition" title="Permalink to this heading">#</a></h3>
<p>Letâ€™s take a quick look at <a class="reference external" href="https://developers.google.com/protocol-buffers/">protobuf</a>  definition of the BentoService:</p>
<div class="highlight-protobuf notranslate"><div class="highlight"><pre><span></span><span class="kd">service</span><span class="w"> </span><span class="n">BentoService</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">rpc</span><span class="w"> </span><span class="n">Call</span><span class="p">(</span><span class="n">Request</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">Response</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-code" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z"></path></svg></span><cite>Expands for current protobuf definition.</cite><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-42" name="sd-tab-set-14" type="radio">
<label class="sd-tab-label" for="sd-tab-item-42">
v1</label><div class="sd-tab-content docutils">
<div class="highlight-protobuf notranslate"><div class="highlight"><pre><span></span><span class="k">syntax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"proto3"</span><span class="p">;</span>

<span class="kn">package</span><span class="w"> </span><span class="nn">bentoml</span><span class="o">.</span><span class="n">grpc.v1</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s">"google/protobuf/struct.proto"</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s">"google/protobuf/wrappers.proto"</span><span class="p">;</span>

<span class="c1">// cc_enable_arenas pre-allocate memory for given message to improve speed. (C++ only)</span>
<span class="k">option</span><span class="w"> </span><span class="na">cc_enable_arenas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="k">option</span><span class="w"> </span><span class="na">go_package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"github.com/bentoml/bentoml/grpc/v1;service"</span><span class="p">;</span>
<span class="k">option</span><span class="w"> </span><span class="na">java_multiple_files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="k">option</span><span class="w"> </span><span class="na">java_outer_classname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"ServiceProto"</span><span class="p">;</span>
<span class="k">option</span><span class="w"> </span><span class="na">java_package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"com.bentoml.grpc.v1"</span><span class="p">;</span>
<span class="k">option</span><span class="w"> </span><span class="na">objc_class_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"SVC"</span><span class="p">;</span>
<span class="k">option</span><span class="w"> </span><span class="na">py_generic_services</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="c1">// a gRPC BentoServer.</span>
<span class="kd">service</span><span class="w"> </span><span class="n">BentoService</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Call handles methodcaller of given API entrypoint.</span>
<span class="w">  </span><span class="k">rpc</span><span class="w"> </span><span class="n">Call</span><span class="p">(</span><span class="n">Request</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">Response</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">  </span><span class="c1">// ServiceMetadata returns metadata of bentoml.Service.</span>
<span class="w">  </span><span class="k">rpc</span><span class="w"> </span><span class="n">ServiceMetadata</span><span class="p">(</span><span class="n">ServiceMetadataRequest</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">ServiceMetadataResponse</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// ServiceMetadataRequest message doesn't take any arguments.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">ServiceMetadataRequest</span><span class="w"> </span><span class="p">{}</span>

<span class="c1">// ServiceMetadataResponse returns metadata of bentoml.Service.</span>
<span class="c1">// Currently it includes name, version, apis, and docs.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">ServiceMetadataResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// DescriptorMetadata is a metadata of any given IODescriptor.</span>
<span class="w">  </span><span class="kd">message</span><span class="w"> </span><span class="nc">DescriptorMetadata</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// descriptor_id describes the given ID of the descriptor, which matches with our OpenAPI definition.</span>
<span class="w">    </span><span class="k">optional</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="na">descriptor_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// attributes is the kwargs of the given descriptor.</span>
<span class="w">    </span><span class="n">google.protobuf.Struct</span><span class="w"> </span><span class="na">attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// InferenceAPI is bentoml._internal.service.inferece_api.InferenceAPI</span>
<span class="w">  </span><span class="c1">// that is exposed to gRPC client.</span>
<span class="w">  </span><span class="c1">// There is no way for reflection to get information of given @svc.api.</span>
<span class="w">  </span><span class="kd">message</span><span class="w"> </span><span class="nc">InferenceAPI</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// name is the name of the API.</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// input is the input descriptor of the API.</span>
<span class="w">    </span><span class="k">optional</span><span class="w"> </span><span class="n">DescriptorMetadata</span><span class="w"> </span><span class="na">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// output is the output descriptor of the API.</span>
<span class="w">    </span><span class="k">optional</span><span class="w"> </span><span class="n">DescriptorMetadata</span><span class="w"> </span><span class="na">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// docs is the optional documentation of the API.</span>
<span class="w">    </span><span class="k">optional</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="na">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// name is the service name.</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="c1">// apis holds a list of InferenceAPI of the service.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="n">InferenceAPI</span><span class="w"> </span><span class="na">apis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="c1">// docs is the documentation of the service.</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Request message for incoming Call.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">Request</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// api_name defines the API entrypoint to call.</span>
<span class="w">  </span><span class="c1">// api_name is the name of the function defined in bentoml.Service.</span>
<span class="w">  </span><span class="c1">// Example:</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="c1">//     @svc.api(input=NumpyNdarray(), output=File())</span>
<span class="w">  </span><span class="c1">//     def predict(input: NDArray[float]) -&gt; bytes:</span>
<span class="w">  </span><span class="c1">//         ...</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="c1">//     api_name is "predict" in this case.</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">api_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">  </span><span class="k">oneof</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// NDArray represents a n-dimensional array of arbitrary type.</span>
<span class="w">    </span><span class="n">NDArray</span><span class="w"> </span><span class="na">ndarray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// DataFrame represents any tabular data type. We are using</span>
<span class="w">    </span><span class="c1">// DataFrame as a trivial representation for tabular type.</span>
<span class="w">    </span><span class="n">DataFrame</span><span class="w"> </span><span class="na">dataframe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Series portrays a series of values. This can be used for</span>
<span class="w">    </span><span class="c1">// representing Series types in tabular data.</span>
<span class="w">    </span><span class="n">Series</span><span class="w"> </span><span class="na">series</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// File represents for any arbitrary file type. This can be</span>
<span class="w">    </span><span class="c1">// plaintext, image, video, audio, etc.</span>
<span class="w">    </span><span class="n">File</span><span class="w"> </span><span class="na">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Text represents a string inputs.</span>
<span class="w">    </span><span class="n">google.protobuf.StringValue</span><span class="w"> </span><span class="na">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// JSON is represented by using google.protobuf.Value.</span>
<span class="w">    </span><span class="c1">// see https://github.com/protocolbuffers/protobuf/blob/main/src/google/protobuf/struct.proto</span>
<span class="w">    </span><span class="n">google.protobuf.Value</span><span class="w"> </span><span class="na">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Multipart represents a multipart message.</span>
<span class="w">    </span><span class="c1">// It comprises of a mapping from given type name to a subset of aforementioned types.</span>
<span class="w">    </span><span class="n">Multipart</span><span class="w"> </span><span class="na">multipart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// serialized_bytes is for data serialized in BentoML's internal serialization format.</span>
<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="na">serialized_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Tensor is similiar to ndarray but with a name</span>
<span class="w">  </span><span class="c1">// We are reserving it for now for future use.</span>
<span class="w">  </span><span class="c1">// repeated Tensor tensors = 4;</span>
<span class="w">  </span><span class="k">reserved</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">13</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Request message for incoming Call.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">Response</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">oneof</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// NDArray represents a n-dimensional array of arbitrary type.</span>
<span class="w">    </span><span class="n">NDArray</span><span class="w"> </span><span class="na">ndarray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// DataFrame represents any tabular data type. We are using</span>
<span class="w">    </span><span class="c1">// DataFrame as a trivial representation for tabular type.</span>
<span class="w">    </span><span class="n">DataFrame</span><span class="w"> </span><span class="na">dataframe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Series portrays a series of values. This can be used for</span>
<span class="w">    </span><span class="c1">// representing Series types in tabular data.</span>
<span class="w">    </span><span class="n">Series</span><span class="w"> </span><span class="na">series</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// File represents for any arbitrary file type. This can be</span>
<span class="w">    </span><span class="c1">// plaintext, image, video, audio, etc.</span>
<span class="w">    </span><span class="n">File</span><span class="w"> </span><span class="na">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Text represents a string inputs.</span>
<span class="w">    </span><span class="n">google.protobuf.StringValue</span><span class="w"> </span><span class="na">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// JSON is represented by using google.protobuf.Value.</span>
<span class="w">    </span><span class="c1">// see https://github.com/protocolbuffers/protobuf/blob/main/src/google/protobuf/struct.proto</span>
<span class="w">    </span><span class="n">google.protobuf.Value</span><span class="w"> </span><span class="na">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Multipart represents a multipart message.</span>
<span class="w">    </span><span class="c1">// It comprises of a mapping from given type name to a subset of aforementioned types.</span>
<span class="w">    </span><span class="n">Multipart</span><span class="w"> </span><span class="na">multipart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// serialized_bytes is for data serialized in BentoML's internal serialization format.</span>
<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="na">serialized_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// Tensor is similiar to ndarray but with a name</span>
<span class="w">  </span><span class="c1">// We are reserving it for now for future use.</span>
<span class="w">  </span><span class="c1">// repeated Tensor tensors = 4;</span>
<span class="w">  </span><span class="k">reserved</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">13</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Part represents possible value types for multipart message.</span>
<span class="c1">// These are the same as the types in Request message.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">Part</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">oneof</span><span class="w"> </span><span class="n">representation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// NDArray represents a n-dimensional array of arbitrary type.</span>
<span class="w">    </span><span class="n">NDArray</span><span class="w"> </span><span class="na">ndarray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// DataFrame represents any tabular data type. We are using</span>
<span class="w">    </span><span class="c1">// DataFrame as a trivial representation for tabular type.</span>
<span class="w">    </span><span class="n">DataFrame</span><span class="w"> </span><span class="na">dataframe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Series portrays a series of values. This can be used for</span>
<span class="w">    </span><span class="c1">// representing Series types in tabular data.</span>
<span class="w">    </span><span class="n">Series</span><span class="w"> </span><span class="na">series</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// File represents for any arbitrary file type. This can be</span>
<span class="w">    </span><span class="c1">// plaintext, image, video, audio, etc.</span>
<span class="w">    </span><span class="n">File</span><span class="w"> </span><span class="na">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Text represents a string inputs.</span>
<span class="w">    </span><span class="n">google.protobuf.StringValue</span><span class="w"> </span><span class="na">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// JSON is represented by using google.protobuf.Value.</span>
<span class="w">    </span><span class="c1">// see https://github.com/protocolbuffers/protobuf/blob/main/src/google/protobuf/struct.proto</span>
<span class="w">    </span><span class="n">google.protobuf.Value</span><span class="w"> </span><span class="na">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// serialized_bytes is for data serialized in BentoML's internal serialization format.</span>
<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="na">serialized_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Tensor is similiar to ndarray but with a name</span>
<span class="w">  </span><span class="c1">// We are reserving it for now for future use.</span>
<span class="w">  </span><span class="c1">// Tensor tensors = 4;</span>
<span class="w">  </span><span class="k">reserved</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">13</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Multipart represents a multipart message.</span>
<span class="c1">// It comprises of a mapping from given type name to a subset of aforementioned types.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">Multipart</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">map</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="n">Part</span><span class="p">&gt;</span><span class="w"> </span><span class="na">fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// File represents for any arbitrary file type. This can be</span>
<span class="c1">// plaintext, image, video, audio, etc.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">File</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// optional file type, let it be csv, text, parquet, etc.</span>
<span class="w">  </span><span class="c1">// v1alpha1 uses 1 as FileType enum.</span>
<span class="w">  </span><span class="k">optional</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="na">kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="c1">// contents of file as bytes.</span>
<span class="w">  </span><span class="kt">bytes</span><span class="w"> </span><span class="na">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// DataFrame represents any tabular data type. We are using</span>
<span class="c1">// DataFrame as a trivial representation for tabular type.</span>
<span class="c1">// This message carries given implementation of tabular data based on given orientation.</span>
<span class="c1">// TODO: support index, records, etc.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">DataFrame</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// columns name</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="na">column_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// columns orient.</span>
<span class="w">  </span><span class="c1">// { column â†  { index â†  value } }</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="n">Series</span><span class="w"> </span><span class="na">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Series portrays a series of values. This can be used for</span>
<span class="c1">// representing Series types in tabular data.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">Series</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// A bool parameter value</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="na">bool_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// A float parameter value</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="na">float_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// A int32 parameter value</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">int32</span><span class="w"> </span><span class="na">int32_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// A int64 parameter value</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">int64</span><span class="w"> </span><span class="na">int64_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// A string parameter value</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="na">string_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// represents a double parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="na">double_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// NDArray represents a n-dimensional array of arbitrary type.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">NDArray</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Represents data type of a given array.</span>
<span class="w">  </span><span class="kd">enum</span><span class="w"> </span><span class="n">DType</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Represents a None type.</span>
<span class="w">    </span><span class="na">DTYPE_UNSPECIFIED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Represents an float type.</span>
<span class="w">    </span><span class="na">DTYPE_FLOAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Represents an double type.</span>
<span class="w">    </span><span class="na">DTYPE_DOUBLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Represents a bool type.</span>
<span class="w">    </span><span class="na">DTYPE_BOOL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Represents an int32 type.</span>
<span class="w">    </span><span class="na">DTYPE_INT32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Represents an int64 type.</span>
<span class="w">    </span><span class="na">DTYPE_INT64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Represents a uint32 type.</span>
<span class="w">    </span><span class="na">DTYPE_UINT32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Represents a uint64 type.</span>
<span class="w">    </span><span class="na">DTYPE_UINT64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Represents a string type.</span>
<span class="w">    </span><span class="na">DTYPE_STRING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// DTYPE is the data type of given array</span>
<span class="w">  </span><span class="n">DType</span><span class="w"> </span><span class="na">dtype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// shape is the shape of given array.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">int32</span><span class="w"> </span><span class="na">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// represents a string parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="na">string_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// represents a float parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="na">float_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// represents a double parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="na">double_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// represents a bool parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="na">bool_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// represents a int32 parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">int32</span><span class="w"> </span><span class="na">int32_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// represents a int64 parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">int64</span><span class="w"> </span><span class="na">int64_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// represents a uint32 parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">uint32</span><span class="w"> </span><span class="na">uint32_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// represents a uint64 parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">uint64</span><span class="w"> </span><span class="na">uint64_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-43" name="sd-tab-set-14" type="radio">
<label class="sd-tab-label" for="sd-tab-item-43">
v1alpha1</label><div class="sd-tab-content docutils">
<div class="highlight-protobuf notranslate"><div class="highlight"><pre><span></span><span class="k">syntax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"proto3"</span><span class="p">;</span>

<span class="kn">package</span><span class="w"> </span><span class="nn">bentoml</span><span class="o">.</span><span class="n">grpc.v1alpha1</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s">"google/protobuf/struct.proto"</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s">"google/protobuf/wrappers.proto"</span><span class="p">;</span>

<span class="c1">// cc_enable_arenas pre-allocate memory for given message to improve speed. (C++ only)</span>
<span class="k">option</span><span class="w"> </span><span class="na">cc_enable_arenas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="k">option</span><span class="w"> </span><span class="na">go_package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"github.com/bentoml/bentoml/grpc/v1alpha1;service"</span><span class="p">;</span>
<span class="k">option</span><span class="w"> </span><span class="na">java_multiple_files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="k">option</span><span class="w"> </span><span class="na">java_outer_classname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"ServiceProto"</span><span class="p">;</span>
<span class="k">option</span><span class="w"> </span><span class="na">java_package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"com.bentoml.grpc.v1alpha1"</span><span class="p">;</span>
<span class="k">option</span><span class="w"> </span><span class="na">objc_class_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"SVC"</span><span class="p">;</span>
<span class="k">option</span><span class="w"> </span><span class="na">py_generic_services</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="c1">// a gRPC BentoServer.</span>
<span class="kd">service</span><span class="w"> </span><span class="n">BentoService</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Call handles methodcaller of given API entrypoint.</span>
<span class="w">  </span><span class="k">rpc</span><span class="w"> </span><span class="n">Call</span><span class="p">(</span><span class="n">Request</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">Response</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// Request message for incoming Call.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">Request</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// api_name defines the API entrypoint to call.</span>
<span class="w">  </span><span class="c1">// api_name is the name of the function defined in bentoml.Service.</span>
<span class="w">  </span><span class="c1">// Example:</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="c1">//     @svc.api(input=NumpyNdarray(), output=File())</span>
<span class="w">  </span><span class="c1">//     def predict(input: NDArray[float]) -&gt; bytes:</span>
<span class="w">  </span><span class="c1">//         ...</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="c1">//     api_name is "predict" in this case.</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">api_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">  </span><span class="k">oneof</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// NDArray represents a n-dimensional array of arbitrary type.</span>
<span class="w">    </span><span class="n">NDArray</span><span class="w"> </span><span class="na">ndarray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// DataFrame represents any tabular data type. We are using</span>
<span class="w">    </span><span class="c1">// DataFrame as a trivial representation for tabular type.</span>
<span class="w">    </span><span class="n">DataFrame</span><span class="w"> </span><span class="na">dataframe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Series portrays a series of values. This can be used for</span>
<span class="w">    </span><span class="c1">// representing Series types in tabular data.</span>
<span class="w">    </span><span class="n">Series</span><span class="w"> </span><span class="na">series</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// File represents for any arbitrary file type. This can be</span>
<span class="w">    </span><span class="c1">// plaintext, image, video, audio, etc.</span>
<span class="w">    </span><span class="n">File</span><span class="w"> </span><span class="na">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Text represents a string inputs.</span>
<span class="w">    </span><span class="n">google.protobuf.StringValue</span><span class="w"> </span><span class="na">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// JSON is represented by using google.protobuf.Value.</span>
<span class="w">    </span><span class="c1">// see https://github.com/protocolbuffers/protobuf/blob/main/src/google/protobuf/struct.proto</span>
<span class="w">    </span><span class="n">google.protobuf.Value</span><span class="w"> </span><span class="na">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Multipart represents a multipart message.</span>
<span class="w">    </span><span class="c1">// It comprises of a mapping from given type name to a subset of aforementioned types.</span>
<span class="w">    </span><span class="n">Multipart</span><span class="w"> </span><span class="na">multipart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// serialized_bytes is for data serialized in BentoML's internal serialization format.</span>
<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="na">serialized_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Tensor is similiar to ndarray but with a name</span>
<span class="w">  </span><span class="c1">// We are reserving it for now for future use.</span>
<span class="w">  </span><span class="c1">// repeated Tensor tensors = 4;</span>
<span class="w">  </span><span class="k">reserved</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">13</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Request message for incoming Call.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">Response</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">oneof</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// NDArray represents a n-dimensional array of arbitrary type.</span>
<span class="w">    </span><span class="n">NDArray</span><span class="w"> </span><span class="na">ndarray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// DataFrame represents any tabular data type. We are using</span>
<span class="w">    </span><span class="c1">// DataFrame as a trivial representation for tabular type.</span>
<span class="w">    </span><span class="n">DataFrame</span><span class="w"> </span><span class="na">dataframe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Series portrays a series of values. This can be used for</span>
<span class="w">    </span><span class="c1">// representing Series types in tabular data.</span>
<span class="w">    </span><span class="n">Series</span><span class="w"> </span><span class="na">series</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// File represents for any arbitrary file type. This can be</span>
<span class="w">    </span><span class="c1">// plaintext, image, video, audio, etc.</span>
<span class="w">    </span><span class="n">File</span><span class="w"> </span><span class="na">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Text represents a string inputs.</span>
<span class="w">    </span><span class="n">google.protobuf.StringValue</span><span class="w"> </span><span class="na">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// JSON is represented by using google.protobuf.Value.</span>
<span class="w">    </span><span class="c1">// see https://github.com/protocolbuffers/protobuf/blob/main/src/google/protobuf/struct.proto</span>
<span class="w">    </span><span class="n">google.protobuf.Value</span><span class="w"> </span><span class="na">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Multipart represents a multipart message.</span>
<span class="w">    </span><span class="c1">// It comprises of a mapping from given type name to a subset of aforementioned types.</span>
<span class="w">    </span><span class="n">Multipart</span><span class="w"> </span><span class="na">multipart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// serialized_bytes is for data serialized in BentoML's internal serialization format.</span>
<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="na">serialized_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// Tensor is similiar to ndarray but with a name</span>
<span class="w">  </span><span class="c1">// We are reserving it for now for future use.</span>
<span class="w">  </span><span class="c1">// repeated Tensor tensors = 4;</span>
<span class="w">  </span><span class="k">reserved</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">13</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Part represents possible value types for multipart message.</span>
<span class="c1">// These are the same as the types in Request message.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">Part</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">oneof</span><span class="w"> </span><span class="n">representation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// NDArray represents a n-dimensional array of arbitrary type.</span>
<span class="w">    </span><span class="n">NDArray</span><span class="w"> </span><span class="na">ndarray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// DataFrame represents any tabular data type. We are using</span>
<span class="w">    </span><span class="c1">// DataFrame as a trivial representation for tabular type.</span>
<span class="w">    </span><span class="n">DataFrame</span><span class="w"> </span><span class="na">dataframe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Series portrays a series of values. This can be used for</span>
<span class="w">    </span><span class="c1">// representing Series types in tabular data.</span>
<span class="w">    </span><span class="n">Series</span><span class="w"> </span><span class="na">series</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// File represents for any arbitrary file type. This can be</span>
<span class="w">    </span><span class="c1">// plaintext, image, video, audio, etc.</span>
<span class="w">    </span><span class="n">File</span><span class="w"> </span><span class="na">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Text represents a string inputs.</span>
<span class="w">    </span><span class="n">google.protobuf.StringValue</span><span class="w"> </span><span class="na">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// JSON is represented by using google.protobuf.Value.</span>
<span class="w">    </span><span class="c1">// see https://github.com/protocolbuffers/protobuf/blob/main/src/google/protobuf/struct.proto</span>
<span class="w">    </span><span class="n">google.protobuf.Value</span><span class="w"> </span><span class="na">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// serialized_bytes is for data serialized in BentoML's internal serialization format.</span>
<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="na">serialized_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Tensor is similiar to ndarray but with a name</span>
<span class="w">  </span><span class="c1">// We are reserving it for now for future use.</span>
<span class="w">  </span><span class="c1">// Tensor tensors = 4;</span>
<span class="w">  </span><span class="k">reserved</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">13</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Multipart represents a multipart message.</span>
<span class="c1">// It comprises of a mapping from given type name to a subset of aforementioned types.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">Multipart</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">map</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="n">Part</span><span class="p">&gt;</span><span class="w"> </span><span class="na">fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// File represents for any arbitrary file type. This can be</span>
<span class="c1">// plaintext, image, video, audio, etc.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">File</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// FileType represents possible file type to be handled by BentoML.</span>
<span class="w">  </span><span class="c1">// Currently, we only support plaintext (Text()), image (Image()), and file (File()).</span>
<span class="w">  </span><span class="c1">// TODO: support audio and video streaming file types.</span>
<span class="w">  </span><span class="kd">enum</span><span class="w"> </span><span class="n">FileType</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">FILE_TYPE_UNSPECIFIED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// file types</span>
<span class="w">    </span><span class="na">FILE_TYPE_CSV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="na">FILE_TYPE_PLAINTEXT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="na">FILE_TYPE_JSON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">    </span><span class="na">FILE_TYPE_BYTES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">    </span><span class="na">FILE_TYPE_PDF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// image types</span>
<span class="w">    </span><span class="na">FILE_TYPE_PNG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
<span class="w">    </span><span class="na">FILE_TYPE_JPEG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="w">    </span><span class="na">FILE_TYPE_GIF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<span class="w">    </span><span class="na">FILE_TYPE_BMP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span>
<span class="w">    </span><span class="na">FILE_TYPE_TIFF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">    </span><span class="na">FILE_TYPE_WEBP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">;</span>
<span class="w">    </span><span class="na">FILE_TYPE_SVG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// optional type of file, let it be csv, text, parquet, etc.</span>
<span class="w">  </span><span class="k">optional</span><span class="w"> </span><span class="n">FileType</span><span class="w"> </span><span class="na">kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// contents of file as bytes.</span>
<span class="w">  </span><span class="kt">bytes</span><span class="w"> </span><span class="na">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// DataFrame represents any tabular data type. We are using</span>
<span class="c1">// DataFrame as a trivial representation for tabular type.</span>
<span class="c1">// This message carries given implementation of tabular data based on given orientation.</span>
<span class="c1">// TODO: support index, records, etc.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">DataFrame</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// columns name</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="na">column_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// columns orient.</span>
<span class="w">  </span><span class="c1">// { column â†  { index â†  value } }</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="n">Series</span><span class="w"> </span><span class="na">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Series portrays a series of values. This can be used for</span>
<span class="c1">// representing Series types in tabular data.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">Series</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// A bool parameter value</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="na">bool_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// A float parameter value</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="na">float_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// A int32 parameter value</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">int32</span><span class="w"> </span><span class="na">int32_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// A int64 parameter value</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">int64</span><span class="w"> </span><span class="na">int64_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// A string parameter value</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="na">string_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// represents a double parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="na">double_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// NDArray represents a n-dimensional array of arbitrary type.</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">NDArray</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Represents data type of a given array.</span>
<span class="w">  </span><span class="kd">enum</span><span class="w"> </span><span class="n">DType</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Represents a None type.</span>
<span class="w">    </span><span class="na">DTYPE_UNSPECIFIED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Represents an float type.</span>
<span class="w">    </span><span class="na">DTYPE_FLOAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Represents an double type.</span>
<span class="w">    </span><span class="na">DTYPE_DOUBLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Represents a bool type.</span>
<span class="w">    </span><span class="na">DTYPE_BOOL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Represents an int32 type.</span>
<span class="w">    </span><span class="na">DTYPE_INT32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Represents an int64 type.</span>
<span class="w">    </span><span class="na">DTYPE_INT64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Represents a uint32 type.</span>
<span class="w">    </span><span class="na">DTYPE_UINT32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Represents a uint64 type.</span>
<span class="w">    </span><span class="na">DTYPE_UINT64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Represents a string type.</span>
<span class="w">    </span><span class="na">DTYPE_STRING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// DTYPE is the data type of given array</span>
<span class="w">  </span><span class="n">DType</span><span class="w"> </span><span class="na">dtype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// shape is the shape of given array.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">int32</span><span class="w"> </span><span class="na">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// represents a string parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="na">string_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// represents a float parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="na">float_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// represents a double parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="na">double_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// represents a bool parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="na">bool_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// represents a int32 parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">int32</span><span class="w"> </span><span class="na">int32_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// represents a int64 parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">int64</span><span class="w"> </span><span class="na">int64_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// represents a uint32 parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">uint32</span><span class="w"> </span><span class="na">uint32_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// represents a uint64 parameter value.</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">uint64</span><span class="w"> </span><span class="na">uint64_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">[</span><span class="k">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</details><p>As you can see, BentoService defines a <cite>simple rpc</cite> <code class="docutils literal notranslate"><span class="pre">Call</span></code> that sends a <code class="docutils literal notranslate"><span class="pre">Request</span></code> message and returns a <code class="docutils literal notranslate"><span class="pre">Response</span></code> message.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">Request</span></code> message takes in:</p>
<ul class="simple">
<li><p><cite>api_name</cite>: the name of the API function defined inside your BentoService.</p></li>
<li><p><a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto3#oneof">oneof</a> <cite>content</cite>: the field can be one of the following types:</p></li>
</ul>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Protobuf definition</p></td>
<td><p>IO Descriptor</p></td>
</tr>
<tr class="row-even"><td><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="#array-representation-via-ndarray"><span class="std std-ref">Array representation via NDArray</span></a></p></td>
<td><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/api_io_descriptors.html#numpy-ndarray"><span class="std std-ref">bentoml.io.NumpyNdarray</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="#tabular-data-representation-via-dataframe"><span class="std std-ref">Tabular data representation via DataFrame</span></a></p></td>
<td><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/api_io_descriptors.html#tabular-data-with-pandas"><span class="std std-ref">bentoml.io.PandasDataFrame</span></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="#series-representation-via-series"><span class="std std-ref">Series representation via Series</span></a></p></td>
<td><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/api_io_descriptors.html#tabular-data-with-pandas"><span class="std std-ref">bentoml.io.PandasDataFrame</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="#file-like-object-via-file"><span class="std std-ref">File-like object via File</span></a></p></td>
<td><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/api_io_descriptors.html#files"><span class="std std-ref">bentoml.io.File</span></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#stringvalue"><code class="docutils literal notranslate"><span class="pre">google.protobuf.StringValue</span></code></a></p></td>
<td><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/api_io_descriptors.html#texts"><span class="std std-ref">bentoml.io.Text</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#google.protobuf.Value"><code class="docutils literal notranslate"><span class="pre">google.protobuf.Value</span></code></a></p></td>
<td><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/api_io_descriptors.html#structured-data-with-json"><span class="std std-ref">bentoml.io.JSON</span></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="#complex-payload-via-multipart"><span class="std std-ref">Complex payload via Multipart</span></a></p></td>
<td><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/api_io_descriptors.html#multipart-payloads"><span class="std std-ref">bentoml.io.Multipart</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="hxr-hoverxref hxr-tooltip reference internal" href="#compact-data-format-via-serialized-bytes"><span class="std std-ref">Compact data format via serialized_bytes</span></a></p></td>
<td><p>(See below)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code> is currently not yet supported.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Response</span></code> message will then return one of the aforementioned types as result.</p>
<p><span class="raw-html"><br></span></p>
<p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Example:</span> In the <a class="hxr-hoverxref hxr-tooltip reference internal" href="../tutorial.html#creating-a-service"><span class="std std-ref">quickstart guide</span></a>, we defined a <code class="docutils literal notranslate"><span class="pre">classify</span></code> API that takes in a <a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/api_io_descriptors.html#numpy-ndarray"><span class="std std-ref">bentoml.io.NumpyNdarray</span></a>.</p>
<p>Therefore, our <code class="docutils literal notranslate"><span class="pre">Request</span></code> message would have the following structure:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-44" name="sd-tab-set-15" type="radio">
<label class="sd-tab-label" data-sync-id="python" for="sd-tab-item-44">
Python</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bentoml.grpc.v1</span> <span class="kn">import</span> <span class="n">service_pb2</span> <span class="k">as</span> <span class="n">pb</span>

<span class="n">req</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span>
    <span class="n">api_name</span><span class="o">=</span><span class="s2">"classify"</span><span class="p">,</span>
    <span class="n">ndarray</span><span class="o">=</span><span class="n">pb</span><span class="o">.</span><span class="n">NDArray</span><span class="p">(</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">pb</span><span class="o">.</span><span class="n">NDArray</span><span class="o">.</span><span class="n">DTYPE_FLOAT</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">float_values</span><span class="o">=</span><span class="p">[</span><span class="mf">5.9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">]</span>
    <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-45" name="sd-tab-set-15" type="radio">
<label class="sd-tab-label" data-sync-id="golang" for="sd-tab-item-45">
Go</label><div class="sd-tab-content docutils">
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">	</span><span class="nx">pb</span><span class="w"> </span><span class="s">"github.com/bentoml/bentoml/grpc/v1"</span>
<span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">Request</span><span class="p">{</span>
<span class="w">	</span><span class="nx">ApiName</span><span class="p">:</span><span class="w"> </span><span class="s">"classify"</span><span class="p">,</span>
<span class="w">	</span><span class="nx">Content</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">Request_Ndarray</span><span class="p">{</span>
<span class="w">		</span><span class="nx">Ndarray</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">NDArray</span><span class="p">{</span>
<span class="w">			</span><span class="nx">Dtype</span><span class="p">:</span><span class="w">       </span><span class="o">*</span><span class="nx">pb</span><span class="p">.</span><span class="nx">NDArray_DTYPE_FLOAT</span><span class="p">.</span><span class="nx">Enum</span><span class="p">(),</span>
<span class="w">			</span><span class="nx">Shape</span><span class="p">:</span><span class="w">       </span><span class="p">[]</span><span class="kt">int32</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">},</span>
<span class="w">			</span><span class="nx">FloatValues</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">float32</span><span class="p">{</span><span class="mf">3.5</span><span class="p">,</span><span class="w"> </span><span class="mf">2.4</span><span class="p">,</span><span class="w"> </span><span class="mf">7.8</span><span class="p">,</span><span class="w"> </span><span class="mf">5.1</span><span class="p">},</span>
<span class="w">		</span><span class="p">},</span>
<span class="w">	</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-46" name="sd-tab-set-15" type="radio">
<label class="sd-tab-label" data-sync-id="cpp" for="sd-tab-item-46">
C++</label><div class="sd-tab-content docutils">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">"bentoml/grpc/v1/service.pb.h"</span>

<span class="k">using</span><span class="w"> </span><span class="n">bentoml</span><span class="o">::</span><span class="n">grpc</span><span class="o">::</span><span class="n">v1</span><span class="o">::</span><span class="n">BentoService</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="n">bentoml</span><span class="o">::</span><span class="n">grpc</span><span class="o">::</span><span class="n">v1</span><span class="o">::</span><span class="n">NDArray</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="n">bentoml</span><span class="o">::</span><span class="n">grpc</span><span class="o">::</span><span class="n">v1</span><span class="o">::</span><span class="n">Request</span><span class="p">;</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">3.5</span><span class="p">,</span><span class="w"> </span><span class="mf">2.4</span><span class="p">,</span><span class="w"> </span><span class="mf">7.8</span><span class="p">,</span><span class="w"> </span><span class="mf">5.1</span><span class="p">};</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">};</span>

<span class="n">Request</span><span class="w"> </span><span class="n">request</span><span class="p">;</span>
<span class="n">request</span><span class="p">.</span><span class="n">set_api_name</span><span class="p">(</span><span class="s">"classify"</span><span class="p">);</span>

<span class="n">NDArray</span><span class="w"> </span><span class="o">*</span><span class="n">ndarray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="n">mutable_ndarray</span><span class="p">();</span>
<span class="n">ndarray</span><span class="o">-&gt;</span><span class="n">mutable_shape</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Assign</span><span class="p">(</span><span class="n">shape</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">shape</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
<span class="n">ndarray</span><span class="o">-&gt;</span><span class="n">mutable_float_values</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Assign</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-47" name="sd-tab-set-15" type="radio">
<label class="sd-tab-label" data-sync-id="java" for="sd-tab-item-47">
Java</label><div class="sd-tab-content docutils">
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.*</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="n">shape</span><span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">};</span>
<span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">shapeIterable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">convert</span><span class="p">(</span><span class="n">shape</span><span class="p">);</span>
<span class="n">Float</span><span class="w"> </span><span class="n">array</span><span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">3.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">2.4f</span><span class="p">,</span><span class="w"> </span><span class="mf">7.8f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.1f</span><span class="w"> </span><span class="p">};</span>
<span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">arrayIterable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">array</span><span class="p">);</span>

<span class="n">NDArray</span><span class="p">.</span><span class="na">Builder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NDArray</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">().</span><span class="na">addAllShape</span><span class="p">(</span><span class="n">shapeIterable</span><span class="p">).</span><span class="na">addAllFloatValues</span><span class="p">(</span><span class="n">arrayIterable</span><span class="p">).</span><span class="na">setDtype</span><span class="p">(</span><span class="n">NDArray</span><span class="p">.</span><span class="na">DType</span><span class="p">.</span><span class="na">DTYPE_FLOAT</span><span class="p">);</span>

<span class="n">Request</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Request</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">().</span><span class="na">setApiName</span><span class="p">(</span><span class="n">apiName</span><span class="p">).</span><span class="na">setNdarray</span><span class="p">(</span><span class="n">builder</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-48" name="sd-tab-set-15" type="radio">
<label class="sd-tab-label" data-sync-id="kotlin" for="sd-tab-item-48">
Kotlin</label><div class="sd-tab-content docutils">
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">val</span><span class="w"> </span><span class="n">shape</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Int</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listOf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="n">val</span><span class="w"> </span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listOf</span><span class="p">(</span><span class="mf">3.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">2.4f</span><span class="p">,</span><span class="w"> </span><span class="mf">7.8f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.1f</span><span class="p">)</span>

<span class="n">val</span><span class="w"> </span><span class="n">ndarray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NDArray</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">().</span><span class="na">addAllShape</span><span class="p">(</span><span class="n">shape</span><span class="p">).</span><span class="na">addAllFloatValues</span><span class="p">(</span><span class="n">data</span><span class="p">).</span><span class="na">build</span><span class="p">()</span>
<span class="n">val</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Request</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">().</span><span class="na">setApiName</span><span class="p">(</span><span class="n">apiName</span><span class="p">).</span><span class="na">setNdarray</span><span class="p">(</span><span class="n">ndarray</span><span class="p">).</span><span class="na">build</span><span class="p">()</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-49" name="sd-tab-set-15" type="radio">
<label class="sd-tab-label" data-sync-id="nodejs" for="sd-tab-item-49">
Node.js</label><div class="sd-tab-content docutils">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">pb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">"./bentoml/grpc/v1/service_pb"</span><span class="p">);</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">ndarray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">pb</span><span class="p">.</span><span class="nx">NDArray</span><span class="p">();</span>
<span class="nx">ndarray</span>
<span class="w">  </span><span class="p">.</span><span class="nx">setDtype</span><span class="p">(</span><span class="nx">pb</span><span class="p">.</span><span class="nx">NDArray</span><span class="p">.</span><span class="nx">DType</span><span class="p">.</span><span class="nx">DTYPE_FLOAT</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="nx">setShapeList</span><span class="p">([</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">])</span>
<span class="w">  </span><span class="p">.</span><span class="nx">setFloatValuesList</span><span class="p">([</span><span class="mf">3.5</span><span class="p">,</span><span class="w"> </span><span class="mf">2.4</span><span class="p">,</span><span class="w"> </span><span class="mf">7.8</span><span class="p">,</span><span class="w"> </span><span class="mf">5.1</span><span class="p">]);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">pb</span><span class="p">.</span><span class="nx">Request</span><span class="p">();</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">setApiName</span><span class="p">(</span><span class="s2">"classify"</span><span class="p">).</span><span class="nx">setNdarray</span><span class="p">(</span><span class="nx">ndarray</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-50" name="sd-tab-set-15" type="radio">
<label class="sd-tab-label" data-sync-id="swift" for="sd-tab-item-50">
Swift</label><div class="sd-tab-content docutils">
<div class="highlight-swift notranslate"><div class="highlight"><pre><span></span><span class="kd">import</span> <span class="nc">BentoServiceModel</span>

<span class="kd">var</span> <span class="nv">shape</span><span class="p">:</span> <span class="p">[</span><span class="nb">Int32</span><span class="p">]</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="kd">var</span> <span class="nv">data</span><span class="p">:</span> <span class="p">[</span><span class="nb">Float</span><span class="p">]</span> <span class="p">=</span> <span class="p">[</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">7.8</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">]</span>

<span class="kd">let</span> <span class="nv">ndarray</span><span class="p">:</span> <span class="n">Bentoml_Grpc_v1_NDArray</span> <span class="p">=</span> <span class="p">.</span><span class="n">with</span> <span class="p">{</span>
  <span class="nv">$0</span><span class="p">.</span><span class="n">shape</span> <span class="p">=</span> <span class="n">shape</span>
  <span class="nv">$0</span><span class="p">.</span><span class="n">floatValues</span> <span class="p">=</span> <span class="n">data</span>
  <span class="nv">$0</span><span class="p">.</span><span class="n">dtype</span> <span class="p">=</span> <span class="n">Bentoml_Grpc_v1_NDArray</span><span class="p">.</span><span class="n">DType</span><span class="p">.</span><span class="n">float</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nv">request</span><span class="p">:</span> <span class="n">Bentoml_Grpc_v1_Request</span> <span class="p">=</span> <span class="p">.</span><span class="n">with</span> <span class="p">{</span>
  <span class="nv">$0</span><span class="p">.</span><span class="n">apiName</span> <span class="p">=</span> <span class="n">apiName</span>
  <span class="nv">$0</span><span class="p">.</span><span class="n">ndarray</span> <span class="p">=</span> <span class="n">ndarray</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<section id="array-representation-via-ndarray">
<h4>Array representation via <code class="docutils literal notranslate"><span class="pre">NDArray</span></code><a class="headerlink" href="#array-representation-via-ndarray" title="Permalink to this heading">#</a></h4>
<p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Description:</span> <code class="docutils literal notranslate"><span class="pre">NDArray</span></code> represents a flattened n-dimensional array of arbitrary type. It accepts the following fields:</p>
<ul>
<li><p><cite>dtype</cite></p>
<p>The data type of given input. This is a <a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto3#enum">Enum</a> field that provides 1-1 mapping with Protobuf data types to NumPy data types:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>pb.NDArray.DType</p></th>
<th class="head"><p>numpy.dtype</p></th>
<th class="head"><p>Enum value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DTYPE_UNSPECIFIED</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DTYPE_FLOAT</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">np.float</span></code></p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DTYPE_DOUBLE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">np.double</span></code></p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DTYPE_BOOL</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">np.bool_</span></code></p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DTYPE_INT32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">np.int32</span></code></p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DTYPE_INT64</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">np.int64</span></code></p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DTYPE_UINT32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">np.uint32</span></code></p></td>
<td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DTYPE_UINT64</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">np.uint64</span></code></p></td>
<td><p>7</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DTYPE_STRING</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">np.str_</span></code></p></td>
<td><p>8</p></td>
</tr>
</tbody>
</table>
</div>
</li>
<li><p><cite>shape</cite></p>
<p>A list of <cite>int32</cite> that represents the shape of the flattened array. the <a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/api_io_descriptors.html#numpy-ndarray"><span class="std std-ref">bentoml.io.NumpyNdarray</span></a> will
then reshape the given payload into expected shape.</p>
<p>Note that this value will always takes precendence over the <code class="docutils literal notranslate"><span class="pre">shape</span></code> field in the <a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/api_io_descriptors.html#numpy-ndarray"><span class="std std-ref">bentoml.io.NumpyNdarray</span></a> descriptor,
meaning the array will be reshaped to this value first if given. Refer to <a class="reference internal" href="../reference/api_io_descriptors.html#bentoml.io.NumpyNdarray.from_proto" title="bentoml.io.NumpyNdarray.from_proto"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bentoml.io.NumpyNdarray.from_proto()</span></code></a> for implementation details.</p>
</li>
<li><p><cite>string_values</cite>, <cite>float_values</cite>, <cite>double_values</cite>, <cite>bool_values</cite>, <cite>int32_values</cite>, <cite>int64_values</cite>, <cite>uint32_values</cite>, <cite>unit64_values</cite></p>
<p>Each of the fields is a <cite>list</cite> of the corresponding data type. The list is a flattened array, and will be reconstructed
alongside with <code class="docutils literal notranslate"><span class="pre">shape</span></code> field to the original payload.</p>
<p>Per request sent, one message should only contain <strong>ONE</strong> of the aforementioned fields.</p>
<p>The interaction among the above fields and <code class="docutils literal notranslate"><span class="pre">dtype</span></code> are as follows:</p>
<ul>
<li><dl>
<dt>if <code class="docutils literal notranslate"><span class="pre">dtype</span></code> is not present in the message:</dt><dd><ul>
<li><p>All of the fields are empty, then we return a <code class="docutils literal notranslate"><span class="pre">np.empty</span></code>.</p></li>
<li><p>We will loop through all of the provided fields, and only allows one field per message.</p>
<p>If here are more than one field (i.e. <code class="docutils literal notranslate"><span class="pre">string_values</span></code> and <code class="docutils literal notranslate"><span class="pre">float_values</span></code>), then we will raise an error, as we donâ€™t know how to deserialize the data.</p>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>otherwise:</dt><dd><ul class="simple">
<li><p>We will use the provided dtype-to-field map to get the data from the given message.</p></li>
</ul>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>DType</p></td>
<td><p>field</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DTYPE_BOOL</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bool_values</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DTYPE_DOUBLE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">double_values</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DTYPE_FLOAT</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">float_values</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DTYPE_INT32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int32_values</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DTYPE_INT64</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int64_values</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DTYPE_STRING</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">string_values</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DTYPE_UINT32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">uint32_values</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DTYPE_UINT64</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">uint64_values</span></code></p></td>
</tr>
</tbody>
</table>
</div>
</dd>
</dl>
</li>
</ul>
<p>For example, if <code class="docutils literal notranslate"><span class="pre">dtype</span></code> is <code class="docutils literal notranslate"><span class="pre">DTYPE_FLOAT</span></code>, then the payload expects to have <code class="docutils literal notranslate"><span class="pre">float_values</span></code> field.</p>
</li>
</ul>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-row-cols-2 sd-row-cols-xs-2 sd-row-cols-sm-2 sd-row-cols-md-2 sd-row-cols-lg-2 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
<code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">API</span></code></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">NumpyNdarray</span><span class="o">.</span><span class="n">from_sample</span><span class="p">(</span>
   <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">5.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
<code class="docutils literal notranslate"><span class="pre">pb.NDArray</span></code></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ndarray {
  dtype: DTYPE_FLOAT
  shape: 1
  shape: 4
  float_values: 5.4
  float_values: 3.4
  float_values: 1.5
  float_values: 0.4
}
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<p><span class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary">API reference:</span> <a class="reference internal" href="../reference/api_io_descriptors.html#bentoml.io.NumpyNdarray.from_proto" title="bentoml.io.NumpyNdarray.from_proto"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bentoml.io.NumpyNdarray.from_proto()</span></code></a></p>
<p><span class="raw-html"><br></span></p>
</section>
<section id="tabular-data-representation-via-dataframe">
<h4>Tabular data representation via <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code><a class="headerlink" href="#tabular-data-representation-via-dataframe" title="Permalink to this heading">#</a></h4>
<p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Description:</span> <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> represents any tabular data type. Currently we only support the columns orientation
since it is best for preserving the input order.</p>
<p>It accepts the following fields:</p>
<ul>
<li><p><cite>column_names</cite></p>
<p>A list of <cite>string</cite> that represents the column names of the given tabular data.</p>
</li>
<li><p><cite>column_values</cite></p>
<p>A list of <cite>Series</cite> where <cite>Series</cite> represents a series of arbitrary data type. The allowed fields for
<cite>Series</cite> as similar to the ones in <cite>NDArray</cite>:</p>
<ul class="simple">
<li><p>one of [<cite>string_values</cite>, <cite>float_values</cite>, <cite>double_values</cite>, <cite>bool_values</cite>, <cite>int32_values</cite>, <cite>int64_values</cite>, <cite>uint32_values</cite>, <cite>unit64_values</cite>]</p></li>
</ul>
</li>
</ul>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-row-cols-2 sd-row-cols-xs-2 sd-row-cols-sm-2 sd-row-cols-md-2 sd-row-cols-lg-2 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
<code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">API</span></code></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PandasDataFrame</span><span class="o">.</span><span class="n">from_sample</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
      <span class="s2">"age"</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">29</span><span class="p">],</span>
      <span class="s2">"height"</span><span class="p">:</span> <span class="p">[</span><span class="mi">94</span><span class="p">,</span> <span class="mi">170</span><span class="p">],</span>
      <span class="s2">"weight"</span><span class="p">:</span> <span class="p">[</span><span class="mi">31</span><span class="p">,</span> <span class="mi">115</span><span class="p">]</span>
    <span class="p">}),</span>
    <span class="n">orient</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
<code class="docutils literal notranslate"><span class="pre">pb.DataFrame</span></code></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dataframe {
  column_names: "age"
  column_names: "height"
  column_names: "weight"
  columns {
    int32_values: 3
    int32_values: 29
  }
  columns {
    int32_values: 40
    int32_values: 190
  }
  columns {
    int32_values: 140
    int32_values: 178
  }
}
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<p><span class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary">API reference:</span> <a class="reference internal" href="../reference/api_io_descriptors.html#bentoml.io.PandasDataFrame.from_proto" title="bentoml.io.PandasDataFrame.from_proto"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bentoml.io.PandasDataFrame.from_proto()</span></code></a></p>
</section>
<section id="series-representation-via-series">
<h4>Series representation via <code class="docutils literal notranslate"><span class="pre">Series</span></code><a class="headerlink" href="#series-representation-via-series" title="Permalink to this heading">#</a></h4>
<p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Description:</span> <code class="docutils literal notranslate"><span class="pre">Series</span></code> portrays a series of values. This can be used for representing Series types in tabular data.</p>
<p>It accepts the following fields:</p>
<ul>
<li><p><cite>string_values</cite>, <cite>float_values</cite>, <cite>double_values</cite>, <cite>bool_values</cite>, <cite>int32_values</cite>, <cite>int64_values</cite></p>
<p>Similar to NumpyNdarray, each of the fields is a <cite>list</cite> of the corresponding data type. The list is a 1-D array, and will be then pass to <code class="docutils literal notranslate"><span class="pre">pd.Series</span></code>.</p>
<p>Each request should only contain <strong>ONE</strong> of the aforementioned fields.</p>
<p>The interaction among the above fields and <code class="docutils literal notranslate"><span class="pre">dtype</span></code> from <code class="docutils literal notranslate"><span class="pre">PandasSeries</span></code> are as follows:</p>
<ul>
<li><dl>
<dt>if <code class="docutils literal notranslate"><span class="pre">dtype</span></code> is not present in the descriptor:</dt><dd><ul>
<li><p>All of the fields are empty, then we return an empty <code class="docutils literal notranslate"><span class="pre">pd.Series</span></code>.</p></li>
<li><p>We will loop through all of the provided fields, and only allows one field per message.</p>
<p>If here are more than one field (i.e. <code class="docutils literal notranslate"><span class="pre">string_values</span></code> and <code class="docutils literal notranslate"><span class="pre">float_values</span></code>), then we will raise an error, as we donâ€™t know how to deserialize the data.</p>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>otherwise:</dt><dd><ul class="simple">
<li><p>We will use the provided dtype-to-field map to get the data from the given message.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</li>
</ul>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-row-cols-2 sd-row-cols-xs-2 sd-row-cols-sm-2 sd-row-cols-md-2 sd-row-cols-lg-2 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
<code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">API</span></code></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PandasSeries</span><span class="o">.</span><span class="n">from_sample</span><span class="p">([</span><span class="mf">5.4</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
<code class="docutils literal notranslate"><span class="pre">pb.Series</span></code></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>series {
  float_values: 5.4
  float_values: 3.4
  float_values: 1.5
  float_values: 0.4
}
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<p><span class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary">API reference:</span> <a class="reference internal" href="../reference/api_io_descriptors.html#bentoml.io.PandasSeries.from_proto" title="bentoml.io.PandasSeries.from_proto"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bentoml.io.PandasSeries.from_proto()</span></code></a></p>
<p><span class="raw-html"><br></span></p>
</section>
<section id="file-like-object-via-file">
<h4>File-like object via <code class="docutils literal notranslate"><span class="pre">File</span></code><a class="headerlink" href="#file-like-object-via-file" title="Permalink to this heading">#</a></h4>
<p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Description:</span> <code class="docutils literal notranslate"><span class="pre">File</span></code> represents any arbitrary file type. this can be used
to send in any file type, including images, videos, audio, etc.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently both <a class="reference internal" href="../reference/api_io_descriptors.html#bentoml.io.File" title="bentoml.io.File"><code class="xref py py-class docutils literal notranslate"><span class="pre">bentoml.io.File</span></code></a> and <a class="reference internal" href="../reference/api_io_descriptors.html#bentoml.io.Image" title="bentoml.io.Image"><code class="xref py py-class docutils literal notranslate"><span class="pre">bentoml.io.Image</span></code></a> are using
<code class="docutils literal notranslate"><span class="pre">pb.File</span></code></p>
</div>
<p>It accepts the following fields:</p>
<ul>
<li><p><cite>content</cite></p>
<p>A <cite>bytes</cite> field that represents the content of the file.</p>
</li>
<li><p><cite>kind</cite></p>
<p>An optional <cite>string</cite> field that represents the file type. If specified, it will raise an error if
<code class="docutils literal notranslate"><span class="pre">mime_type</span></code> specified in <a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/api_io_descriptors.html#files"><span class="std std-ref">bentoml.io.File</span></a> is not matched.</p>
</li>
</ul>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-row-cols-2 sd-row-cols-xs-2 sd-row-cols-sm-2 sd-row-cols-md-2 sd-row-cols-lg-2 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
<code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">API</span></code></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="p">(</span><span class="n">mime_type</span><span class="o">=</span><span class="s2">"application/pdf"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
<code class="docutils literal notranslate"><span class="pre">pb.File</span></code></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>file {
  kind: "application/pdf"
  content: &lt;bytes&gt;
}
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<p><a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/api_io_descriptors.html#images"><span class="std std-ref">bentoml.io.Image</span></a> will also be using <code class="docutils literal notranslate"><span class="pre">pb.File</span></code>.</p>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-row-cols-2 sd-row-cols-xs-2 sd-row-cols-sm-2 sd-row-cols-md-2 sd-row-cols-lg-2 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
<code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">API</span></code></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">File</span><span class="p">(</span><span class="n">mime_type</span><span class="o">=</span><span class="s2">"image/png"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
<code class="docutils literal notranslate"><span class="pre">pb.File</span></code></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>file {
  kind: "image/png"
  content: &lt;bytes&gt;
}
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="complex-payload-via-multipart">
<h4>Complex payload via <code class="docutils literal notranslate"><span class="pre">Multipart</span></code><a class="headerlink" href="#complex-payload-via-multipart" title="Permalink to this heading">#</a></h4>
<p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Description:</span> <code class="docutils literal notranslate"><span class="pre">Multipart</span></code> represents a complex payload that can contain
multiple different fields. It takes a <code class="docutils literal notranslate"><span class="pre">fields</span></code>, which is a dictionary of input name to
its coresponding <a class="reference internal" href="../reference/api_io_descriptors.html#bentoml.io.IODescriptor" title="bentoml.io.IODescriptor"><code class="xref py py-class docutils literal notranslate"><span class="pre">bentoml.io.IODescriptor</span></code></a></p>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-row-cols-2 sd-row-cols-xs-2 sd-row-cols-sm-2 sd-row-cols-md-2 sd-row-cols-lg-2 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
<code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">API</span></code></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Multipart</span><span class="p">(</span>
   <span class="n">meta</span><span class="o">=</span><span class="n">Text</span><span class="p">(),</span>
   <span class="n">arr</span><span class="o">=</span><span class="n">NumpyNdarray</span><span class="p">(</span>
      <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span>
      <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
   <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
<code class="docutils literal notranslate"><span class="pre">pb.Multipart</span></code></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>multipart {
   fields {
      key: "arr"
      value {
         ndarray {
         dtype: DTYPE_FLOAT
         shape: 2
         shape: 2
         float_values: 1.0
         float_values: 2.0
         float_values: 3.0
         float_values: 4.0
         }
      }
   }
   fields {
      key: "meta"
      value {
         text {
         value: "nlp"
         }
      }
   }
}
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<p><span class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary">API reference:</span> <a class="reference internal" href="../reference/api_io_descriptors.html#bentoml.io.Multipart.from_proto" title="bentoml.io.Multipart.from_proto"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bentoml.io.Multipart.from_proto()</span></code></a></p>
</section>
<section id="compact-data-format-via-serialized-bytes">
<h4>Compact data format via <code class="docutils literal notranslate"><span class="pre">serialized_bytes</span></code><a class="headerlink" href="#compact-data-format-via-serialized-bytes" title="Permalink to this heading">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">serialized_bytes</span></code> field in both <code class="docutils literal notranslate"><span class="pre">Request</span></code> and <code class="docutils literal notranslate"><span class="pre">Response</span></code>  is reserved for pre-established protocol encoding between client and server.</p>
<p>BentoML leverages the field to improve serialization performance between BentoML client and server. Thus the field is not <strong>recommended</strong> for use directly.</p>
</section>
</section>
<section id="mounting-servicer">
<h3>Mounting Servicer<a class="headerlink" href="#mounting-servicer" title="Permalink to this heading">#</a></h3>
<p>gRPC service <a class="hxr-hoverxref hxr-tooltip reference internal" href="#demystifying-the-misconception-of-grpc-vs-rest"><span class="std std-ref">multiplexing</span></a> enables us to mount additional custom servicers alongside with BentoService,
and serve them under the same port.</p>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text"><cite>service.py</cite></span><a class="headerlink" href="#id23" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">route_guide_pb2</span>
<span class="kn">import</span> <span class="nn">route_guide_pb2_grpc</span>
<span class="kn">from</span> <span class="nn">servicer_impl</span> <span class="kn">import</span> <span class="n">RouteGuideServicer</span>

<span class="n">svc</span> <span class="o">=</span> <span class="n">bentoml</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span><span class="s2">"iris_classifier"</span><span class="p">,</span> <span class="n">runners</span><span class="o">=</span><span class="p">[</span><span class="n">iris_clf_runner</span><span class="p">])</span>

<span class="n">services_name</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">v</span><span class="o">.</span><span class="n">full_name</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">route_guide_pb2</span><span class="o">.</span><span class="n">DESCRIPTOR</span><span class="o">.</span><span class="n">services_by_name</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="p">]</span>
<span class="n">svc</span><span class="o">.</span><span class="n">mount_grpc_servicer</span><span class="p">(</span>
    <span class="n">RouteGuideServicer</span><span class="p">,</span>
    <span class="n">add_servicer_fn</span><span class="o">=</span><span class="n">add_RouteGuideServicer_to_server</span><span class="p">,</span>
<span class="hll">    <span class="n">service_names</span><span class="o">=</span><span class="n">services_name</span><span class="p">,</span>
</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Serve your service with <a class="hxr-hoverxref hxr-tooltip reference internal" href="../reference/cli.html#bentoml-serve-grpc"><span class="std std-ref">bentoml serve-grpc</span></a> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Â»<span class="w"> </span>bentoml<span class="w"> </span>serve-grpc<span class="w"> </span>service.py:svc<span class="w"> </span>--reload<span class="w"> </span>--enable-reflection
</pre></div>
</div>
<p>Now your <code class="docutils literal notranslate"><span class="pre">RouteGuide</span></code> service can also be accessed through <code class="docutils literal notranslate"><span class="pre">localhost:3000</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">service_names</span></code> is <strong>REQUIRED</strong> here, as this will be used for <a class="reference external" href="https://github.com/grpc/grpc/blob/master/doc/server-reflection.md">server reflection</a>
when <code class="docutils literal notranslate"><span class="pre">--enable-reflection</span></code> is passed to <code class="docutils literal notranslate"><span class="pre">bentoml</span> <span class="pre">serve-grpc</span></code>.</p>
</div>
</section>
<section id="mounting-grpc-interceptors">
<h3>Mounting gRPC Interceptors<a class="headerlink" href="#mounting-grpc-interceptors" title="Permalink to this heading">#</a></h3>
<p>Inteceptors are a component of gRPC that allows us to intercept and interact with the
proto message and service context either before - or after - the actual RPC call was
sent/received by client/server.</p>
<p>Interceptors to gRPC is what middleware is to HTTP. The most common use-case for interceptors
are authentication, <a class="hxr-hoverxref hxr-tooltip reference internal" href="tracing.html#tracing"><span class="std std-ref">tracing</span></a>, access logs, and more.</p>
<p>BentoML comes with a sets of built-in <em>async interceptors</em> to provide support for access logs,
<a class="reference external" href="https://opentelemetry.io/">OpenTelemetry</a>, and <a class="reference external" href="https://prometheus.io/">Prometheus</a>.</p>
<p>The following diagrams demonstrates the flow of a gRPC request from client to server:</p>
<img alt="Interceptor Flow" src="../_images/interceptor-flow.png">
<p>Since interceptors are executed in the order they are added, users interceptors will be executed after the built-in interceptors.</p>
<blockquote>
<div><p>Users interceptors shouldnâ€™t modify the existing headers and data of the incoming <code class="docutils literal notranslate"><span class="pre">Request</span></code>.</p>
</div></blockquote>
<p>BentoML currently only support <strong>async interceptors</strong> (via <a class="reference external" href="https://grpc.github.io/grpc/python/grpc_asyncio.html#grpc.aio.ServerInterceptor">grpc.aio.ServerInterceptor</a>, as opposed to <a class="reference external" href="https://grpc.github.io/grpc/python/grpc_asyncio.html#grpc.aio.ServerInterceptor">grpc.ServerInterceptor</a>). This is
because BentoML gRPC server is an async implementation of gRPC server.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are using <code class="docutils literal notranslate"><span class="pre">grpc.ServerInterceptor</span></code>, you will need to migrate it over
to use the new <code class="docutils literal notranslate"><span class="pre">grpc.aio.ServerInterceptor</span></code> in order to use this feature.</p>
<p>Feel free to reach out to us at <a class="reference external" href="https://l.linklyhq.com/l/ktOX">#support on Slack</a></p>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
A toy implementation <code class="docutils literal notranslate"><span class="pre">AppendMetadataInterceptor</span></code><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-text">metadata_interceptor.py</span><a class="headerlink" href="#id24" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">typing</span> <span class="k">as</span> <span class="nn">t</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">dataclasses</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span>

<span class="kn">from</span> <span class="nn">grpc</span> <span class="kn">import</span> <span class="n">aio</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">bentoml.grpc.types</span> <span class="kn">import</span> <span class="n">Request</span>
    <span class="kn">from</span> <span class="nn">bentoml.grpc.types</span> <span class="kn">import</span> <span class="n">Response</span>
    <span class="kn">from</span> <span class="nn">bentoml.grpc.types</span> <span class="kn">import</span> <span class="n">RpcMethodHandler</span>
    <span class="kn">from</span> <span class="nn">bentoml.grpc.types</span> <span class="kn">import</span> <span class="n">AsyncHandlerMethod</span>
    <span class="kn">from</span> <span class="nn">bentoml.grpc.types</span> <span class="kn">import</span> <span class="n">HandlerCallDetails</span>
    <span class="kn">from</span> <span class="nn">bentoml.grpc.types</span> <span class="kn">import</span> <span class="n">BentoServicerContext</span>


<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">Context</span><span class="p">:</span>
    <span class="n">usage</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">accuracy_score</span><span class="p">:</span> <span class="nb">float</span>


<span class="k">class</span> <span class="nc">AppendMetadataInterceptor</span><span class="p">(</span><span class="n">aio</span><span class="o">.</span><span class="n">ServerInterceptor</span><span class="p">):</span>
     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">usage</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">Context</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="o">=</span><span class="n">accuracy_score</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_record</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

     <span class="k">async</span> <span class="k">def</span> <span class="nf">intercept_service</span><span class="p">(</span>
         <span class="bp">self</span><span class="p">,</span>
         <span class="n">continuation</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">HandlerCallDetails</span><span class="p">],</span> <span class="n">t</span><span class="o">.</span><span class="n">Awaitable</span><span class="p">[</span><span class="n">RpcMethodHandler</span><span class="p">]],</span>
         <span class="n">handler_call_details</span><span class="p">:</span> <span class="n">HandlerCallDetails</span><span class="p">,</span>
     <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RpcMethodHandler</span><span class="p">:</span>
         <span class="kn">from</span> <span class="nn">bentoml.grpc.utils</span> <span class="kn">import</span> <span class="n">wrap_rpc_handler</span>

         <span class="n">handler</span> <span class="o">=</span> <span class="k">await</span> <span class="n">continuation</span><span class="p">(</span><span class="n">handler_call_details</span><span class="p">)</span>

         <span class="k">if</span> <span class="n">handler</span> <span class="ow">and</span> <span class="p">(</span><span class="n">handler</span><span class="o">.</span><span class="n">response_streaming</span> <span class="ow">or</span> <span class="n">handler</span><span class="o">.</span><span class="n">request_streaming</span><span class="p">):</span>
             <span class="k">return</span> <span class="n">handler</span>

         <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">behaviour</span><span class="p">:</span> <span class="n">AsyncHandlerMethod</span><span class="p">[</span><span class="n">Response</span><span class="p">]):</span>
             <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">behaviour</span><span class="p">)</span>
             <span class="k">async</span> <span class="k">def</span> <span class="nf">new_behaviour</span><span class="p">(</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">BentoServicerContext</span>
             <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span> <span class="o">|</span> <span class="n">t</span><span class="o">.</span><span class="n">Awaitable</span><span class="p">[</span><span class="n">Response</span><span class="p">]:</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">_record</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                   <span class="p">{</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">usage</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">accuracy_score</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
                 <span class="p">)</span>
                 <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">behaviour</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                 <span class="n">context</span><span class="o">.</span><span class="n">set_trailing_metadata</span><span class="p">(</span>
                    <span class="nb">tuple</span><span class="p">(</span>
                          <span class="p">[</span>
                             <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">))</span>
                             <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">asdict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                          <span class="p">]</span>
                    <span class="p">)</span>
                 <span class="p">)</span>
                 <span class="k">return</span> <span class="n">resp</span>

             <span class="k">return</span> <span class="n">new_behaviour</span>

         <span class="k">return</span> <span class="n">wrap_rpc_handler</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</details><p>To add your intercptors to existing BentoService, use <code class="docutils literal notranslate"><span class="pre">svc.add_grpc_interceptor</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id25">
<div class="code-block-caption"><span class="caption-text"><cite>service.py</cite></span><a class="headerlink" href="#id25" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">custom_interceptor</span> <span class="kn">import</span> <span class="n">CustomInterceptor</span>

<span class="n">svc</span><span class="o">.</span><span class="n">add_grpc_interceptor</span><span class="p">(</span><span class="n">CustomInterceptor</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">add_grpc_interceptor</span></code> also supports <cite>partial</cite> class as well as multiple arguments
interceptors:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-51" name="sd-tab-set-16" type="radio">
<label class="sd-tab-label" for="sd-tab-item-51">
multiple arguments</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">metadata_interceptor</span> <span class="kn">import</span> <span class="n">AppendMetadataInterceptor</span>

<span class="n">svc</span><span class="o">.</span><span class="n">add_grpc_interceptor</span><span class="p">(</span><span class="n">AppendMetadataInterceptor</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="s2">"NLP"</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="o">=</span><span class="mf">0.867</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-52" name="sd-tab-set-16" type="radio">
<label class="sd-tab-label" for="sd-tab-item-52">
partial method</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">from</span> <span class="nn">metadata_interceptor</span> <span class="kn">import</span> <span class="n">AppendMetadataInterceptor</span>

<span class="n">svc</span><span class="o">.</span><span class="n">add_grpc_interceptor</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">AppendMetadataInterceptor</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="s2">"NLP"</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="o">=</span><span class="mf">0.867</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<hr class="docutils">
<section id="recommendations">
<h2>Recommendations<a class="headerlink" href="#recommendations" title="Permalink to this heading">#</a></h2>
<p>gRPC is designed to be high performance framework for inter-service communications. This
means that it is a perfect fit for building microservices. The following are some
recommendation we have for using gRPC for model serving:</p>
<p><span class="raw-html"><br></span></p>
<section id="demystifying-the-misconception-of-grpc-vs-rest">
<h3>Demystifying the misconception of gRPC vs. REST<a class="headerlink" href="#demystifying-the-misconception-of-grpc-vs-rest" title="Permalink to this heading">#</a></h3>
<p>You might stumble upon articles comparing gRPC to REST, and you might get the impression
that gRPC is a better choice than REST when building services. This is not entirely
true.</p>
<p>gRPC is built on top of HTTP/2, and it addresses some of the shortcomings of HTTP/1.1,
such as <a class="reference external" href="https://wikipedia.org/wiki/Head-of-line_blocking">head-of-line blocking</a>, and <a class="reference external" href="https://wikipedia.org/wiki/HTTP_pipelining">HTTP pipelining</a>.
However, gRPC is not a replacement for REST, and indeed it is not a replacement for
model serving. gRPC comes with its own set of trade-offs, such as:</p>
<ul class="simple">
<li><p><strong>Limited browser support</strong>: It is impossible to call a gRPC service directly from any
browser. You will end up using tools such as <a class="reference external" href="https://github.com/fullstorydev/grpcui">gRPCUI</a> in order to interact
with your service, or having to go through the hassle of implementing a gRPC client in
your language of choice.</p></li>
<li><p><strong>Binary protocol format</strong>: While <a class="reference external" href="https://github.com/protocolbuffers/protobuf">Protobuf</a> is
efficient to send and receive over the wire, it is not human-readable. This means
additional toolin for debugging and analyzing protobuf messages are required.</p></li>
<li><p><strong>Knowledge gap</strong>: gRPC comes with its own concepts and learning curve, which requires
teams to invest time in filling those knowledge gap to be effectively use gRPC. This
often leads to a lot of friction and sometimes increase friction to the development
agility.</p></li>
<li><p><strong>Lack of support for additional content types</strong>: gRPC depends on protobuf, its content
type are restrictive, in comparison to out-of-the-box support from HTTP+REST.</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://grpc.io/blog/grpc-on-http2/">gRPC on HTTP/2</a> dives into how gRPC is built
on top of HTTP/2, and this <a class="reference external" href="https://www.cncf.io/blog/2018/07/03/http-2-smarter-at-scale/">article</a>
goes into more details on how HTTP/2 address the problem from HTTP/1.1</p>
<p>For HTTP/2 specification, see <a class="reference external" href="https://tools.ietf.org/html/rfc7540">RFC 7540</a>.</p>
</div>
<p><span class="raw-html"><br></span></p>
</section>
<section id="should-i-use-grpc-instead-of-rest-for-model-serving">
<h3>Should I use gRPC instead of REST for model serving?<a class="headerlink" href="#should-i-use-grpc-instead-of-rest-for-model-serving" title="Permalink to this heading">#</a></h3>
<p>Yes and no.</p>
<p>If your organization is already using gRPC for inter-service communications, using
your Bento with gRPC is a no-brainer. You will be able to seemlessly integrate your
Bento with your existing gRPC services without having to worry about the overhead of
implementing <a class="reference external" href="https://github.com/grpc-ecosystem/grpc-gateway">grpc-gateway</a>.</p>
<p>However, if your organization is not using gRPC, we recommend to keep using REST for
model serving. This is because REST is a well-known and well-understood protocol,
meaning there is no knowledge gap for your team, which will increase developer agility, and
faster go-to-market strategy.</p>
<p><span class="raw-html"><br></span></p>
</section>
<section id="performance-tuning">
<h3>Performance tuning<a class="headerlink" href="#performance-tuning" title="Permalink to this heading">#</a></h3>
<p>BentoML allows user to tune the performance of gRPC via <a class="hxr-hoverxref hxr-tooltip reference internal" href="configuration.html#configuration"><span class="std std-ref">bentoml_configuration.yaml</span></a> via <code class="docutils literal notranslate"><span class="pre">api_server.grpc</span></code>.</p>
<p>A quick overview of the available configuration for gRPC:</p>
<div class="literal-block-wrapper docutils container" id="id26">
<div class="code-block-caption"><span class="caption-text"><cite>bentoml_configuration.yaml</cite></span><a class="headerlink" href="#id26" title="Permalink to this code">#</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">api_server</span><span class="p">:</span>
<span class="w">  </span><span class="nt">grpc</span><span class="p">:</span>
<span class="w">    </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3000</span>
<span class="w">    </span><span class="nt">max_concurrent_streams</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~</span>
<span class="w">    </span><span class="nt">maximum_concurrent_rpcs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~</span>
<span class="w">    </span><span class="nt">max_message_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span>
<span class="w">    </span><span class="nt">reflection</span><span class="p">:</span>
<span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">metrics</span><span class="p">:</span>
<span class="w">      </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3001</span>
</pre></div>
</div>
</div>
<p><span class="raw-html"><br></span></p>
<section id="max-concurrent-streams">
<h4><code class="docutils literal notranslate"><span class="pre">max_concurrent_streams</span></code><a class="headerlink" href="#max-concurrent-streams" title="Permalink to this heading">#</a></h4>
<blockquote class="epigraph">
<div><p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Definition:</span> Maximum number of concurrent incoming streams to allow on a HTTP2 connection.</p>
</div></blockquote>
<p>By default we donâ€™t set a limit cap. HTTP/2 connections typically has limit of <a class="reference external" href="httpwg.org/specs/rfc7540.html#rfc.section.5.1.2">maximum concurrent streams</a>
on a connection at one time.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Some notes about fine-tuning <code class="docutils literal notranslate"><span class="pre">max_concurrent_streams</span></code><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">Note that a gRPC channel uses a single HTTP/2 connection, and concurrent calls are multiplexed on said connection.
When the number of active calls reaches the connection stream limit, any additional
calls are queued to the client. Queued calls then wait for active calls to complete before being sent. This means that
application will higher load and long running streams could see a performance degradation caused by queuing because of the limit.</p>
<p class="sd-card-text">Setting a limit cap on the number of concurrent streams will prevent this from happening, but it also means that
you need to tune the limit cap to the right number.</p>
<ul class="simple">
<li><p class="sd-card-text">If the limit cap is too low, you will sooner or later running into the issue mentioned above.</p></li>
<li><p class="sd-card-text">Not setting a limit cap are also <strong>NOT RECOMMENDED</strong>. Too many streams on a single
HTTP/2 connection introduces <cite>thread contention</cite> between streams trying to write
to the connection, <cite>packet loss</cite> which causes all call to be blocked.</p></li>
</ul>
<p class="sd-card-text"><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Remarks:</span> We recommend you to play around with the limit cap, starting with 100, and increase if needed.</p>
</div>
</details><p><span class="raw-html"><br></span></p>
</section>
<section id="maximum-concurrent-rpcs">
<h4><code class="docutils literal notranslate"><span class="pre">maximum_concurrent_rpcs</span></code><a class="headerlink" href="#maximum-concurrent-rpcs" title="Permalink to this heading">#</a></h4>
<blockquote class="epigraph">
<div><p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Definition:</span> The maximum number of concurrent RPCs this server will service before returning <code class="docutils literal notranslate"><span class="pre">RESOURCE_EXHAUSTED</span></code> status.</p>
</div></blockquote>
<p>By default we set to <code class="docutils literal notranslate"><span class="pre">None</span></code> to indicate no limit, and let gRPC to decide the limit.</p>
<p><span class="raw-html"><br></span></p>
</section>
<section id="max-message-length">
<h4><code class="docutils literal notranslate"><span class="pre">max_message_length</span></code><a class="headerlink" href="#max-message-length" title="Permalink to this heading">#</a></h4>
<blockquote class="epigraph">
<div><p><span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Definition:</span> The maximum message length in bytes allowed to be received on/can be send to the server.</p>
</div></blockquote>
<p>By default we set to <code class="docutils literal notranslate"><span class="pre">-1</span></code> to indicate no limit.
Message size limits via this options is a way to prevent gRPC from consuming excessive
resources. By default, gRPC uses per-message limits to manage inbound and outbound
message.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Some notes about fine-tuning <code class="docutils literal notranslate"><span class="pre">max_message_length</span></code><div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">This options sets two values: <a class="reference external" href="https://github.com/grpc/grpc/blob/e8df8185e521b518a8f608b8a5cf98571e2d0925/include/grpc/impl/codegen/grpc_types.h#L153">grpc.max_receive_message_length</a>
and <a class="reference external" href="https://github.com/grpc/grpc/blob/e8df8185e521b518a8f608b8a5cf98571e2d0925/include/grpc/impl/codegen/grpc_types.h#L159">grpc.max_send_message_length</a>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#define GRPC_ARG_MAX_RECEIVE_MESSAGE_LENGTH "grpc.max_receive_message_length"</span>

<span class="cp">#define GRPC_ARG_MAX_SEND_MESSAGE_LENGTH "grpc.max_send_message_length"</span>
</pre></div>
</div>
<p class="sd-card-text">By default, gRPC sets incoming message to be 4MB, and no limit on outgoing message.
We recommend you to only set this option if you want to limit the size of outcoming message. Otherwise, you should let gRPC to determine the limit.</p>
</div>
</details><p>We recommend you to also check out <a class="reference external" href="https://grpc.io/docs/guides/performance/">gRPC performance best practice</a> to learn about best practice for gRPC.</p>
</section>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="gpu.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Serving with GPU</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="performance.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Performance Guide</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright Â© 2022-2023, bentoml.com
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/bentoml/bentoml" aria-label="GitHub"> ðŸ± </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Serving with gRPC</a><ul>
<li><a class="reference internal" href="#get-started-with-grpc-in-bentoml">Get started with gRPC in BentoML</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#using-your-grpc-bentoservice">Using your gRPC BentoService</a></li>
<li><a class="reference internal" href="#client-implementation">Client Implementation</a></li>
<li><a class="reference internal" href="#containerize-your-bento-with-grpc-support">Containerize your Bento ðŸ± with gRPC support</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-grpc-in-bentoml">Using gRPC in BentoML</a><ul>
<li><a class="reference internal" href="#protobuf-definition">Protobuf definition</a><ul>
<li><a class="reference internal" href="#array-representation-via-ndarray">Array representation via <code class="docutils literal notranslate"><span class="pre">NDArray</span></code></a></li>
<li><a class="reference internal" href="#tabular-data-representation-via-dataframe">Tabular data representation via <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code></a></li>
<li><a class="reference internal" href="#series-representation-via-series">Series representation via <code class="docutils literal notranslate"><span class="pre">Series</span></code></a></li>
<li><a class="reference internal" href="#file-like-object-via-file">File-like object via <code class="docutils literal notranslate"><span class="pre">File</span></code></a></li>
<li><a class="reference internal" href="#complex-payload-via-multipart">Complex payload via <code class="docutils literal notranslate"><span class="pre">Multipart</span></code></a></li>
<li><a class="reference internal" href="#compact-data-format-via-serialized-bytes">Compact data format via <code class="docutils literal notranslate"><span class="pre">serialized_bytes</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mounting-servicer">Mounting Servicer</a></li>
<li><a class="reference internal" href="#mounting-grpc-interceptors">Mounting gRPC Interceptors</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recommendations">Recommendations</a><ul>
<li><a class="reference internal" href="#demystifying-the-misconception-of-grpc-vs-rest">Demystifying the misconception of gRPC vs. REST</a></li>
<li><a class="reference internal" href="#should-i-use-grpc-instead-of-rest-for-model-serving">Should I use gRPC instead of REST for model serving?</a></li>
<li><a class="reference internal" href="#performance-tuning">Performance tuning</a><ul>
<li><a class="reference internal" href="#max-concurrent-streams"><code class="docutils literal notranslate"><span class="pre">max_concurrent_streams</span></code></a></li>
<li><a class="reference internal" href="#maximum-concurrent-rpcs"><code class="docutils literal notranslate"><span class="pre">maximum_concurrent_rpcs</span></code></a></li>
<li><a class="reference internal" href="#max-message-length"><code class="docutils literal notranslate"><span class="pre">max_message_length</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><div id="PapercupsChatWidget"><iframe title="Papercups Chat Widget Container" class="Papercups-chatWindowContainer css-um7ixe" sandbox="allow-scripts allow-popups allow-same-origin allow-forms" src="https://chat-widget.papercups.io?accountId=25ad5fd9-293b-4e0f-9601-5b0cd7846b48&amp;baseUrl=https%3A%2F%2Fyatai-community-papercups.herokuapp.com&amp;closeable=1&amp;debug=0&amp;disableAnalyticsTracking=0&amp;greeting=Hi%20there%21%20How%20can%20I%20help%20you%3F%20If%20we%20couldn%27t%20get%20back%20to%20you%20in%20time%2C%20feel%20free%20to%20join%20our%20community%20on%20slack%20and%20post%20your%20question%20in%20the%20%23support%20channel%3A%20https%3A%2F%2Fl.linklyhq.com%2Fl%2FktOX&amp;inbox=ac3ebd50-fc10-4299-9a1c-496841b49a6f&amp;metadata=%7B%22os%22%3A%22Mac%20OS%20X%22%2C%22browser%22%3A%22Chrome%22%2C%22time_zone%22%3A%22America%2FLos_Angeles%22%2C%22current_url%22%3A%22https%3A%2F%2Fdocs.bentoml.org%2Fen%2Flatest%2Fguides%2Fgrpc.html%22%2C%22host%22%3A%22docs.bentoml.org%22%2C%22pathname%22%3A%22%2Fen%2Flatest%2Fguides%2Fgrpc.html%22%2C%22browser_version%22%3A%22111%22%2C%22screen_height%22%3A720%2C%22screen_width%22%3A1280%2C%22lib%22%3A%22web%22%2C%22insert_id%22%3A%2244ty2smd28u4iwsx%22%2C%22time%22%3A1679951028.902%7D&amp;primaryColor=%2347AFD1&amp;requireEmailUpfront=1&amp;showAgentAvailability=1&amp;subtitle=Ask%20us%20anything%20in%20the%20chat%20window%20below%20%F0%9F%98%8A&amp;title=Welcome%20to%20BentoML%21&amp;token=25ad5fd9-293b-4e0f-9601-5b0cd7846b48&amp;ts=1679951028044&amp;version=1.2.0" style="pointer-events: none; height: 0px; min-height: 0px; opacity: 0; transform: translateY(4px) translateZ(0px);">Loading...</iframe></div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/tabs.js"></script>
    <script src="../_static/js/hoverxref.js"></script>
    <script src="../_static/js/tooltipster.bundle.min.js"></script>
    <script src="../_static/js/micromodal.min.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script async="async" src="/_/static/javascript/readthedocs-doc-embed.js"></script>
    <script src="../_static/js/custom.js"></script>
    
<div style="display: none; visibility: hidden;"><script src="https://t.jitsu.com/s/lib.js" data-key="js.jqho3vy91pn32tceppam.y74ysav0xrdi5kv13hdpfc" data-init-only="false" defer="defer"></script></div></body></html>